// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2022 Jean-Francois Moine - LGPL3+
// commit [0fd6b201b7]
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var B=0;return function(){return B<q.length?{done:!1,value:q[B++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(q,B,D){q!=Array.prototype&&q!=Object.prototype&&(q[B]=D.value)};$jscomp.getGlobal=function(q){q=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,q];for(var B=0;B<q.length;++B){var D=q[B];if(D&&D.Math==Math)return D}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(q,B){this.$jscomp$symbol$id_=q;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:B})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function q(D){if(this instanceof q)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(D||"")+"_"+B++,D)}var B=0;return q}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.iterator;q||(q=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[q]&&$jscomp.defineProperty(Array.prototype,q,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.asyncIterator;q||(q=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(q){$jscomp.initSymbolIterator();q={next:q};q[$jscomp.global.Symbol.iterator]=function(){return this};return q};
$jscomp.iteratorFromArray=function(q,B){$jscomp.initSymbolIterator();q instanceof String&&(q+="");var D=0,x={next:function(){if(D<q.length){var K=D++;return{value:B(K,q[K]),done:!1}}x.next=function(){return{done:!0,value:void 0}};return x.next()}};x[Symbol.iterator]=function(){return x};return x};
$jscomp.polyfill=function(q,B,D,x){if(B){D=$jscomp.global;q=q.split(".");for(x=0;x<q.length-1;x++){var K=q[x];K in D||(D[K]={});D=D[K]}q=q[q.length-1];x=D[q];B=B(x);B!=x&&null!=B&&$jscomp.defineProperty(D,q,{configurable:!0,writable:!0,value:B})}};$jscomp.polyfill("Array.prototype.keys",function(q){return q?q:function(){return $jscomp.iteratorFromArray(this,function(q){return q})}},"es6","es3");if("undefined"==typeof abc2svg)var abc2svg={};
abc2svg.C={BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,SM:3,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8,SL_ALI_MSK:112,SL_ALIGN:16,SL_CENTER:32,SL_CLOSE:64};abc2svg.sym_name="bar clef custos smark grace key meter Zrest note part rest yspace staves Break tempo  block remark".split(" ");
abc2svg.keys=[new Int8Array([-1,-1,-1,-1,-1,-1,-1]),new Int8Array([-1,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,0]),new Int8Array([0,0,0,1,0,0,0]),new Int8Array([1,0,0,1,0,0,0]),new Int8Array([1,0,0,1,1,0,0]),new Int8Array([1,1,0,1,1,0,0]),new Int8Array([1,1,0,1,1,1,0]),new Int8Array([1,1,1,1,1,1,0]),new Int8Array([1,1,1,1,1,
1,1])];abc2svg.p_b40=new Int8Array([2,8,14,19,25,31,37]);abc2svg.b40_p=new Int8Array([0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6]);abc2svg.b40_a=new Int8Array([-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2]);abc2svg.b40_m=new Int8Array([-2,-1,0,1,2,0,0,1,2,3,4,0,2,3,4,5,6,3,4,5,6,7,0,5,6,7,8,9,0,7,8,9,10,11,0,9,10,11,12,13]);
abc2svg.b40k=new Int8Array([36,1,2,3,8,2,2,7,8,13,14,2,8,13,14,19,20,13,14,19,20,25,2,19,24,25,30,31,2,25,30,31,36,37,2,31,36,37,2,3]);abc2svg.b40sf=new Int8Array([-2,-7,0,7,2,88,0,-5,2,-3,4,88,2,-3,4,-1,6,-3,4,-1,6,1,88,-1,-6,1,-4,3,88,1,-4,3,-2,5,88,3,-2,5,0,7]);abc2svg.isb40=new Int8Array([0,1,6,11,12,17,18,23,28,29,34,35]);abc2svg.ifb40=new Int8Array([0,5,6,11,12,17,22,23,28,29,34,39]);abc2svg.pab40=function(q,B){q+=19;q=40*(q/7|0)+abc2svg.p_b40[q%7];B&&3!=B&&(q+=B);return q};
abc2svg.b40p=function(q){return 7*(q/40|0)+abc2svg.b40_p[q%40]-19};abc2svg.b40a=function(q){return abc2svg.b40_a[q%40]};abc2svg.b40m=function(q){return 12*(q/40|0)+abc2svg.b40_m[q%40]};abc2svg.ch_alias={maj:"",min:"m","-":"m","\u00b0":"dim","+":"aug","+5":"aug",maj7:"M7","\u03947":"M7","\u0394":"M7",min7:"m7","-7":"m7","\u00f87":"m7b5","\u00b07":"dim7","min+7":"m+7",aug7:"+7","7+5":"+7","7#5":"+7",sus:"sus4","7sus":"7sus4"};
abc2svg.ft_w={thin:100,extralight:200,light:300,regular:400,medium:500,semi:600,demi:600,semibold:600,demibold:600,bold:700,extrabold:800,ultrabold:800,black:900,heavy:900};abc2svg.ft_re=/-?Thin|-?Extra Light|-?Light|-?Regular|-?Medium|-?[DS]emi|-?[DS]emi[ -]?Bold|-?Bold|-?Extra[ -]?Bold|-?Ultra[ -]?Bold|-?Black|-?Heavy\//i;abc2svg.rat=function(q,B){for(var D,x,K=0,w=0,La=1,aa=1;0!=B;)x=B,D=q/B|0,B=q%B,q=x,x=K+D*La,K=La,La=x,x=aa+D*w,aa=w,w=x;return[La,w]};
abc2svg.pitcmp=function(q,B){return q.pit-B.pit};
abc2svg.Abc=function(q){function B(a,c){if(!a)return a;var d=new a.constructor,e;for(e in a)a.hasOwnProperty(e)&&(d[e]=c&&"object"==typeof a[e]?B(a[e],c-1):a[e]);return d}function D(a,c,d,e){var f,g;if(q.errbld){switch(a){case 0:a="warn";break;case 1:a="error";break;default:a="fatal"}q.errbld(a,c,d,e)}else{if(void 0!=e&&0<=e){for(f=g=0;;){var h=t.file.indexOf("\n",f);if(0>h||h>e)break;g++;f=h+1}f=e-f}e="";d&&(e=d,g&&(e+=":"+(g+1)+":"+(f+1)),e+=" ");switch(a){case 0:e+="Warning: ";break;case 1:e+=
"Error: ";break;default:e+="Internal bug: "}q.errmsg(e+c,g,f)}}function x(a,c,d,e,f,g,h){var m;if(a||!p.quiet){if(c){if(c.err)return;c.err=!0}q.textrans&&(m=q.textrans[d])&&(d=m);3<arguments.length&&(d=d.replace(/\$./g,function(a){switch(a){case "$1":return e;case "$2":return f;case "$3":return g;default:return h}}));c&&c.fname?D(a,d,c.fname,c.istart):D(a,d)}}function K(){this.index=0;K.prototype.char=function(){return this.buffer[this.index]};K.prototype.next_char=function(){return this.buffer[++this.index]};
K.prototype.get_int=function(){for(var a=0,c=this.buffer[this.index];"0"<=c&&"9">=c;)a=10*a+Number(c),c=this.next_char();return a}}function w(a,c,d,e,f,g){x(a,{fname:t.fname,istart:t.istart+t.line.index},c,d,e,f,g)}function La(a){/eval *\(|Function|setTimeout|setInterval/.test(a)?w(1,"Unsecure code"):eval('"use strict";\n'+a)}function aa(a,c,d,e){a=z[a];var f=d/2|0;d=(d+e)/2|0;0>f&&(f=0);d>=Ha&&(d=Ha-1,f>d&&(f=d));if(c)for(c=a.top[f++];f<=d;)c<a.top[f]&&(c=a.top[f]),f++;else for(c=a.bot[f++];f<=d;)c>
a.bot[f]&&(c=a.bot[f]),f++;return c}function Y(a,c,d,e,f){a=z[a];var g=d/2|0;d=(d+e)/2|0;0>g&&(g=0);d>=Ha&&(d=Ha-1,g>d&&(g=d));if(c)for(;g<=d;)a.top[g]<f&&(a.top[g]=f),g++;else for(;g<=d;)a.bot[g]>f&&(a.bot[g]=f),g++}function sd(a,c){switch(c&7){case n.SL_ABOVE:return 1;case n.SL_BELOW:return 0}return!a.second}function Zb(a,c){switch(c&7){case n.SL_ABOVE:return!0;case n.SL_BELOW:return!1}return a.multi?0<a.multi:a.p_v.have_ly?(a.pos.voc&7)!=n.SL_ABOVE:!1}function Jb(a){if(!a.ldst)if(a.start){if(!a.ldst){var c=
a.dd,d=a.prev,e=a.s,f=e.st,g=a.start.s,h=g.x;d&&(h=d.s.x+a.dd.wl+2,d.val-=d.dd.wr,8>d.val&&(d.val=8));a.st=f;switch(c.func){case 5:var m=1;break;case 3:case 6:m=6==c.func?Zb(g,a.pos):sd(g,a.pos)}"^"==c.ty?m=1:"_"==c.ty&&(m=0);if(a.defl.noen){var k=a.x-h;20>k&&(h=a.x-20-3,k=20)}else k=e.x-h-6,e.type==n.NOTE&&(k-=6),10>k&&(h-=10-k,k=10);var r=aa(f,m,h-c.wl-5,k);if(m){var A=z[g.st].topbar+2;r<A&&(r=A)}else A=z[g.st].botbar-2,r>A&&(r=A),r-=c.h;if(d)if(m)r<d.y&&(r=d.y);else if(r>=d.y)r=d.y;else{do d.y=
r,d=d.prev;while(d)}a.lden=!1;a.has_val=!0;a.val=k;a.x=h;a.y=r;(a.up=m)&&(r+=c.h);Y(f,m,h,k,r);m?g.ymx=e.ymx=r:g.ymn=e.ymn=r}}else{k=a.s;A=a.dd;c=a.x;d=A.wl+A.wr;e=z[k.st].topbar+2+A.hd;f=z[k.st].botbar-2-A.h;switch(A.glyph){case "brth":case "caes":case "lphr":case "mphr":case "sphr":case "short":case "tick":r=e;if(k.type==n.BAR)k.invis=1;else{"brth"==A.glyph&&r<k.ymx&&(r=k.ymx);for(k=k.ts_next;k&&!k.seqst;k=k.ts_next);c+=.45*((k?k.x:ra)-c)}a.x=c;a.y=r;return}k.nhd&&(c+=k.notes[0<=k.stem?0:k.nhd].shhd);
a.up=m=4==A.func||7==A.func?0:6==A.func?Zb(k,a.pos):sd(k,a.pos);switch(A.ty){case "@":case "<":case ">":r=a.y}if(void 0==r)if(m)r=aa(k.st,!0,c-A.wl,d)+A.hd,r<e&&(r=e),a.y>r&&(r=a.y),k.ymx=r+A.h;else{r=aa(k.st,!1,c-A.wl,d)-A.h;r>f&&(r=f);a.y<r&&(r=a.y);if("fermata"==A.name||"accent"==A.glyph||"roll"==A.glyph)a.inv=1;k.ymn=r-A.hd}6!=A.func&&(r>=e?Y(k.st,1,c-A.wl,d,r+A.h):r<=f&&Y(k.st,0,c-A.wl,d,r-A.hd));a.x=c;a.y=r}}function kc(a,c){c||(c=a);var d;var e=$b[c];!e&&/\d[()]$/.test(c)&&(e=$b[c.replace(/\d/,
"")]);if(e)if(d=e.match(/(\d+)\s+(.+?)\s+([0-9.,]+)\s+([0-9.]+)\s+([0-9.]+)/)){var f=Number(d[1]),g=d[3],h=parseFloat(d[4]),m=parseFloat(d[5]);if(isNaN(f))x(1,null,"%%deco: bad C function value '$1'",d[1]);else if(10<f&&(32>f||44<f))x(1,null,"%%deco: bad C function index '$1'",f);else{if(0<g.indexOf(",")){g=g.split(",");var k=g[1];g=g[0]}else k=0;if(50<g||80<h||80<m)x(1,null,"%%deco: abnormal h/wl/wr value '$1'",e);else{c=Bb[a];c||(c={name:a},Bb[a]=c);c.func=0==a.indexOf("head-")?9:f;c.glyph=d[2];
c.h=Number(g);c.hd=Number(k);c.wl=h;c.wr=m;if(e=e.replace(d[0],"").trim()){'"'==e[0]&&(e=e.slice(1,-1));if("@"==e[0]&&!e.match(/^@([0-9.-]+),([0-9.-]+);?/)){x(1,null,"%%deco: bad position '$1'",e);return}c.str=e}6==c.func&&void 0==c.str&&(c.str=a);e=a.slice(-1);if("("==e||")"==e&&0>a.indexOf("("))if(c.str=null,a=a.slice(0,-1)+("("==e?")":"("),a=Bb[a])"("==e?(c.dd_en=a,a.dd_st=c):(c.dd_st=a,a.dd_en=c);return c}}}else x(1,null,"Invalid decoration '$1'",a);else p.decoerr&&x(1,null,"Unknown decoration '$1'",
a)}function td(a,c,d){var e=cb[a],f=a.slice(0,-1)+("("==a.slice(-1)?")":"(");e?x(1,c,"Conflict on !$1!",a):(d.s=c,(e=cb[f])?(")"==a.slice(-1)&&(e=d,d=cb[f]),cb[f]=null,d.midi!=e.midi||d.s.time+d.s.dur!=e.s.time?x(1,c,"Bad tie"):(d.tie_ty=n.SL_AUTO,d.tie_e=e,e.tie_s=d,d.s.ti1=e.s.ti2=!0)):cb[a]=d)}function ud(a){var c,d=Bb[a];if(d)return d;if(0<="<>^_@".indexOf(a[0])&&!/^([>^]|[<>]\d?[()])$/.test(a)){var e=a[0];"@"==e&&(e=(c=a.match(/@([-\d]+),([-\d]+)/))?c[0]:"");d=kc(a,a.replace(e,""))}else d=kc(a);
if(d)return e&&("@"==e[0]&&(d.x=Number(c[1]),d.y=Number(c[2]),e="@"),d.ty=e),d}function ib(a,c){for(var d,e,f,g;;){f=la.shift();if(!f)break;if(e=ud(f)){switch(e.func){case 0:if(a.type==n.BAR&&"dot"==f){a.bar_dotted=!0;continue}case 1:case 2:if(!a.notes){x(1,a,I.must_note_rest,f);continue}break;case 8:if(a.type!=n.NOTE){x(1,a,I.must_note,f);continue}f=a.notes[a.nhd];f.a_dd||(f.a_dd=[]);f.a_dd.push(e);continue;case 9:if(!a.notes){x(1,a,I.must_note_rest,f);continue}for(d=0;d<=a.nhd;d++)f=a.notes[d],
f.invis=!0,f.a_dd||(f.a_dd=[]),f.a_dd.push(e);continue;case 10:if(a.notes)for(d=0;d<=a.nhd;d++)a.notes[d].color=f;else a.color=f;break;case 32:a.invis=!0;break;case 33:if(a.type!=n.BAR){x(1,a,"!beamon! must be on a bar");continue}a.beam_on=!0;break;case 34:if(a.type!=n.NOTE||!c||c.type!=n.NOTE||a.dur!=c.dur){x(1,a,"!$1! must be on the last of a couple of notes",f);continue}a.trem2=!0;a.beam_end=!0;a.beam_st=!1;c.beam_st=!0;c.beam_end=!1;a.ntrem=c.ntrem=Number(f[4]);for(d=0;d<=a.nhd;d++)a.notes[d].dur*=
2;for(d=0;d<=c.nhd;d++)c.notes[d].dur*=2;break;case 35:if(a.type!=n.NOTE){x(1,a,I.must_note,f);continue}a.xstem=!0;break;case 36:if(a.type!=n.NOTE){x(1,a,I.must_note,f);continue}"1"==f[6]?a.beam_br1=!0:a.beam_br2=!0;break;case 37:a.rbstop=1;break;case 38:if(a.type!=n.NOTE){x(1,a,I.must_note,f);continue}a.trem1=!0;a.ntrem=f.length;break;case 39:if(a.type!=n.NOTE){x(1,a,I.must_note,f);continue}a.feathered_beam="a"==f[5]?1:-1;break;case 40:a.stemless=!0;break;case 41:a.rbstop=2;break;case 42:if(!a.notes[0].acc)continue;
f="sacc"+a.notes[0].acc.toString();e=Bb[f];if(!e&&(e=kc(f),!e)){x(1,a,I.bad_val,"!editorial!");continue}delete a.notes[0].acc;l.acc[a.notes[0].pit+19]=0;break;case 43:d=l.acc[a.notes[0].pit+19];if(a.notes[0].acc||!d)continue;g=1;break;case 44:td(f,a,a.notes[0]);continue}a.a_dd||(a.a_dd=[]);a.a_dd.push(e)}}g&&(la.push("cacc"+d),lc(a,a.notes[0]))}function lc(a,c){for(var d,e;;){d=la.shift();if(!d)break;if(e=ud(d)){switch(e.func){case 0:case 1:case 3:case 4:case 8:break;default:x(1,a,"Cannot have !$1! on a head",
d);continue;case 9:case 32:c.invis=!0;break;case 10:c.color=d;continue;case 40:a.stemless=!0;continue;case 44:td(d,a,c);continue}c.a_dd||(c.a_dd=[]);c.a_dd.push(e)}}}function zc(a){var c,d=0,e=a.a_dd,f=e.length;for(c=0;c<f;c++){var g=e[c];switch(g.func){case 1:7>d&&(d=7);break;case 2:14>d&&(d=14);break;case 3:switch(g.glyph){case "brth":case "lphr":case "mphr":case "sphr":20>a.wr&&(a.wr=20)}default:switch(g.ty){case "<":g=g.wl+g.wr+6;d<g&&(d=g);break;case ">":g=g.wl+g.wr+8,a.wr<g&&(a.wr=g)}}}d&&a.prev&&
a.prev.type==n.BAR&&(d-=3);return d}function Ve(){function a(a){var c=a.x-a.wl,d=da.length;for(a=0;a<d;a++){var e=da[a];e.ix=a;e.s.x=e.x=c;e.defl.nost=!0}}function c(a){if(!a.invis||!a.play){if(a.a_dd){var c,d=a.a_dd.length;void 0==a.y&&(a.y=0);for(c=0;c<d;c++){var e=a.a_dd[c];var f=a.x;var r=a.y;switch(e.func){default:if(10<=e.func)continue;var A=0;break;case 3:case 4:case 5:case 7:A=a.pos.orn;break;case 6:A=a.pos.vol;break;case 7:A=a.pos.dyn}switch(e.ty){case "^":A=A&-8|n.SL_ABOVE;break;case "_":A=
A&-8|n.SL_BELOW;break;case "<":case ">":A=A&7|n.SL_CLOSE;"<"==e.ty?(f-=e.wr+8,a.notes[0].acc&&(f-=5.5)):f+=e.wl+8;r=3*(a.notes[0].pit-18)-(e.h-e.hd)/2;break;case "@":f+=e.x,r+=e.y}if((A&7)!=n.SL_HIDDEN&&(A={s:a,dd:e,st:a.st,ix:da.length,defl:{},x:f,y:r,pos:A},0<=e.name.indexOf("inverted")&&(A.inv=1),a.type!=n.BAR||e.ty||(A.x-=a.wl/2-2),da.push(A),e.dd_en?A.ldst=!0:e.dd_st&&(A.lden=!0,A.defl.nost=!0),vd[e.func]))vd[e.func](A)}}if(a.notes)for(e=0;e<a.notes.length;e++)if(a.notes[e].a_dd){f=a;r=e;var l=
f.notes[r],y=l.a_dd.length,u=f.x;for(d=0;d<y;d++)c=l.a_dd[d],A={s:f,dd:c,st:f.st,m:r,ix:0,defl:{},x:u,y:3*(l.pit-18)},c.ty&&("@"==c.ty?(A.x+=c.x,A.y+=c.y):(A.y-=(c.h-c.hd)/2,"<"==c.ty?A.x-=c.wr+8:">"==c.ty&&(A.x+=c.wr+8))),da.push(A),c.dd_en?A.ldst=!0:c.dd_st&&(A.lden=!0,A.defl.nost=!0)}}}var d,e;for(d=P;d;d=d.ts_next){switch(d.type){case n.CLEF:case n.KEY:case n.METER:continue}break}for(da.length&&a(d);d;d=d.ts_next){switch(d.type){case n.BAR:case n.MREST:case n.NOTE:case n.REST:case n.SPACE:break;
case n.GRACE:for(e=d.extra;e;e=e.next)c(e);break;default:continue}c(d)}(function(){var a,c,d=da.length;for(a=0;a<d;a++){var e=da[a];if(e.ldst){var k=e.dd;var r=k.dd_en;k=e.s;var A=k.v;for(c=a+1;c<d;c++){var l=da[c];if(!l.start&&l.dd==r&&l.s.v==A)break}if(c==d)for(A=k.st,c=a+1;c<d&&(l=da[c],l.start||l.dd!=r||l.s.st!=A);c++);c==d&&(l={s:k,st:e.st,dd:r,ix:da.length-1,x:ra-6,y:k.y,cont:!0,lden:!0,defl:{noen:!0}},l.x<k.x+10&&(l.x=k.x+10),void 0!=e.m&&(l.m=e.m),da.push(l));l.start=e;l.defl.nost=e.defl.nost;
for(c=a;0<=--c;)if(e=da[c],e.start){if(e.s.time<k.time)break;if(e.dd.name==l.dd.name){l.prev=e;break}}}}for(a=0;a<d;a++)if(l=da[a],l.lden&&!l.start){k=l.s;a:{for(c=k;c.prev;)if(c=c.prev,c.rbstart)break a;for(c=c.p_v.sym;c.type!=n.CLEF;)c=c.ts_prev;c.next&&c.next.type==n.KEY&&(c=c.next);c=c.next&&c.next.type==n.METER?c.next:c}e={s:c,st:l.st,dd:l.dd.dd_st,ix:da.length-1,y:k.y,ldst:!0};e.x=e.s.x;void 0!=l.m&&(e.m=l.m);da.push(e);l.start=e}})()}function We(){var a,c=da.length;for(a=0;a<c;a++){var d=da[a];
var e=d.dd;e=e.func;if(wd[e]&&void 0==d.m)wd[e](d)}}function Xe(){var a,c,d=Array(S+1),e=da.length;for(a=0;a<=S;a++)d[a]={ymin:0,ymax:0};for(a=0;a<e;a++){var f=da[a];(c=f.dd)&&Wa[c.func]&&void 0==f.m&&(Wa[c.func](f),!c.dd_en&&((f.pos&n.SL_ALI_MSK)==n.SL_ALIGN||0==(f.pos&n.SL_ALI_MSK)&&0<f.s.fmt.dynalign)&&(f.up?f.y>d[f.st].ymax&&(d[f.st].ymax=f.y):f.y<d[f.st].ymin&&(d[f.st].ymin=f.y)))}for(a=0;a<e;a++)if(f=da[a],(c=f.dd)&&!c.dd_en&&Wa[c.func]){if(6==c.func&&((f.pos&n.SL_ALI_MSK)==n.SL_ALIGN||0==(f.pos&
n.SL_ALI_MSK)&&0<f.s.fmt.dynalign)){var g=f.up?d[f.st].ymax:d[f.st].ymin;f.y=g}else g=f.y;f.up&&(g+=c.h);Y(f.st,f.up,f.x,f.val,g)}Ye();for(g=0;g<F.length;g++)if(a=F[g],!a.second&&a.sym&&!a.ignore){e=void 0;d=a;a=z[d.st].topbar+15;for(c=d.sym;c;c=c.next)if(c.type==n.BAR&&c.rbstart&&!c.norepbra){if(!c.next)break;e||(e=c,fa("repeat"));for(f=c;c.next&&(c=c.next,!c.rbstop););var h=aa(d.st,!0,f.x,c.x-f.x)+2;a<h&&(a=h);2==f.rbstart&&(h=aa(d.st,!0,f.x,3)+10,a<h&&(a=h));2==c.rbstop&&(h=aa(d.st,!0,c.x-3,3)+
10,a<h&&(a=h));f.text&&(h=sa(f.text),h=aa(d.st,!0,f.x+4,h[0])+h[1],a<h&&(a=h));c.rbstart&&(c=c.prev)}if(c=e)for(Ea(d.st,!0),h=a*z[d.st].staffscale;c;c=c.next)if(c.rbstart&&!c.norepbra){for(f=c;c.next&&(c=c.next,!c.rbstop););if(f==c)break;var m=f.x;0<p.measurenb&c.bar_num&&c.bar_num%p.measurenb&&(m+=6);e=c.type!=n.BAR?c.rbstop?0:c.x-ra+4:1<c.bar_type.length&&"[]"!=c.bar_type||"]"==c.bar_type?0<f.st&&!(J.staves[f.st-1].flags&64)?c.wl:":"==c.bar_type.slice(-1)?12:":"!=c.bar_type[0]?0:8:c.rbstop&&!c.rbstart?
0:8;e=c.x-m-e;c.next||c.rbstop||d.bar_start||(d.bar_start=Rc(c),d.bar_start.bar_type="",d.bar_start.rbstart=1);f.text&&ka(m+4,h-H.curfont.size-2,f.text);Cb(m,h);2==f.rbstart&&(G+="m0 10v-10");G+="h"+e.toFixed(1);2==c.rbstop&&(G+="v10");G+='"/>\n';Y(f.st,!0,m,e,a+2);c.rbstart&&(c=c.prev.prev)}}}function Ze(){var a;var c=J;for(a=0;a<=S&&!c.st_print[a];a++);if(!(a>S)){Ea(a);if(1!=z[a].staffscale){var d=ma("measure").size;Kb("measurefont","* "+(d/z[a].staffscale).toString())}fa("measure");var e=mc("0")*
H.curfont.swfac;var f=P;var g=H.nbar;if(1<g)if(0==p.measurenb){var h=!0;var m=aa(a,!0,0,20);m<z[a].topbar+14&&(m=z[a].topbar+14);ka(0,m,g.toString());Y(a,!0,0,20,m+H.curfont.size+2)}else if(0==g%p.measurenb){for(;;f=f.ts_next){switch(f.type){case n.CLEF:case n.KEY:case n.METER:case n.STBRK:continue}break}if(f.type!=n.BAR||!f.bar_num){h=!0;var k=e;10<=g&&(k*=100<=g?3:2);H.curfont.pad&&(k+=2*H.curfont.pad);c=f.x-f.wl+2;m=aa(a,!0,c,k);m<z[a].topbar+6&&(m=z[a].topbar+6);m+=2+H.curfont.pad;ka(c,m,g.toString());
m+=H.curfont.size+H.curfont.pad;Y(a,!0,c,k,m)}}for(;f;f=f.ts_next){switch(f.type){case n.STAVES:c=f.sy;for(a=0;a<S&&!c.st_print[a];a++);Ea(a);continue;default:continue;case n.BAR:if(!f.bar_num||1>=f.bar_num)continue}g=f.bar_num;0!=p.measurenb&&0==g%p.measurenb&&f.next&&!f.bar_mrep&&(h||(h=!0),k=e,10<=g&&(k*=100<=g?3:2),H.curfont.pad&&(k+=2*H.curfont.pad),c=f.x,m=aa(a,!0,c,k),m<z[a].topbar+6&&(m=z[a].topbar+6),f.next.type==n.NOTE&&(0<f.next.stem?m<f.next.ys-H.curfont.size&&(m=f.next.ys-H.curfont.size):
m<f.next.y&&(m=f.next.y)),m+=2+H.curfont.pad,ka(c,m,g.toString()),m+=H.curfont.size+H.curfont.pad,Y(a,!0,c,k,m))}H.nbar=g;d&&Kb("measurefont","* "+d.toString())}}function $e(a,c,d,e){function f(a){return 6*Math.round((a+12)/6)-12-a}var g=a?3.5:5;a=a?1.8:3.2;if(0<c){c=e-(d-1)*g-a;if(26<c)return 0;d=e}else{d=e+(d-1)*g+a;if(-2>d)return 0;c=e}e=f(d-.25);c=f(c+.25);return e*e>c*c?c:e}function xd(a){var c;a=B(a);a.invis=!0;delete a.extra;delete a.text;delete a.a_gch;delete a.a_ly;delete a.a_dd;delete a.tp;
a.notes=B(a.notes);for(c=0;c<=a.nhd;c++){var d=a.notes[c]=B(a.notes[c]);delete d.a_dd}return a}function yd(a){function c(a,c,d,e,f,g){var h=f.s1,k=h.nflags;h.ntrem&&(k-=h.ntrem);h.trem2&&g>k&&(h.dur>=n.BLEN/2?(a=h.x+6,c=f.s2.x-6):h.dur<n.BLEN/4&&(g=c-a,16>g?(a+=g/4,c-=g/4):(a+=5,c-=6)));d=f.a*a+f.b-d;c=(c-a)/E.scale;f=f.a*c*E.scale;Cb(a,d,!0);G+="l"+c.toFixed(1)+" "+(-f).toFixed(1)+"v"+e.toFixed(1)+"l"+(-c).toFixed(1)+" "+f.toFixed(1)+'z"/>\n'}var d,e,f,g,h=a.s1,m=a.s2;pa(h,"beam");if(h.grace){var k=
3.5;var r=3.2;var A=.29;var l=1.8}else k=5,r=7,A=.34,l=3.2;l/=E.scale;var y=h.stem;h.stem!=m.stem&&h.nflags<m.nflags&&(y=m.stem);0>y&&(l=-l);c(h.xs-A,m.xs+A,0,l,a,1);var u=0;for(d=h;d.type==n.NOTE&&d.stem!=y&&(d.ys=a.a*d.xs+a.b-z[d.st].y+k*(d.nflags-1)*d.stem-l),d!=m;d=d.next);h.feathered_beam&&(u=k/(m.xs-h.xs),0<h.feathered_beam?(u=-u,k=u*h.xs):k=u*m.xs,u*=y);A=0;for(e=2;e<=a.nflags;e++)for(A+=k,0!=u&&(a.a+=u),d=h;;d=d.next){if(!(d.type!=n.NOTE||d.nflags<e))if(d.trem1&&e>d.nflags-d.ntrem){var v=
d.dur>=n.BLEN/2?d.x:d.xs;c(v-5,v+5,(A+2.5)*y,l,a,e)}else{for(f=d;d!=m;){var p=d.next;if(p.type==n.NOTE||p.type==n.REST)if(p.trem1){if(p.nflags-p.ntrem<e)break}else if(p.nflags<e)break;if(p.beam_br1||p.beam_br2&&2<e)break;d=p}for(g=d;g.type!=n.NOTE;)g=g.prev;v=f.xs;var t=y;if(f==g){if(f==h)v+=r;else if(f==m)v-=r;else if(f.beam_br1||f.beam_br2&&2<e)v+=r;else{for(p=f.next;p.type!=n.NOTE;)p=p.next;if(p.beam_br1||p.beam_br2&&2<e)v-=r;else{for(f=f.prev;f.type!=n.NOTE;)f=f.prev;v=f.nflags<p.nflags||f.nflags==
p.nflags&&f.dots<p.dots?v+r:v-r}}f.stem!=y&&(t=f.stem,f.ys=a.a*f.xs+a.b-z[f.st].y-l)}c(v,g.xs,A*t,l,a,e)}if(d==m)break}h.tmp?jb(h):m.tmp&&jb(m);Mb(h,"beam")}function zd(a){function c(a,c,d){for(var e,f;!J.st_print[c];){if(J.staves[c].flags&d)return;c++}for(e=f=c;;){J.st_print[e]&&(f=e);if(J.staves[e].flags&d)break;e++}c=z[c].y+z[c].topbar*z[c].staffscale;f=z[f].y+z[f].botbar*z[f].staffscale;d&514?(a+=nc-6,d=T-f,c=(c-f)/24,G+='<text transform="translate('+a.toFixed(1)+","+d.toFixed(1)+") scale(2.5,"+
c.toFixed(2)+')">'+Sc.brace.c+"</text>\n"):(a+=nc-5,d=T-c-3,c=c-f+2,G+='<path d="m'+a.toFixed(1)+" "+d.toFixed(1)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+c.toFixed(1)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}var d,e,f=J.nstaff;for(d=e=0;;d++){var g=J.staves[d].flags;g&5&&e++;if(J.st_print[d])break;g&10&&e--;if(d==f)break}for(g=f;g>d&&!J.st_print[g];g--);if(d!=g||0!=e)for(e=z[g].y+z[g].botbar*z[g].staffscale,d=z[d].y+z[d].topbar*z[d].staffscale-e,Cb(a,e),G+="v"+(-d).toFixed(1)+
'"/>\n',d=0;d<=f;d++)g=J.staves[d].flags,g&1&&c(a,d,2),g&4&&c(a,d,8),g&256&&c(a-6,d,512),g&1024&&c(a-6,d,2048)}function Ad(a){if(a.a_meter){var c=z[a.st];var d=c.y;"|||||"!=c.stafflines&&(d+=(c.topbar+c.botbar)/2-12);for(c=0;c<a.a_meter.length;c++){var e=a.a_meter[c];var f=a.x+a.x_meter[c];e.bot?U('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',f,d+6,oc(e.top),oc(e.bot)):U('<text x="X" y="Y" text-anchor="middle">A</text>\n',f,d+12,oc(e.top))}}}
function Tc(a,c,d){if("object"==typeof d){var e=d[0],f=d[1];var g=e+"_"+f;d=Bd[g];d||(d=abc2svg.rat(Math.abs(e),f),f=d[1],d=(0>e?-d[0]:d[0]).toString(),1!=f&&(d+="_"+f),Bd[g]=d)}Q(a,c,"acc"+d)}function Oa(a,c,d,e,f){var g;0<=c?(g=a.hlu[c])||(g=a.hlu[c]=[]):(g=a.hld[-c])||(g=a.hld[-c]=[]);for(a=0;a<g.length&&!(d>=g[a][0]);a++);a==g.length?g.push([d,e,f]):d>g[a][0]?g.splice(++a,0,[d,e,f]):(e<g[a][1]&&(g[a][1]=e),f>g[a][2]&&(g[a][2]=f))}function Cd(a,c,d){c-=3;10>d?Q(a-4,c,"mtr"+d):(Q(a-10,c,"mtr"+(d/
10|0)),Q(a-2,c,"mtr"+d%10))}function af(a){var c;a.nflags=a.dur<2*n.BLEN?-2:a.dur<4*n.BLEN?-3:-4;a.dots=0;for(c=a.ts_next;c.time!=a.time+a.dur&&c.ts_next;)c=c.ts_next;var d=c.x-c.wl;for(c=a;!c.seqst;)c=c.ts_prev;c=c.ts_prev;d=(d+c.x+c.wr)/2;if(a.a_dd){c=d-a.x;var e,f=da.length;for(e=0;e<f;e++){var g=da[e];g.s==a&&(g.x+=c)}}a.x=d}function bf(a){var c,d,e=a;for(c=a.extra;c.next;)c=c.next;var f=c;if(d=(0<=c.stem||0>a.multi)&&28>=c.notes[0].pit||16>c.notes[0].pit){var g=127;for(c=a.extra;c;c=c.next)c.y<
g&&(g=c.y,f=c);c=f.x;g=f.y-5;a.extra!=f&&(c-=4,g+=1);a=a.next;var h=a.x-1;0>a.stem&&-2<a.nflags&&(h-=4);var m=3*(a.notes[0].pit-18)-5;var k=.4*(h-c);3<k&&(k=3);var r=k;var n=.2;var l=.8;g>m+7?(c=f.x-1,g+=.5,m+=6.5,h=a.x-5.5,k=.8*(g-m),r=.2*(g-m),n=0):m>g+4&&(m=g+4,c=f.x+2,g=f.y-4)}else{g=-127;for(c=a.extra;c;c=c.next)c.y>g&&(g=c.y,f=c);c=f.x;g=f.y+5;a.extra!=f&&(c-=4,--g);a=a.next;h=a.x-1;0<=a.stem&&-2<a.nflags&&(h-=2);m=3*(a.notes[a.nhd].pit-18)+5;k=.4*(c-h);-3>k&&(k=-3);r=k;n=.2;l=.8;g<m-7?(c=f.x-
1,g-=.5,m-=6.5,h=a.x-5.5,k=.8*(g-m),r=.2*(g-m),n=0):m<g-4&&(m=g-4,c=f.x+2,g=f.y+4)}e.slur={x0:c,y0:g,x1:n*h+(1-n)*c-c,y1:g-n*m-(1-n)*g+k,x2:l*h+(1-l)*c-c,y2:g-l*m-(1-l)*g+r,x3:h-c,y3:g-m};g-=e.slur.y1;c=e.extra;d?g<c.ymn&&(c.ymn=g):g>c.ymx&&(c.ymx=g)}function pc(a,c){var d,e=Array(a.nhd+1);var f=a.notes[0>a.stem?a.nhd:0];var g=a.x+f.shhd*E.scale;var h=z[a.st].y+3*(f.pit-18);f=z[a.st].y;if(a.dots){for(d=0;d<=a.nhd;d++){var m=3*(a.notes[d].pit-18);0==m%6&&(m=a.dot_low?m-3:m+3);e[d]=m}for(d=0;d<a.nhd;d++)if(!(e[d+
1]>e[d])){for(m=d;0<m&&!(e[m]>e[m-1]+6);)m--;if(3*(a.notes[m].pit-18)-e[m]<e[d+1]-3*(a.notes[d+1].pit-18))for(;m<=d;)e[m++]-=6;else e[d+1]=e[d]+6}}a.stemless?a.xstem&&(m=a.ts_prev,d=(0<m.stem?m.y:m.ys)-a.y,d+=z[m.st].y-f,Uc(g,h,d)):(d=a.ys-a.y,m=a.nflags,a.ntrem&&(m-=a.ntrem),!c||0>=m?(0<a.nflags&&(d=0<=a.stem?d-1:d+1),Uc(g,h,d,a.grace)):Uc(g,h,d,a.grace,m,a.fmt.straightflags));if(c&&a.trem1){c=a.ntrem||0;d=3*(a.notes[0<a.stem?a.nhd:0].pit-18);a.head==n.FULL||a.head==n.EMPTY?(g+=(a.grace?2.3:3.5)*
a.stem,d=0<a.stem?d+(6+5.4*c):d-11.4):d=0<a.stem?d+(5+5.4*c):d-10.4;d/=a.p_v.scale;for(U('<path d="mX Y\n\t',g-4.5,f+d);;){G+="l9 -3v3l-9 3z";if(0>=--c)break;G+="m0 5.4"}G+='"/>\n'}for(f=0;f<=a.nhd;f++){var k=void 0,r=void 0;g=a;var A=f;var l=e;c=!1;h=g.notes[A];d=z[g.st].y;m=g.x;var y=3*(h.pit-18),u=m+h.shhd*E.scale,v=y+d,p=ac(g,h.dur);var t=p[0];var q=p[1];p=p[2];if(!h.invis)if(g.grace)r="ghd",u-=4.5*E.scale;else if(h.map&&h.map[0])t=g.head,(r=h.map[0][t])||(r=h.map[0][h.map[0].length-1]),t=r.indexOf("/"),
0<=t&&(r=0<=g.stem?r.slice(0,t):r.slice(t+1));else if(g.type==n.CUSTOS)r="custos";else switch(t){case n.OVAL:r="HD";break;case n.OVALBARS:if(g.head!=n.SQUARE){r="HDD";break}case n.SQUARE:-4<p?r="breve":(r="longa",k=0<g.stem);ya||!g.next||g.next.type!=n.BAR||g.next.next||(q=0);u+=1;break;case n.EMPTY:r="Hd";break;default:r="hd"}void 0!=h.color&&(c=Xa(h.color));r&&(k&&(kb(u,v,0,1,-1),u=v=0),V.psxygl(u,v,r)||Q(u,v,r),k&&Db());if(q)for(k=m+(7.7+g.xmx)*E.scale,void 0==l[A]&&(l[A]=3*(g.notes[A].pit-18),
0==(g.notes[A].pit&1)&&(l[A]+=3)),A=l[A]+d,t=h.dur/12>>5-p-q;0<q--;)Q(k,A,t&1<<q?"dot":"dot+"),k+=3.5;h.acc&&(m-=h.shac*E.scale,g.grace?(kb(m,y+d,0,.75),Tc(0,0,h.acc),Db()):Tc(m,y+d,h.acc));0!=c&&Xa(c)}}function cf(a,c){var d;if(a.grace&&0<a.stem)return-1;var e=a.multi?a.multi:c.multi?c.multi:0;if(e)return e;for(;;a=a.next){if(a.type==n.NOTE){if(!a.stemless){if(0>a.stem)return 1;var f=!0}22>a.notes[0].pit&&(d=!0)}if(a.time==c.time)break}return f||d?-1:1}function Dd(a,c,d,e,f,g,h){var m=.3;var k=e-
c;0>k&&(k=-k);var r=d-a;40<r&&.7>k/r&&(m=.3+.002*(r-40),.7<m&&(m=.7));var n=.5*(a+d);k=.5*(c+e);var l=a+.45*(n+m*(a-n)-a);var y=c+.45*(k+m*(c-k)+g-c);n=d+.45*(n+m*(d-n)-d);m=e+.45*(k+m*(e-k)+g-e);k=2*f;g=.2+.001*r;.6<g&&(g=.6);g*=f;r*=.03;G=h?G+'<path class="stroke" stroke-dasharray="5,5" d="M':G+'<path d="M';Pa(a," ",c);G+="c"+((l-a)/E.scale).toFixed(1)+" "+(c-y).toFixed(1)+" "+((n-a)/E.scale).toFixed(1)+" "+(c-m).toFixed(1)+" "+((d-a)/E.scale).toFixed(1)+" "+(c-e).toFixed(1);h||(G+="\n\tv"+(-g).toFixed(1)+
"c"+((n-r-d)/E.scale).toFixed(1)+" "+(e+g-m-k).toFixed(1)+" "+((l+r-d)/E.scale).toFixed(1)+" "+(e+g-y-k).toFixed(1)+" "+((a-d)/E.scale).toFixed(1)+" "+(e-c).toFixed(1));G+='"/>\n'}function Ed(a,c,d){var e,f=d.ty,g=(f&7)==n.SL_ABOVE?1:-1;var h=a.length;var m=h-1,k=a[0],r=a[m];var l=1;var C=k.st;var y=!1;Ea(k.st);for(e=1;e<h;e++){var u=a[e];if(u.type==n.NOTE||u.type==n.REST)l++,u.st!=C&&(y=!0,u.st<C&&(C=u.st))}y&&x(2,k,"*** multi-staves slurs not treated yet");h=k.x;k.notes&&k.notes[0].shhd&&(h+=k.notes[0].shhd);
y=r.x;r.notes&&(y+=r.notes[0].shhd);c?(c=3*(c.pit-18)+2*g,h+=3):(c=0<g?k.ymx+2:k.ymn-2,k.type==n.NOTE&&(0<g?0<k.stem?(h+=5,k.beam_end&&-1<=k.nflags&&!k.in_tuplet?0<k.nflags?(h+=2,c=k.ys-3):c=k.ys-6:c=k.ys+3):c=k.y+8:0>k.stem?(--h,r.grace?c=k.y-8:k.beam_end&&-1<=k.nflags&&(!k.in_tuplet||k.ys<c+3)?0<k.nflags?(h+=2,c=k.ys+3):c=k.ys+6:c=k.ys-3):c=k.y-8));d.is_note?(d=3*(d.note.pit-18)+2*g,y-=3):(d=0<g?r.ymx+2:r.ymn-2,r.type==n.NOTE&&(0<g?0<r.stem?(y+=1,d=r.beam_st&&-1<=r.nflags&&!r.in_tuplet?r.ys-6:r.ys+
3):d=r.y+8:0>r.stem?(y-=5,d=r.beam_st&&-1<=r.nflags&&!r.in_tuplet?r.ys+6:r.ys-3):d=r.y-8));k.type!=n.NOTE&&(c=d+1.2*g,h=k.x+.5*k.wr,h>y-12&&(h=y-12));r.type!=n.NOTE&&(d=k.type==n.NOTE?c+1.2*g:c,k!=r&&(y=r.x-.3*r.wl));if(3<=l){u=a[1];if(u.type!=n.BAR&&u.x<h+48)if(0<g){var v=u.ymx-2;c<v&&(c=v)}else v=u.ymn+2,c>v&&(c=v);u=a[m-1];u.type!=n.BAR&&u.x>y-48&&(0<g?(v=u.ymx-2,d<v&&(d=v)):(v=u.ymn+2,d>v&&(d=v)))}var p=(d-c)/(y-h);if(.5<p||-.5>p)p=.5<p?.5:-.5,0<p*g?c=d-p*(y-h):d=c+p*(y-h);v=d-c;8<v?v=8:-8>v&&
(v=-8);e=v;0>e&&(e=-e);var t=.5*e;e=.3*v;0<v*g?(y-=t,d-=e):(h+=t,c+=e);k.grace&&(h=k.x-1.15);r.grace&&(y=r.x+2.3*1.5);t=0;p=(d-c)/(y-h);if(k!=r&&k.v==r.v){var q=c-p*h;for(e=1;e<m;e++)if(u=a[e],u.st==C)switch(u.type){case n.NOTE:case n.REST:0<g?(v=3*(u.notes[u.nhd].pit-18)+6,v<u.ymx&&(v=u.ymx),v-=p*u.x+q,v>t&&(t=v)):(v=3*(u.notes[0].pit-18)-6,v>u.ymn&&(v=u.ymn),v-=p*u.x+q,v<t&&(t=v));break;case n.GRACE:for(u=u.extra;u;u=u.next)0<g?(v=3*(u.notes[u.nhd].pit-18)+6,v<u.ymx&&(v=u.ymx),v-=p*u.x+q,v>t&&(t=
v)):(v=3*(u.notes[0].pit-18)-6,v>u.ymn&&(v=u.ymn),v-=p*u.x+q,v<t&&(t=v))}c+=.45*t;d+=.45*t;t*=.65}l=3<l?(.08*(y-h)+12)*g:(.03*(y-h)+8)*g;0<g?(l<3*t&&(l=3*t),40<l&&(l=40)):(l>3*t&&(l=3*t),-40>l&&(l=-40));v=d-c;0>v&&(v=-v);0<g?l<.8*v&&(l=.8*v):l>-.8*v&&(l=-.8*v);l*=k.fmt.slurheight;Dd(h,c,y,d,g,l,f&n.SL_DOTTED);p=(d-c)/(y-h);q=c-p*h;q=0<l?q+(4*Math.sqrt(l)-2):q-(4*Math.sqrt(-l)-2);for(e=0;e<m;e++)u=a[e],u.st==C&&u.type!=n.BAR&&(v=p*u.x+q,u.ymx<v?u.ymx=v:u.ymn>v&&(u.ymn=v),e==m-1?(t=y,r.sl1&&(t-=5),
e&&(v-=l/3)):t=a[e+1].x,0!=e?h=u.x:v-=l/3,t-=h,Y(C,0<g,h,t,v))}function Nb(a,c){function d(a,d,f){var g,h=[];var k=d.note.s;if(!(c&&k.time>c.time)){switch(d.loc){case "i":for(a=g=a.ts_prev;a;a=a.ts_prev)if(a.dur){if(a.v==k.v){g=a;break}a.st==k.st?g=a:g||(g=a)}else g||(g=a);a=g;break;case "o":for(g=a;g.ts_next;g=g.ts_next);for(k=g;g;g=g.ts_prev){if(g.v==a.v){k=g;break}g.st==a.st&&(k=g);if(g.ts_prev.time!=k.time)break}}if(ya&&k.time>=ya.time){if(k.grace&&k.time==ya.time){for(g=ya;g&&g.time==k.time&&
g.type!=n.GRACE;g=g.ts_next);g.type==n.GRACE&&(g=null)}if(!k.grace||k.time==ya.time||!g){a.p_v.sls.push(d);for(k=a.p_v.s_next.prev;k.next;)k=k.next;d=Object.create(d);d.note={s:k}}}switch(d.ty&7){case n.SL_ABOVE:g=1;break;case n.SL_BELOW:g=-1;break;default:g=a.v!=k.v?1:cf(a,k),d.ty&=-8,d.ty|=0<g?n.SL_ABOVE:n.SL_BELOW}var m=J.voices[a.v]&&J.voices[k.v]?0<g*(J.voices[a.v].range<=J.voices[k.v].range?1:-1)?a.v:k.v:a.v>k.v?a.v:k.v;if(!e||k.grace&&a.v==k.v&&a.time==k.time)h.push(a),a=a.grace?a.next:a.ts_next;
else{do h.push(a),a=a.next;while(a);a=e.next}if(k.grace){if(!a.grace){for(g=k;g.prev;)g=g.prev;for(;;){a.v==m&&h.push(a);if(a.extra==g)break;a=a.ts_next}a=g}for(;;){h.push(a);if(a==k)break;a=a.next}}else for(;a;){a.v==m&&h.push(a);if(a==k)break;a=a.ts_next}for(k=1;k<h.length-1;k++)a=h[k],(a.sls||a.sl1)&&Nb(a,c),a.tp&&Vc(a);Ed(h,f,d);return 1}}for(var e,f,g,h,m,k;;){if(!a||a==c){if(!e||!(a=e.next)||a==c)break;e=null}if(a.type==n.GRACE)e=a,a=a.extra;else{if(a.sls){m=a.sls;a.sls=null;k=[];for(f=0;f<
m.length;f++)d(a,m[f])||k.push(m[f]);k.length&&(a.sls=k)}if(a.sl1)for(g=0;g<=a.nhd;g++)if(h=a.notes[g],h.sls){m=h.sls;h.sls=null;k=[];for(f=0;f<m.length;f++)d(a,m[f],h)||k.push(m[f]);k.length&&(h.sls=k)}a=a.next}}}function Vc(a){var c,d,e,f,g=a.tp.shift();a.tp.length||delete a.tp;var h=a.st;Ea(a.st);for(c=a;c;c=c.next){switch(c.type){case n.GRACE:for(e=c.extra;e;e=e.next)(e.sls||e.sl1)&&Nb(e);default:continue;case n.NOTE:case n.REST:}(c.sls||c.sl1)&&Nb(c);c.st<h&&(h=c.st);c.tp&&Vc(c);if(c.tpe)break}c&&
c.tpe--;if(1!=g.f[0])if(c){e=g.f[3];if(!e){for(d=a;d&&!d.stem;)d=d.next;e=d&&0>d.stem?n.SL_BELOW:n.SL_ABOVE}if(a==c||2==g.f[1])var m=!0;else if(1==g.f[1])m=!0,Ed([a,c],null,{ty:e});else if(2!=g.f[0]&&a.type==n.NOTE&&c.type==n.NOTE){m=!0;for(d=a;;d=d.next){if(d.type!=n.NOTE&&d.type!=n.REST){if(d.type==n.GRACE||d.type==n.SPACE)continue;m=!1;break}if(d==c)break;if(d.beam_end){m=!1;break}}if(m&&!a.beam_st&&!a.beam_br1&&!a.beam_br2)for(d=a.prev;d;d=d.prev)if(d.type==n.NOTE||d.type==n.REST){d.nflags>=a.nflags&&
(m=!1);break}if(m&&!c.beam_end)for(d=c.next;d;d=d.next)if(d.type==n.NOTE||d.type==n.REST){!d.beam_br1&&!d.beam_br2&&d.nflags>=c.nflags&&(m=!1);break}}if(m){if(1!=g.f[2]){fa("tuplet");m=(c.x+a.x)/2;var k=e==n.SL_ABOVE?aa(h,1,m-4,8):aa(h,0,m-4,8)-H.curfont.size;0<a.stem*c.stem&&(m=0<a.stem?m+1.5:m-1.5);0==g.f[2]?ka(m,k,g.p.toString(),"c"):ka(m,k,g.p+":"+g.q,"c");for(d=a;!(d.x>=m);d=d.next);e==n.SL_ABOVE?(k+=H.curfont.size,d.ymx<k&&(d.ymx=k),Y(h,!0,m-3,6,k)):(d.ymn>k&&(d.ymn=k),Y(h,!1,m-3,6,k))}}else{var r=
a.x-4;if(c.dur>c.prev.dur){d=c.next;if(!d||d.time!=c.time+c.dur)for(d=c.ts_next;d&&!(d.seqst&&d.time>=c.time+c.dur);d=d.ts_next);var l=d?d.x-d.wl-5:ra-6}else l=c.x+4,m=0<=c.stem?0:c.nhd,0<c.notes[m].shhd&&(l+=c.notes[m].shhd),c.st==h&&0<c.stem&&(l+=3.5);if(e==n.SL_ABOVE){if(a.st==c.st)var C=f=z[h].topbar+2;else C=a.ymx,f=c.ymx;if(a.st==h){for(d=a;!d.dur;d=d.next);k=aa(h,1,d.x-4,8);k>C&&(C=k);0<a.stem&&(r+=3)}if(c.st==h){for(d=c;!d.dur;d=d.prev);k=aa(h,1,d.x-4,8);k>f&&(f=k)}m=.5*(r+l);k=.5*(C+f);var y=
(f-C)/(l-r);C=3*(c.notes[c.nhd].pit-a.notes[a.nhd].pit)/(l-r);0<C?0>y?y=0:y>C&&(y=C):0<y?y=0:y<C&&(y=C);y=a.fmt.beamslope*y/(a.fmt.beamslope+Math.abs(y));y*y<.1*.1&&(y=0);f=0;for(d=a;;d=d.next){if(d.dur&&d.st==h){var u=k+(d.x-m)*y;C=aa(h,1,d.x-4,8)+2;C-u>f&&(f=C-u)}if(d==c)break}k+=f;C=k+y*(r-m);f=k+y*(l-m);k+=6;for(d=a;d.st==h&&(u=k+(d.x-m)*y,d.ymx<u&&(d.ymx=u),Y(h,!0,d.x-3,6,u)),d!=c;d=d.next);}else{0>a.stem&&(r-=2);if(a.st==h){for(d=a;!d.dur;d=d.next);C=aa(h,0,d.x-4,8)}else C=0;if(c.st==h){for(d=
c;!d.dur;d=d.prev);f=aa(h,0,d.x-4,8)}else f=0;m=.5*(r+l);k=.5*(C+f);y=(f-C)/(l-r);C=3*(c.notes[0].pit-a.notes[0].pit)/(l-r);0<C?(0>y?y=0:y>C&&(y=C),.35<y&&(y=.35)):(0<y?y=0:y<C&&(y=C),-.35>y&&(y=-.35));y*y<.1*.1&&(y=0);f=0;for(d=a;d.dur&&d.st==h&&(u=k+(d.x-m)*y,C=aa(h,0,d.x-4,8),C-u<f&&(f=C-u)),d!=c;d=d.next);k+=f-8;C=k+y*(r-m);f=k+y*(l-m);k-=2;for(d=a;d.st==h&&(u=k+(d.x-m)*y,d.ymn>u&&(d.ymn=u),Y(h,!1,d.x-3,6,u)),d!=c;d=d.next);}1==g.f[2]?(h=f-C,u=e==n.SL_ABOVE?-3:3,e=(l-r)/E.scale,G+='<path class="stroke" d="m',
Pa(r," ",C+4+u),G+="v"+u.toFixed(1)+"l"+e.toFixed(1)+" "+(-h).toFixed(1)+"v"+(-u).toFixed(1)+'"/>\n'):(a=r,c=C,r=l-r,l=f-C,C=e==n.SL_ABOVE,f=0==g.f[2]?g.p.toString():g.p+":"+g.q,g=10*f.length,d=C?-3:3,fa("tuplet"),ka(a+r/2,c+l/2-.5*H.curfont.size+2,f,"c"),r/=E.scale,C||(c+=6),G+='<path class="stroke" d="m',Pa(a," ",c),C=r-g+1,g=0<l?g+l/8:g-l/8,G+="v"+d.toFixed(1)+"m"+r.toFixed(1)+" "+(-l).toFixed(1)+"v"+(-d).toFixed(1)+'"/>\n<path class="stroke" stroke-dasharray="'+(C/2).toFixed(1)+" "+g.toFixed(1)+
'" d="m',Pa(a," ",c-d),G+="l"+r.toFixed(1)+" "+(-l).toFixed(1)+'"/>\n',e==n.SL_ABOVE?Y(h,!0,m-3,6,u+2):Y(h,!1,m-3,6,u))}}else x(1,a,"No end of tuplet in this music line")}function qc(a,c,d){var e,f=2==d?a.pit:c.pit,g=(a.tie_ty&7)==n.SL_ABOVE?1:-1,h=a.s,m=h.st,k=c.s,r=k.x,l=a.shhd;for(e=0;e<h.nhd&&h.notes[e]!=a;e++);0<g?e<h.nhd&&f+1==h.notes[e+1].pit&&h.notes[e+1].shhd>l&&(l=h.notes[e+1].shhd):0<e&&f==h.notes[e-1].pit+1&&h.notes[e-1].shhd>l&&(l=h.notes[e-1].shhd);var C=h.x+l;if(2!=d){for(e=0;e<k.nhd&&
k.notes[e]!=c;e++);l=k.notes[e].shhd;0<g?e<k.nhd&&f+1==k.notes[e+1].pit&&k.notes[e+1].shhd<l&&(l=k.notes[e+1].shhd):0<e&&f==k.notes[e-1].pit+1&&k.notes[e-1].shhd<l&&(l=k.notes[e-1].shhd);r+=l}switch(d){default:if(f<c.pit||0>g)f=a.pit;break;case 3:g=-g;case 1:C=k.prev?k.prev.x+k.wr:h.x;h.st!=k.st&&(m=k.st);C+=.4*(r-C);C>r-20&&(C=r-20);break;case 2:r=h.next?h.next.x:ra,r!=ra&&(r-=.4*(r-C)),r<C+16&&(r=C+16)}20<r-C?(C+=3.5,r-=3.5):(C+=1.5,r-=1.5);!h.dots||a.pit&1||!(0<g&&!h.dot_low||0>g&&h.dot_low)||
(C+=5);c=z[m].y+3*(f-18)+g;Dd(C,c,r,c,g,(.03*(r-C)+16)*g*h.fmt.tieheight,a.tie_ty&n.SL_DOTTED)}function df(){function a(a,c){var d=ra/Ha,e=a.x/d|0,f=c.x/d|0,g=(a.ys-c.ys)/(a.xs-c.xs);c=a.ys-a.xs*g;var h=z[a.st];d*=g;if(0<a.stem)for(;e<=f;)a=d*e+c,h.top[e]<a&&(h.top[e]=a),e++;else for(;e<=f;)a=d*e+c,h.bot[e]>a&&(h.bot[e]=a),e++}var c,d,e,f=G;G="";Ha=Math.ceil(ra/2);for(c=0;c<=S;c++){var g=z[c];g.top=new Float32Array(Ha);g.bot=new Float32Array(Ha);for(d=0;d<Ha;d++)g.top[d]=0,g.bot[d]=24}for(d=0;d<F.length;d++){var h=
{},m=!0;c=F[d];for(g=c.sym;g;g=g.next)switch(g.type){case n.GRACE:var k=0;for(e=g.extra;e;e=e.next)e.beam_st&&!e.beam_end&&(V.calculate_beam(h,e),h.s2&&a(e,h.s2)),(e.sls||e.sl1)&&k++;g.p_v.ckey.k_bagpipe||!g.fmt.graceslurs||g.gr_shift||k||g.ti1||!g.next||g.next.type!=n.NOTE||bf(g)}for(g=c.sym;g;g=g.next)switch(g.type){case n.NOTE:if(g.beam_st&&!g.beam_end||m&&!g.beam_st)m=!1,V.calculate_beam(h,g),h.s2&&a(g,h.s2)}}ef();Ve();for(g=P;g;g=g.ts_next)if(!g.invis){switch(g.type){case n.GRACE:for(e=g.extra;e;e=
e.next)Y(g.st,!0,e.x-2,4,e.ymx+1),Y(g.st,!1,e.x-2,4,e.ymn-5);continue;case n.MREST:Y(g.st,!0,g.x+16,32,g.ymx+2);continue;default:Y(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx+2);Y(g.st,!1,g.x-g.wl,g.wl+g.wr,g.ymn-2);continue;case n.NOTE:}0<g.stem?(g.stemless?(c=-5,d=10):g.beam_st?(c=3,d=g.beam_end?4:10):(c=-8,d=g.beam_end?11:16),Y(g.st,!0,g.x+c,d,g.ymx),d=g.ymn,g.notes[0].acc&&d>3*(g.notes[0].pit-18)-9&&(d=3*(g.notes[0].pit-18)-9),Y(g.st,!1,g.x-g.wl,g.wl+g.wr,d)):(Y(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx),g.stemless?
(c=-5,d=10):g.beam_st?(c=-6,d=g.beam_end?4:10):(c=-8,d=g.beam_end?5:16),c+=g.notes[0].shhd,Y(g.st,!1,g.x+c,d,g.ymn));g.notes[g.nhd].acc&&(d=g.y+8,g.ymx<d&&(g.ymx=d),Y(g.st,!0,g.x,0,d));g.notes[0].acc&&(d=g.y,d=1==g.notes[0].acc||3==g.notes[0].acc?d-7:d-5,g.ymn>d&&(g.ymn=d),Y(g.st,!1,g.x,0,d))}We();for(d=0;d<F.length;d++)if(c=F[d],g=c.sym)for(Xa(g.color),c=c.st;g;g=g.next)g.play||(g.tp&&Vc(g),(g.sls||g.sl1)&&Nb(g));Xa();for(c=0;c<=S;c++)for(g=z[c],e=g.topbar+2,k=g.botbar-2,d=0;d<Ha;d++)e>g.top[d]&&
(g.top[d]=e),k<g.bot[d]&&(g.bot[d]=k);0<=p.measurenb&&Ze();Ea(-1);for(d=0;d<F.length;d++)if(c=F[d],c.have_ly){ff();break}Xe();Ea(-1);G=f}function gf(a,c){var d,e,f,g=[];for(d=c.length;0<=d&&!c[d];d--);if(!(0>d)){for(e=0;e<F.length;e++){var h=F[e];J.voices[e]&&(d=J.voices[e].st,c[d]&&H.vnt&&(f=2==H.vnt?h.nm:h.snm))&&(delete h.new_name,g[d]=g[d]?g[d]+("\n"+f):f)}if(g.length){fa("voice");var m=H.curfont.size;var k=m/2;a=.5*-a;for(d=0;d<g.length;d++)if(g[d])for(h=g[d].split("\n"),e=z[d].y+.5*z[d].topbar*
z[d].staffscale+k*(h.length-2),J.staves[d].flags&1&&d+1<z.length&&J.staves[d+1].flags&2&&!g[d+1]&&(e-=.5*(z[d].y-z[d+1].y)),c=0;c<h.length;c++)f=h[c],ka(a,e,f,"c"),e-=m}}}function hf(){var a,c,d,e,f=P.fmt;var g=J;for(c=0;c<F.length;c++){var h=F[c];1!=h.scale&&(h.scale_str='transform="scale('+h.scale.toFixed(2)+')"')}for(c=0;c<=S&&!H.st_print[c];c++);var m=0;c>S&&c--;h=z[c];for(a=0;a<Ha;a++){var k=h.top[a];m<k&&(m=k)}a=m;k=c;var r=0,l=0,C=z[k].topbar+8,y=0,u=1,v=-100;for(e=P;e;e=e.ts_next)if(e.type==
n.TEMPO&&!e.invis){d||(d=e);var t=e.tempo_wh[0];0==e.time&&40<e.x&&(e.x=40);var Lb=aa(k,!0,e.x-16,t);Lb>C&&(C=Lb);v>=e.x-16&&!(y&u>>1)&&(y|=u);u<<=1;v=e.x-16+t}if(d){Fa(-1);fa("tempo");l=H.curfont.size+8;Lb=2-l;var w=Lb-l;0!=y&&(l*=2);m<C+l&&(r=C+l-m);for(e=d;e;e=e.ts_next)if(e.type==n.TEMPO&&!e.invis){if(q.anno_start||q.anno_stop)e.wl=16,e.wr=30,e.ymn=y&1?w:Lb,e.ymx=e.ymn+14,pa(e);Fd(e,e.x-16,y&1?w:Lb);Mb(e);y>>=1}}C=z[k].topbar+6;for(e=P;e;e=e.ts_next)if((d=e.part)&&!d.invis){if(!Ja){var Ja=e;fa("parts");
w=H.curfont.size+2+2*H.curfont.pad}void 0==d.x&&(d.x=e.x-10);t=sa(d.text)[0];Lb=aa(k,!0,d.x,t+3);C<Lb&&(C=Lb)}if(Ja)for(Fa(-1),l+=w,m+r<C+l&&(r=C+l-m),e=Ja;e;e=e.ts_next)if((d=e.part)&&!d.invis){if(q.anno_start||q.anno_stop)d.type=n.PART,d.p_v=e.p_v,d.v=e.v,d.st=d.wl=0,d.wr=sa(d.text)[0],d.ymn=-l,d.ymx=d.ymn+w,pa(d);ka(d.x,2-l,d.text);Mb(d)}m=a+r/z[0].staffscale;m*=h.staffscale;w=.5*f.staffsep+h.topbar*h.staffscale;m<w&&(m=w);m<h.ann_top&&(m=h.ann_top);h.y=-m;for(Ja=0;Ja<c;Ja++)z[Ja].y=-m;if(!H.st_print[c])return m;
d=g.staves[Ja];for(c++;c<=S;c++)if(H.st_print[c]){h=z[c];w=d.sep||p.sysstaffsep;e=d.maxsep||p.maxsysstaffsep;d=0;if(h.staffscale==z[Ja].staffscale){for(a=0;a<Ha;a++)k=h.top[a]-z[Ja].bot[a],d<k&&(d=k);d*=h.staffscale}else for(a=0;a<Ha;a++)k=h.top[a]*h.staffscale-z[Ja].bot[a]*z[Ja].staffscale,d<k&&(d=k);w+=h.topbar*h.staffscale;d<w&&(d=w);e+=h.topbar*h.staffscale;d>e&&(d=e);m+=d;for(h.y=-m;!H.st_print[++Ja];)z[Ja].y=-m;for(;!(d=g.staves[Ja]);)g=g.next}for(a=g=0;a<Ha;a++)k=z[Ja].bot[a],g>k&&(g=k);g>
h.ann_bot&&(g=h.ann_bot);g*=z[Ja].staffscale;for(c=0;c<=S;c++)h=z[c],d=h.y,1!=h.staffscale&&(h.scale_str='transform="translate(0,'+(T-d).toFixed(1)+") scale("+h.staffscale.toFixed(2)+')"');if(0==g){for(c=S;0<=c&&!H.st_print[c];c--);if(0>c)return m}d=-g;w=.5*f.staffsep;d<w&&(d=w);e=.5*f.maxstaffsep;d>e&&(d=e);return m+d}function jf(a){function c(){var a,c=0;for(a=0;a<=J.nstaff;a++)if(0>h[a])k[a]=r[a]=0;else{var d=z[a].staffscale;var e=z[a].topbar*d;d*=z[a].botbar;0==c&&(c=z[a].y+e);k[a]=z[a].y+d;r[a]=
c-k[a];c=J.staves[a].flags&64?0:k[a]}}function d(a,c,d){var e,f,g=0,h="",k=z[a].stafflines,m=k.length,n=6*z[a].staffscale;if(/[\[|]/.test(k)){d-=c;Fa(-1);var r=d/z[a].staffscale;if(rc&&rc.st_l==k&&rc.st_ws==(r|0))Q(c,z[a].y,"stdef"+p.fullsvg);else{for(e=0;e<m;e++,g-=n)if("."!=k[e]){for(f=0;e<m;e++,g-=n,f-=n){switch(k[e]){case ".":case "-":continue;case l:h+="m-"+d.toFixed(1)+" "+f+"h"+d.toFixed(1);f=0;continue}void 0!=l&&(h+='"/>\n');var l=k[e];h+='<path class="'+("["==l?"slthW":"slW")+'" d="m0 '+
g+"h"+d.toFixed(1);f=0}h+='"/>'}g=z[a].y;!rc&&d>bc()-10?(rc={st_l:k,st_ws:r|0},e="stdef"+p.fullsvg,0>h.indexOf("<path",1)?lb[e]=h.replace("path",'path id="'+e+'"'):lb[e]='<g id="'+e+'">\n'+h+"\n</g>",Q(c,g,e)):U('<g transform="translate(X, Y)">\n'+h+"\n</g>\n",c,g)}}}function e(a){var c=z[a.st],d=5-a.nflags,e=a.x;a=a.y;if(!(6>d)){7==d&&12==a&&2>=c.stafflines.length&&(a-=6);a/=6;switch(d){default:switch(c.stafflines[a+1]){case "|":case "[":break;default:Oa(c,a+1,e,-7,7)}9==d&&a--;break;case 7:a++;
case 6:}switch(c.stafflines[a]){case "|":case "[":break;default:Oa(c,a,e,-7,7)}}}var f,g,h=[],m=[],k=[],r=[],l=[],C="",y="";for(g=0;g<=S;g++)h[g]=J.st_print[g]?0:-1,m[g]=J.st_print[g];c();zd(0);for(f=P;f;f=f.ts_next)switch(f.type){case n.STAVES:var u=f.sy;for(g=0;g<=S;g++){var v=h[g];if(0>v)u.st_print[g]&&(h[g]=f.ts_prev.bar_type?f.ts_prev.x:f.ts_next.bar_type?f.x:f.ts_prev.x+f.ts_prev.wr,m[g]=!0);else if(!u.st_print[g]||u.staves[g].stafflines!=J.staves[g].stafflines){if(f.ts_prev.bar_type)var t=
f.ts_prev.x;else t=(f.ts_prev.x+f.x)/2,h[g]=-1;d(g,v,t);h[g]=u.st_print[g]?t:-1}}J=u;c();continue;case n.BAR:if(f.invis||!f.bar_type||!J.st_print[f.st])break;if(f.second&&(!f.ts_prev||f.ts_prev.type==n.BAR&&f.ts_prev.st==f.st))break;l.push([f,k[f.st],r[f.st]]);break;case n.STBRK:if(J.voices[f.v]&&0==J.voices[f.v].range&&14<f.xmx){for(v=g=0;v<F.length;v++)J.voices[v]&&0<J.voices[v].range&&g++;for(t=f.ts_next;t&&t.type==n.STBRK;t=t.ts_next)g--;0==g&&zd(f.x)}g=f.st;v=h[g];0<=v&&(t=f.prev)&&(t=t.type==
n.BAR?t.x:f.x-f.xmx,v>=t||(d(g,v,t),h[g]=f.x));break;case n.GRACE:for(t=f.extra;t;t=t.next)V.draw_hl(t);break;case n.NOTE:f.invis||V.draw_hl(f);break;case n.REST:(f.fmr||f.rep_nb&&0<=f.rep_nb)&&af(f),f.invis||e(f)}for(g=0;g<=S;g++)v=h[g],0>v||v>=ra||d(g,v,ra);kf();(function(){var a,c,d=l.length;fa("annotation");if(c=H.curfont.box)H.curfont.box=0;for(a=0;a<d;a++){var e=l[a];var f,g,h=e[0],k=e[1],m=e[2],r=h.bar_type,u=h.st,A=z[u],p=h.x;0!=u&&h.ts_prev&&h.ts_prev.type!=n.BAR&&(m=A.topbar*A.staffscale);
h.ymx=h.ymn+m;Fa(-1);pa(h);h.color&&Xa(h.color);e=A.y+12;"|||||"!=A.stafflines&&(e+=(A.topbar+A.botbar)/2-12);if(h.bar_mrep){Fa(u);if(1==h.bar_mrep){for(f=h.prev;f.type!=n.REST;f=f.prev);Q(f.x,e,"mrep")}else Q(p,e,"mrep2"),h.v==J.top_voice&&Cd(p,e+A.topbar,h.bar_mrep);Fa(-1)}"||:"==r&&(r="[|:");for(g=r.length;0<=--g;){switch(r[g]){case "|":h.bar_dotted?(f=(5*A.staffscale).toFixed(1),U('<path class="bW" stroke-dasharray="A,A" d="MX Yv-G"/>\n',p,k,f,m)):h.color?U('<path class="bW" d="MX Yv-F"/>\n',
p,k,m):C+="M"+Ya(p).toFixed(1)+" "+V.sy(k).toFixed(1)+"v-"+m.toFixed(1);break;default:p-=3;h.color?U('<path class="bthW" d="MX Yv-F"/>\n',p+1.5,k,m):y+="M"+Ya(p+1.5).toFixed(1)+" "+V.sy(k).toFixed(1)+"v-"+m.toFixed(1);break;case ":":p-=2,Fa(u),Q(p+1,e-12,"rdots"),Fa(-1)}p-=3}Xa();Mb(h)}c&&(H.curfont.box=c);Fa(-1);C&&(G+='<path class="bW" d="'+C+'"/>\n');y&&(G+='<path class="bthW" d="'+y+'"/>\n')})();gf(a,m)}function ef(){var a,c,d,e;for(a=0;a<F.length;a++){var f=F[a];if(f=f.sym)if(f=f.next){var g=
void 0;for(e=f;e;e=e.next)if(e.ti1){var h=c=0;var m=128;for(d=0;d<=e.nhd;d++)e.notes[d].tie_ty&&(c++,128>m&&e.notes[d].pit<=m+1&&h++,m=e.notes[d].pit,g=e.notes[d].tie_e);m=g&&0>e.stem*g.stem?22<=m?n.SL_ABOVE:n.SL_BELOW:e.multi?0<e.multi?n.SL_ABOVE:n.SL_BELOW:0>e.stem?n.SL_ABOVE:n.SL_BELOW;if(e.multi)for(d=0;d<=e.nhd;d++)h=e.notes[d].tie_ty,(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|m);else if(1>=c)for(d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty){(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|
m);break}}else if(h){m=128;for(d=0;d<=e.nhd;d++)if(e.notes[d].tie_ty){if(128>m&&e.notes[d].pit<=m+1){c=d;break}m=e.notes[d].pit}m=n.SL_BELOW;for(d=0;d<=e.nhd;d++)if(h=e.notes[d].tie_ty)c==d&&(m=n.SL_ABOVE),(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|m)}else if(c&1)for(c=(c-1)/2,m=n.SL_BELOW,d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty)0==c&&22<=e.notes[d].pit&&(m=n.SL_ABOVE),(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|m),0==c--&&(m=n.SL_ABOVE)}else for(c/=2,m=n.SL_BELOW,d=0;d<=e.nhd;d++)if(h=
e.notes[d].tie_ty)(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|m),0==--c&&(m=n.SL_ABOVE)}for(;f;f=f.next)if(f.ti1&&(20>f.notes[0].pit&&f.notes[0].tie_ty&&(f.notes[0].tie_ty&7)==n.SL_BELOW||24<f.notes[f.nhd].pit&&f.notes[f.nhd].tie_ty&&(f.notes[f.nhd].tie_ty&7)==n.SL_ABOVE)){for(g=f.next;g&&g.type!=n.NOTE;)g=g.next;if(g){if(g.st!=f.st)continue;c=g.x-f.x-10}else c=ra-f.x-10;e=100>c?9:300>c?12:16;24<f.notes[f.nhd].pit&&(d=3*(f.notes[f.nhd].pit-18)+e,f.ymx<d&&(f.ymx=d),g&&g.ymx<d&&(g.ymx=d),Y(f.st,
!0,f.x+5,c,d));20>f.notes[0].pit&&(d=3*(f.notes[0].pit-18)-e,f.ymn>d&&(f.ymn=d),g&&g.ymn>d&&(g.ymn=d),Y(f.st,!1,f.x+5,c,d))}}}}function Eb(a){return!a||!/^(0|n|f)/i.test(a)}function Gd(a){var c=Hd[a.fname||a.name];c||(c=1.1);a.swfac=a.size*c}function Kb(a,c){var d;if("-"==a[a.length-2]){a=a[a.length-1];if("1">a||"9"<a)return;a="u"+a+"font"}var e=(e=p[a])?{name:e.name,size:e.size,box:e.box,pad:e.pad||0}:{pad:0};p[a]=e;if(d=c.match(/\s+(no)?box(\s|$)/))d[1]?(e.box=!1,e.pad=0):(e.box=!0,e.pad=.4*e.size-
3),c=c.replace(d[0],d[2]);if(d=c.match(/\s+padding=([\d.]+)(\s|$)/))e.pad=d[1]?+d[1]:0,c=c.replace(d[0],d[2]);if(d=c.match(/\s+class=(.*?)(\s|$)/))e.class=d[1],c=c.replace(d[0],d[2]);if(d=c.match(/\s+wadj=(.*?)(\s|$)/)){if("undefined"==typeof document)switch(d[1]){case "none":e.wadj="";break;case "space":e.wadj="spacing";break;case "glyph":e.wadj="spacingAndGlyphs";break;default:w(1,I.bad_val,"%%"+a)}c=c.replace(d[0],d[2])}if(d=c.match(/\s+([0-9.]+|\*)$/))"*"!=d[1]&&(e.size=+d[1]),c=c.replace(d[0],
"");e.fname=c;if("u"==c[0]&&"url("==c.slice(0,4)){a=c.indexOf(")",1);if(0>a){w(1,"No end of url in font family");return}c=c.slice(0,a+1);e.src=c;e.fid=Fb.length;Fb.push(e);e.normal=!0;c="ft"+e.fid}else{if('"'==c[0]){a=c.indexOf('"',1);if(0>a){w(1,"No end of string in font family");return}c=c.slice(1,a)}if(d=c.match(/[- ]?[nN]ormal/))e.normal=!0,c=c.replace(d[0],"");if(d=c.match(abc2svg.ft_re))e.weight=abc2svg.ft_w[d[0].replace(/[ -]/,"").toLowerCase()],c=c.replace(d[0],"");if(d=c.match(/[- ]?[iI]talic/))e.style=
"italic",c=c.replace(d[0],"");if(d=c.match(/[- ]?[oO]blique/))e.style="oblique",c=c.replace(d[0],"");c=c.trim();switch(c){case "":case "*":return;case "Times-Roman":case "Times":c="serif";break;case "Helvetica":c="sans-serif";break;case "Courier":c="monospace";break;case "music":c=p.musicfont.name;break;default:0<c.indexOf("Fig")&&(e.figb=!0)}}e.name=c;e.size?Gd(e):e.swfac=0}function Qa(a){a=a.toLowerCase().match(/(-?[\d.]+)(.*)/);if(!a)return NaN;a[1]=+a[1];switch(a[2]){case "cm":return 37.8*a[1];
case "in":return 96*a[1];case "pt":return.75*a[1];case "px":case "":return a[1]}return NaN}function Id(a){var c=a.indexOf(" ");0<c&&(a=a.slice(0,c));return lf[a]}function Jd(a,c){a=a.slice(0,3);"ste"==a&&(a="stm");sc("pos",'"'+a+" "+c+'"')}function sc(a,c){a=[a+"=",c];3>t.state?cc(l?l.id:"*",a):l?Wc(a):cc("*",a)}function Ra(){Z.chg&&(Z.chg=!1,Z.lm=p.leftmargin-p.printmargin,0>Z.lm&&(Z.lm=0),Z.rm=p.rightmargin-p.printmargin,0>Z.rm&&(Z.rm=0),Z.width=p.pagewidth-2*p.printmargin,100>Z.width-Z.lm-Z.rm&&
(x(0,void 0,"Bad staff width"),Z.width=Z.lm+Z.rm+150),nc=Z.lm/p.scale)}function Kd(a){var c=a.name,d="";a.weight&&(d+=a.weight+" ");a.style&&(d+=a.style+" ");0>c.indexOf('"')&&0<c.indexOf(" ")&&(c='"'+c+'"');return d+a.size.toFixed(1)+"px "+c}function Xc(a){return"font:"+Kd(a)}function db(a){var c="f"+a.fid+p.fullsvg;a.class&&(c+=" "+a.class);a.box&&(c+=" box");return c}function Gb(a){a.used||(a.used=!0,void 0==a.fid&&(a.fid=Fb.length,Fb.push(a),a.swfac||Gd(a),a.pad||(a.pad=0)),Yc(".f"+a.fid+(p.fullsvg||
"")+"{"+Xc(a)+"}"),a.src&&Yc("@font-face{\n font-family:"+a.name+";\n src:"+a.src+"}"),a==p.musicfont&&Yc(".f"+a.fid+(p.fullsvg||"")+" text,tspan{white-space:pre}"))}function ma(a){a+="font";var c=p[a];if(!c)return w(1,"Unknown font $1",a),H.curfont;if(!c.name||!c.size){a=Object.create(H.deffont);c.name&&(a.name=c.name);c.normal?(a.weight&&(a.weight=null),a.style&&(a.style=null)):(c.weight&&(a.weight=c.weight),c.style&&(a.style=c.style));c.src&&(a.src=c.src);c.size&&(a.size=c.size);var d=Kd(a);c.class&&
(a.class=c.class,d+=" "+c.class);c=Ld[d];if(void 0!=c)return Fb[c];Ld[d]=Fb.length;a.fid=a.used=void 0;c=a}Gb(c);return c}function Ob(a,c){var d,e,f="";for(d=0;;){var g=a.indexOf("\\",d);if(0>g)break;f+=a.slice(d,g);d=a[++g];if(!d)return f+"\\";switch(d){case "0":case "2":if("0"!=a[g+1])break;if(e=mf[a[g+2]]){f+=e;d=g+3;continue}break;case "u":d=Number("0x"+a.slice(g+1,g+5));if(isNaN(d)||32>d){f+=a[++g]+"\u0306";d=g+1;continue}d=String.fromCharCode(d);if("\\"==d){g+=4;break}f+=d;d=g+5;continue;case "t":f+=
"\t";d=g+1;continue;case "n":f+="\n";d=g+1;continue;default:if(e=nf[a.slice(g,g+2)]){f+=e;d=g+2;continue}if((e=a[g+1])&&/[A-Za-z]/.test(e))switch(d){case "`":f+=e+"\u0300";d=g+2;continue;case "'":f+=e+"\u0301";d=g+2;continue;case "^":f+=e+"\u0302";d=g+2;continue;case "~":f+=e+"\u0303";d=g+2;continue;case "=":f+=e+"\u0304";d=g+2;continue;case "_":f+=e+"\u0305";d=g+2;continue;case ".":f+=e+"\u0307";d=g+2;continue;case '"':f+=e+"\u0308";d=g+2;continue;case "o":f+=e+"\u030a";d=g+2;continue;case "H":f+=
e+"\u030b";d=g+2;continue;case "v":f+=e+"\u030c";d=g+2;continue;case "c":f+=e+"\u0327";d=g+2;continue;case ";":f+=e+"\u0328";d=g+2;continue}}"w"==c&&(f+="\\");f+=d;d=g+1}return f+a.slice(d)}function of(a){var c;if(q.read_file)if(2<mb)w(1,"Too many include levels");else if(c=q.read_file(a)){mb++;var d=B(t);Zc(a,c);d.state=t.state;t=d;mb--}else w(1,"Cannot read file '$1'",a);else w(1,"No read_file support")}function Zc(a,c,d,e){function f(){var a=c.indexOf("K:",d);if(0>a)return!1;a=c.indexOf("\n",a);
if(t.select.test(c.slice(t.bol,a)))return!0;var f=/\n\w*\n/;f.lastIndex=a;C=f.exec(c)?f.lastIndex:e;return!1}function g(a,c){if(!a)return a;var d=a.indexOf("%");if(0==d)return"";0<d&&(a=a.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%"));a=a.replace(/\s+$/,"");return c&&0<=a.indexOf("\\")?Ob(a,c):a}function h(){var a;la.length&&(w(1,"Decoration without symbol"),la=[]);t.tp&&(w(1,"No end of tuplet"),(a=t.tps)&&delete a.tp,delete t.tp);ea&&(w(1,"No end of voice overlay"),Hb(ea.bar?"|":")"));$c();var c,
d=F.length,e=[],f=[];var g=J;var h=g.top_voice;var k=F[h];var m={type:n.STAVES,dur:0,v:h,p_v:k,time:0,st:0,sy:g,next:k.sym,seqst:!0};if(k.sym){m.fmt=c=k.sym.fmt;for(h=0;h<d;h++)a=F[h].sym,e[h]=a,g.voices[h]&&(f[g.voices[h].range]=h);k.sym=P=a=m;a.next?a.next.prev=a:k.last_sym=a;if(a=ha.tempo)a.v=h=k.v,a.p_v=k,a.st=0,a.time=0,a.prev=m,a.next=m.next,a.next?a.next.prev=a:k.last_sym=a,a.prev.next=a,a.fmt=c,ha.tempo=null,e[h]=a;for(;;){if(r){g=r;var r=null;f=[];for(h=0;h<d;h++)g.voices[h]&&(f[g.voices[h].range]=
h)}g=c=1E7;for(k=0;;){h=f[k++];if(void 0==h)break;!(a=e[h])||a.time>c||(h=Ka[a.type],a.time<c?(c=a.time,g=h):h<g&&(g=h))}if(127<g)break;for(k=0;;){h=f[k++];if(void 0==h)break;if((a=e[h])&&a.time==c&&Ka[a.type]==g){if(a.type==n.STAVES)r=a.sy;else if(a.type==n.SM){(a.next.prev=a.prev)?a.prev.next=a.next:a.p_v.sym=a.next;e[h]=a.next;continue}if(l){var l=0;a.seqst=!0}a.ts_prev=m;m=m.ts_next=a;e[h]=a.next}}l=g}}if(P){q.anno_start&&(pa=pf);q.anno_stop&&(Mb=qf);V.set_bar_num();for(r=F.length;0<=--r;)if(a=
F[r],void 0!=a.vtransp)for(a.key.k_transp?(l=a.key,Md(l),l.k_old_sf=l.k_sf):l=null,a=a.sym;a;){if(!l)for(;a&&(a.type!=n.KEY||!a.k_transp);a=a.next);for(;a;a=a.next){switch(a.type){case n.GRACE:for(e=a.extra;e;e=e.next)for(d=0;d<=e.nhd;d++)Nd(e,l,e.notes[d]);continue;case n.NOTE:case n.REST:for(d=0;d<=a.nhd;d++)Nd(a,l,a.notes[d]);if(a.a_gch)for(e=a,f=l,m=e.a_gch.length;0<=--m;)d=e.a_gch[m],"g"==d.type&&(d.text=Od(d.text,f.k_transp));continue;case n.KEY:l&&(a.k_sf=l.k_sf);Md(a);if(!a.k_transp)break;
l=a;default:continue}break}l=null}N.P&&(P.parts=N.P);if(t.ctrl)for(var u in t.ctrl){r=t.ctrl[u];for(l=P;l.next&&l.next.time<u;)l=l.next;for(;l&&l.time<u;)l=l.ts_next;if(l){for(;l.time==u&&l.ts_next&&!l.dur;)l=l.ts_next;r.part&&(l.part=r.part);r.tempo&&(Ic(r.tempo,l),Pb(r.tempo,l))}}q.get_abcmodel&&q.get_abcmodel(P,F,abc2svg.sym_name,N);q.img_out&&V.output_music()}Ra();N.W&&rf(N.W);l=p.infoname.split("\n");r=l.length;for(u=0;u<r;u++)if(a=l[u][0],!(0>p.writefields.indexOf(a))&&(a=N[a])){if(!A){var A=
!0;fa("history");ia(p.textspace);var C=H.curfont.size*p.lineskipfac}e=l[u].slice(2);'"'==e[0]&&(e=e.slice(1,-1));ia(C);d=sa(e);ka(0,0,e,null,null,d);e=d[0];a=a.split("\n");ka(e,0,a[0]);for(d=1;d<a.length;d++)ia(C),ka(e,0,a[d]);ia(.3*C);Gb(H.curfont)}t.state=0;ab();P&&(ad.push([P,F,N,p]),P=null);p=Ba.cfmt;N=Ba.info;za=Ba.char_tb;ha=Ba.glovar;eb=Ba.maps;nb=Ba.mac;Ac=Ba.maci;t.tune_v_opts=null;t.scores=null;t.ufmt=!1;delete t.ctrl;Pd();Z.chg=!0;Ra()}function m(a,d){if("end"!=a){d?(t.tune_v_opts||(t.tune_v_opts=
{}),d=t.tune_v_opts):(t.voice_opts||(t.voice_opts={}),d=t.voice_opts);for(d[a]=[];;){var e=++C;if("%"!=c[e])break;C=c.indexOf("\n",C);if(c[e+1]==u){e+=2;x=0>C?c.slice(e):c.slice(e,C);r=x.match(/\S+/);switch(r[0]){default:d[a].push(g(x,!0));continue;case "score":case "staves":case "tune":case "voice":e-=2}break}}C=t.eol=e-1}}function k(){var a,e=c.indexOf("K:",d);e=c.indexOf("\n",e);var f=c.slice(t.bol,e);for(e in t.tune_opts)if(t.tune_opts.hasOwnProperty(e)&&(new RegExp(e)).test(f)){var g=t.tune_opts[e];
for(a=0;a<g.t_opts.length;a++){var h=g.t_opts[a];switch(h.match(/\S+/)[0]){case "score":case "staves":t.scores||(t.scores=[]);t.scores.push(h);break;default:V.do_pscom(h)}}if(g=g.v_opts)for(a in g)g.hasOwnProperty(a)&&(t.tune_v_opts||(t.tune_v_opts={}),t.tune_v_opts[a]=t.tune_v_opts[a]?t.tune_v_opts[a].concat(g[a]):g[a])}}var r,l="\n";abc2svg.modules&&(abc2svg.modules.hooks.length||abc2svg.modules.g_hooks.length)&&sf();t.file=c;t.fname=a;void 0==d&&(d=0);e||(e=c.length);for("%abc-"==c.slice(d,d+5)&&
(p["abc-version"]=/[1-9.]+/.exec(c.slice(d+5,d+10)));d<e;d=t.eol+1){var C=c.indexOf("\n",d);if(0>C||C>e)C=e;for(t.eol=C;;){C--;switch(c[C]){case " ":case "\t":continue}break}C++;if(C==d)1==t.state?(t.istart=d,w(1,"Empty line in tune header - ignored")):2<=t.state&&(h(),t.state=0,t.select&&(C=c.indexOf("\nX:",t.eol),0>C&&(C=e),t.eol=C));else{t.istart=t.bol=d;t.iend=C;t.line.index=0;var y=c[d];var u=c[d+1];if("%"==y){if(0>t.prefix.indexOf(u))continue;if("a"==c[d+2]&&"b"==c[d+3]&&"c"==c[d+4]&&" "==c[d+
5])d+=6,y=c[d],u=c[d+1];else var v=!0}else"I"==y&&":"==u&&(v=!0);if(v){v=!1;d+=2;var x=c.slice(d,C);if((r=x.match(/([^\s]+)\s*(.*)/))&&"%"!=r[1][0]){switch(r[1]){case "abcm2ps":case "ss-pref":t.prefix=r[2];continue;case "abc-include":of(g(r[2]));continue}if("begin"==r[1].slice(0,5)){a=r[1].substr(5);var z="\n"+y+u+"end"+a;y=c.indexOf(z,C);0>y?(w(1,"No $1 after %%$2",z.slice(1),r[1]),t.eol=e):(V.do_begin_end(a,g(r[2]),c.slice(C+1,y).replace(/\n%[^%].*$/gm,"").replace(/^%%/gm,"")),t.eol=c.indexOf("\n",
y+6),0>t.eol&&(t.eol=e))}else{switch(r[1]){case "select":if(0!=t.state){w(1,I.not_in_tune,"%%select");continue}a=g(x.slice(7));'"'==a[0]&&(a=a.slice(1,-1));if(!a){delete t.select;continue}a=a.replace(/\(/g,"\\(");a=a.replace(/\)/g,"\\)");t.select=new RegExp(a,"m");continue;case "tune":if(0!=t.state){w(1,I.not_in_tune,"%%tune");continue}a=g(r[2]);if(!a){t.tune_opts={};continue}if("end"==a)continue;t.tune_opts||(t.tune_opts={});for(t.tune_opts[a]=a={t_opts:[]};;){d=++C;if("%"!=c[d])break;C=c.indexOf("\n",
C);if(c[d+1]==u){d+=2;x=0>C?c.slice(d):c.slice(d,C);r=x.match(/([^\s]+)\s*(.*)/);switch(r[1]){case "tune":break;case "voice":m(g(r[2],!0),!0);continue;default:a.t_opts.push(g(x,!0));continue}break}}t.tune_v_opts&&(a.v_opts=t.tune_v_opts,t.tune_v_opts=null);t.eol=d-1;continue;case "voice":if(0!=t.state){w(1,I.not_in_tune,"%%voice");continue}a=g(r[2]);if(!a){t.voice_opts=null;continue}m(a);continue}V.do_pscom(g(x,!0))}}}else if(":"==u&&/[A-Za-z+]/.test(y)){for(d+=2;;){switch(c[d]){case " ":case "\t":d++;
continue}break}if("+"==y){if(!D){w(1,"+: without previous info field");continue}l=" ";y=D}x=g(c.slice(d,C),y);switch(y){case "X":if(0!=t.state){w(1,I.ignored,y);continue}if(t.select&&!f()){C=c.indexOf("\nX:",t.eol);0>C&&(C=e);t.eol=C;continue}Ba.cfmt=B(p);Ba.info=B(N,2);Ba.char_tb=B(za);Ba.glovar=B(ha);Ba.maps=B(eb,1);Ba.mac=B(nb);Ba.maci=B(Ac);N.X=x;t.state=1;q.page_format&&1>Ma&&(Ma=1);t.tune_opts&&k();continue;case "T":switch(t.state){case 0:continue;case 1:case 2:N.T=void 0==N.T?x:N.T+("\n"+x);
continue}a=Za("title");a.text=x;continue;case "K":switch(t.state){case 0:continue;case 1:N.K=x}bd(y,x);continue;case "W":if(0==t.state||0>p.writefields.indexOf(y))break;N.W=void 0==N.W?x:N.W+(l+x);break;case "m":if(2<=t.state){w(1,I.ignored,y);continue}r=x.match(/(.*?)[= ]+(.*)/);if(!r||!r[2]){w(1,I.bad_val,"m:");continue}nb[r[1]]=r[2];Ac[r[1][0]]=!0;break;case "s":if(3!=t.state||0>p.writefields.indexOf(y))break;tf(x," "==l);break;case "w":if(3!=t.state||0>p.writefields.indexOf(y))break;uf(x," "==
l);break;case "|":if(2>t.state)continue;t.line.buffer=x;Qd();continue;default:if(0<="ABCDFGHNOSZ".indexOf(y)){if(2<=t.state){w(1,I.ignored,y);continue}N[y]=N[y]?N[y]+(l+x):x}else{bd(y,x);continue}}l="\n";var D=y}else D=void 0,2>t.state||(t.line.buffer=g(c.slice(d,C)),t.line.buffer&&Qd())}}mb||(2<=t.state&&h(),t.state=0)}function ac(a,c){var d,e=0,f=c;0!=f%12&&x(1,a,"Invalid note duration $1",f);(f/=12)||x(1,a,"Note too short");for(d=5;f&&!(f&1);f>>=1,d--);f>>=1;for(f+1&f&&(a.type!=n.REST||c!=a.p_v.wmeasure)&&
x(0,a,"Non standard note duration $1",c);0<f>>e;)e++;d-=e;if(0<=d)a=n.FULL;else switch(d){default:x(1,a,"Note too long"),d=-4;case -4:a=n.SQUARE;break;case -3:a=a.fmt.squarebreve?n.SQUARE:n.OVALBARS;break;case -2:a=n.OVAL;break;case -1:a=n.EMPTY}return[a,e,d]}function Rd(a){var c,d=a.stem;if(c=a.nhd){var e=.74*Sd[a.head];a.grace&&(e*=.6);if(0<=d){var f=1;var g=c+1;c=a.notes[0].pit}else e=-e,f=c-1,g=-1,c=a.notes[c].pit;for(var h=!1,m=0;f!=g;f+=d){var k=a.notes[f].pit-c;c=a.notes[f].pit;if(!k){if(h){k=
a.notes[f].shhd=a.notes[f-d].shhd+e;m<k&&(m=k);continue}if(f+d!=g&&c+d==a.notes[f+d].pit){a.notes[f].shhd=-e;m<-e&&(m=-e);continue}}0>k&&(k=-k);if(3<k||2<=k&&a.head!=n.SQUARE)h=!1;else if(h=!h)a.notes[f].shhd=e,m<e&&(m=e)}a.xmx=m}}function Td(a,c){var d,e,f,g,h=a.length;for(d=h-1;0<=--d;)if((g=a[d].shhd)&&!(0<g)){g=c-g;var m=a[d].pit;for(e=h;0<=--e;)if(a[e].acc){var k=a[e].pit;if(k<m-3)break;!(k>m+3)&&a[e].shac<g&&(a[e].shac=g)}}for(e=h;0<=--e;)if(a[e].acc){k=a[e].pit;var n=a[e].shac;n||(n=a[e].shhd,
n=0>n?c-n:c);break}if(!(0>e)){for(f=0;f<e;f++)if(a[f].acc){m=a[f].pit;var l=a[f].shac;l||(l=a[f].shhd,l=0>l?c-l:c);break}if(e==f)a[e].shac=n;else for(k>m+4?(n>l&&(l=n),a[e].shac=a[f].shac=l):(a[e].shac=n,a[f].shac=l=n+7),l+=7,d=e;--d>f;)if(c=a[d].acc){g=a[d].shac;g<l&&(g=l);m=a[d].pit;for(e=h;--e>d;)a[e].acc&&(k=a[e].pit,!(k>=m+4&&(k>m+4||0>c||0>a[e].acc))&&g>a[e].shac-6&&(n=a[e].shac+7,n>g&&(g=n)));a[d].shac=g}}}function Ic(a,c){a.next=c;a.prev=c.prev;a.prev?a.prev.next=a:a.p_v.sym=a;c.prev=a}function Pb(a,
c){(a.ts_next=c)?(a.ts_prev=c.ts_prev,a.ts_prev&&(a.ts_prev.ts_next=a),c.ts_prev=a):(x(2,a,"Bad linkage"),a.ts_prev=null);a.seqst=!a.ts_prev||a.time!=a.ts_prev.time||Ka[a.ts_prev.type]!=Ka[a.type]&&Ka[a.ts_prev.type];c&&(c.seqst=c.time!=a.time||Ka[a.type]!=Ka[c.type]&&Ka[a.type],c.seqst&&(a=c.wl,V.set_width(c),c.a_ly&&Oc(c),c.shrink?c.shrink+=c.wl-a:(c.shrink=c.wl,c.prev&&(c.shrink+=c.prev.wr)),c.space=0))}function jb(a){a.next&&(a.next.prev=a.prev);a.prev?a.prev.next=a.next:a.p_v.sym=a.next;a.ts_next&&
(a.seqst?a.ts_next.seqst?(a.ts_next.shrink+=a.shrink,a.ts_next.space+=a.space):(a.ts_next.seqst=!0,a.ts_next.shrink=a.shrink,a.ts_next.space=a.space):a.ts_next.seqst&&a.ts_prev&&a.ts_prev.seqst&&!Ka[a.ts_prev.type]&&(a.ts_next.seqst=!1,a.shrink=a.ts_next.shrink,a.space=a.ts_next.space),a.ts_next.ts_prev=a.ts_prev);a.ts_prev&&(a.ts_prev.ts_next=a.ts_next);P==a&&(P=a.ts_next);ya==a&&(ya=a.ts_next)}function Ud(a,c,d){var e=a.p_v,f=a.st;a.type==n.BAR&&a.prev&&a.prev.type==n.BAR&&":"!=a.prev.bar_type[0]&&
(a=a.prev);e.last_sym=a.prev;e.last_sym||(e.sym=null);e.time=a.time;e=Vd(e,n.CLEF);e.next=a;a.prev=e;e.clef_type=c;e.clef_line=d;e.st=f;e.clef_small=!0;delete e.second;e.notes=[];e.notes[0]={pit:a.notes[0].pit};for(e.nhd=0;!a.seqst;)a=a.ts_prev;Pb(e,a);a.soln&&(e.soln=!0,delete a.soln);return e}function Wd(a,c,d){var e,f=0;for(e=0;e<a.a_gch.length;e++){var g=a.a_gch[e];switch(g.type){case "<":g=g.text.wh[0]+c;g>d&&(d=g);break;case ">":g=g.text.wh[0]+a.wr,g>f&&(f=g)}}a.wr<f&&(a.wr=f);return d}function Xd(a,
c){cd>=n.BLEN/2?c=cd>=n.BLEN?c/4:c/2:!a.next&&c>=n.BLEN&&(c/=2);a=c>=n.BLEN/4?c<n.BLEN/2?5:c<n.BLEN?6:c<2*n.BLEN?7:c<4*n.BLEN?8:9:c>=n.BLEN/8?4:c>=n.BLEN/16?3:c>=n.BLEN/32?2:c>=n.BLEN/64?1:0;var d=c-(n.BLEN/16/8<<a);var e=p.spatab[a];d&&(0>d?e=p.spatab[0]*c/(n.BLEN/16/8):(9<=a&&(a=8),e+=(p.spatab[a+1]-p.spatab[a])*d/(n.BLEN/16/8<<a)));return e}function vf(a,c){var d;var e=a.time-c;if(!e){switch(a.type){case n.MREST:return a.wl}return 0}if(a.ts_prev.type==n.MREST)return 71;for(d=Xd(a,e);!a.dur;){switch(a.type){case n.BAR:return a.next||
(d*=.9),.9*d-3;case n.CLEF:return d-a.wl-a.wr;case n.BLOCK:case n.REMARK:case n.STAVES:case n.TEMPO:a=a.ts_next;if(!a)return d;continue}break}if(a.dur&&e<=n.BLEN/4)for(e=a;e;){if(!e.beam_st){d*=.9;break}e=e.ts_next;if(!e||e.seqst)break}if(a.type==n.NOTE&&-1<=a.nflags&&0<a.stem){var f=!0;for(e=a.ts_prev;e&&e.time==c;e=e.ts_prev)if(e.type==n.NOTE&&(-1>e.nflags||0<e.stem)){f=!1;break}if(f){for(e=a.ts_next;e&&e.time==a.time;e=e.ts_next)if(e.type==n.NOTE&&(-1>e.nflags||0>e.stem)){f=!1;break}f&&(d*=.9)}}return d}
function Yd(a,c){for(var d=a.time,e=c.time-d,f=Xd(a,e),g=a,h=0;g=g.ts_next,g.seqst&&(h+=g.space,g.bar_type&&(h+=10)),g!=c;);for(f=(f+h)/2/e;a=a.ts_next,a.seqst&&(a.space=f*(a.time-d),d=a.time),a!=c;);}function Rc(a){return{type:n.BAR,bar_type:"|",fname:a.fname,istart:a.istart,iend:a.iend,v:a.v,p_v:a.p_v,st:a.st,dur:0,time:a.time+(a.dur||0),nhd:0,notes:[{pit:a.notes?a.notes[0].pit:22}],seqst:!0,invis:!0,prev:a,fmt:a.fmt}}function Bc(a){var c=B(a);c.prev.next=a.ts_prev=a.prev=c.ts_prev.ts_next=c;c.next=
c.ts_next=a;a.seqst=!1;a.invis=a.play=!0;c.type=n.REST;delete c.in_tuplet;delete c.tp;delete c.sl1;delete c.a_dd;delete c.a_gch;delete c.sls;return c}function wf(a){var c,d,e,f=a.repeat_n,g=a.repeat_k,h=a.st,m=a.v;a.repeat_n=0;if(0>f){var k=f=-f;for(d=a.prev;d;d=d.prev)if(!d.dur){if(d.type==n.BAR){x(1,d,"Bar in repeat sequence");return}}else if(0>=--k)break;if(d){var r=a.time-d.time;k=g*f;for(c=a;c;c=c.next)if(!c.dur){if(c.type==n.BAR){x(1,c,"Bar in repeat sequence");return}}else if(0>=--k)break;
if(c&&c.next){for(c=a.prev;c!=d;c=c.prev)if(c.type==n.NOTE){c.beam_end=!0;break}for(e=g;0<=--e;){k=f;a.dur&&k--;for(c=a.ts_next;0<k;)c.st==h&&(c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1),c.v==m&&c.dur&&k--),c=c.ts_next;a=Bc(a);a.dur=a.notes[0].dur=r;a.rep_nb=-1;a.beam_st=!0;V.set_width(a);a.head=n.SQUARE;for(a=c;a&&(a.st!=h||a.v!=m||!a.dur);a=a.ts_next);}}else x(1,a,I.not_enough_n)}else x(1,a,I.not_enough_n)}else{k=f;for(c=a.prev.prev;c&&(c.type!=n.BAR&&c.time!=P.time||!(0>=--k));c=c.prev);
if(c){r=a.time-c.time;k=1==f?g:f;for(c=a;c&&!(c.type==n.BAR&&0>=--k);c=c.next);if(c){k=g;if(2==f&&1<k){c=c.next;if(!c){x(1,a,I.not_enough_m);return}c.repeat_n=f;c.repeat_k=--k}r/=f;if(2==f){for(c=a.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==n.BAR){if(c.v==m)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=Bc(a);d.dur=d.notes[0].dur=r;d.invis=!0;c.bar_mrep=2;d=c.next;for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==n.BAR){if(c.v==m)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&
(c.seqst=!1);d=Bc(d);d.dur=d.notes[0].dur=r;d.invis=!0;V.set_width(d)}else for(d=a,e=g;0<=--e;){for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==n.BAR){if(c.v==m)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=Bc(d);d.dur=d.notes[0].dur=r;d.beam_st=!0;if(1==g){d.rep_nb=1;break}d.rep_nb=g-e+1;d=c.next}}else x(1,a,I.not_enough_m)}else x(1,a,I.not_enough_m)}}function Pc(a){function c(a){if(p.custos&&1==F.length)a:{for(var c=a,d,e=c;e.type!=n.NOTE;)if(e=e.next,!e)break a;d=c.p_v;
d.last_sym=c.prev;d.time=c.time;d=Vd(d,n.CUSTOS);d.next=c;c.prev=d;d.wl=0;d.wr=4;Pb(d,c);d.shrink=c.shrink;12>d.shrink&&(d.shrink=12);d.space=e.space;d.head=n.FULL;d.stem=e.stem;d.nhd=e.nhd;d.notes=[];for(c=0;c<e.notes.length;c++)d.notes[c]={pit:e.notes[c].pit,shhd:0,dur:n.BLEN/4};d.stemless=!0}a.nl=!0;a=a.ts_prev;a.type!=n.BAR&&(e=Rc(a),c=a.ts_next,e.wl=0,e.wr=0,e.ts_prev=a,e.next=a.next,e.ts_next=a.ts_next,e.shrink=a.wr+3,a.next&&(a.next.prev=e),a.ts_next.ts_prev=e,a.next=a.ts_next=e,e.space=.9*
c.space-3)}var d;a=function(a){var c;for(c=a;c.ts_prev&&c.ts_prev.time==a.time;)if(c=c.ts_prev,c.bar_type){"["==c.bar_type[0]&&c.text&&c.ts_next==a&&(a=c);var d=c}if(!d)return a;for(c=a;;c=c.ts_next){switch(c.type){case n.KEY:case n.METER:case n.CLEF:continue}break}for(;d!=a;){if(d.bar_type&&(":"==d.bar_type.slice(-1)||d.text)&&":"!=d.bar_type){var e=d.bar_type.match(/(:*)([^:]*)(:*)/);if(e[3])if(e[1]){var f=e[2].length/2|0;var r=e[1]+"|"+e[2].slice(0,f);e=e[2].slice(f)+"|"+e[3]}else r="||",e="[|"+
e[3];else r=e[1]+e[2],e="[";f=B(d);d.bar_type=r;delete d.a_gch;"|"==r&&delete d.rbstop;f.bar_type=e;for(Ic(f,d.next);!(c.type!=n.BAR||c.v>f.v);)c=c.ts_next;Pb(f,c);d.seqst&&(f.seqst=1);c==a&&(a=f);d.text&&(f.invis=!0,delete d.text,delete d.rbstart);delete d.part;delete f.a_dd}d=d.ts_next}return a}(a);(function(a){var c,d,e;for(d=a;d;d=d.ts_next){switch(d.type){case n.KEY:if(!a.fmt.keywarn||d.invis)continue;for(c=a.ts_prev;c&&c.type==n.METER;c=c.ts_prev);case n.METER:if(d.type==n.METER){if(!a.fmt.timewarn)continue;
c=a.ts_prev}case n.CLEF:if(!d.prev)continue;if(d.type==n.CLEF)for(c=a.ts_prev;c;c=c.ts_prev){switch(c.type){case n.BAR:if(":"==c.bar_type[0])break;case n.KEY:case n.METER:continue}break}var f=B(d);Pb(f,c.ts_next);for(c=f;c=c.ts_next,c.v!=d.v;);Ic(f,c);if(f.seqst){V.set_width(f);f.shrink=f.wl;for(e=f.ts_prev;!e.seqst;)e=e.ts_prev;f.shrink+=e.wr;f.space=0;for(e=f.ts_next;!e.seqst;)e=e.ts_next;e.shrink=f.wr+e.wl}delete f.part;continue}if(Ka[d.type])break}})(a);if(a.ts_prev.type!=n.STAVES)return c(a),
a;for(a=a.ts_prev;a&&(!a.seqst||a.type==n.CLEF);a=a.ts_prev);var e=0;for(d=a.type;;a=a.ts_next){if(!a)return a;if(a.type!=d){d=a.type;if(0>e)break;switch(a.type){case n.STAVES:if(!a.ts_prev)return;if(a.ts_prev.type==n.BAR)break;for(;a.ts_next&&(!Ka[a.ts_next.type]||a.ts_next.type==n.CLEF);)a=a.ts_next;if(!a.ts_next||a.ts_next.type!=n.BAR)continue;a=a.ts_next;case n.BAR:if(e)break;e=1;continue;case n.STBRK:a.stbrk_forced?e=-1:jb(a);continue;case n.CLEF:if(e)break;continue;default:if(!e||a.prev&&a.prev.type==
n.GRACE)continue}break}}c(a);return a}function Zd(){var a=F[0];V.set_width(a.clef);V.set_width(a.ckey);V.set_width(a.meter);return[a.clef.wl+a.clef.wr+a.ckey.wl+a.ckey.wr,a.meter.wl+a.meter.wr]}function $d(a,c){for(var d,e,f=0,g=0,h=1-a.fmt.maxshrink;a!=c;)a.seqst&&(d=a.shrink,g+=d,f=(e=a.space)<d?f+d:f+(d*a.fmt.maxshrink+e*h),a.x=f),a=a.ts_next;c&&(g+=c.wr);return[f,g]}function dd(a){switch(a.type){case n.CLEF:if(a.second||a.invis){a.ymx=a.ymn=12;break}a.y=6*(a.clef_line-1);switch(a.clef_type){default:a.ymx=
a.y+28;a.ymn=a.y-14;break;case "c":a.ymx=a.y+13;a.ymn=a.y-11;break;case "b":a.ymx=a.y+7,a.ymn=a.y-12}a.clef_small&&(a.ymx-=2,a.ymn+=2);26>a.ymx&&(a.ymx=26);-1<a.ymn&&(a.ymn=-1);a.clef_octave&&(0<a.clef_octave?a.ymx+=12:a.ymn-=12);break;case n.KEY:a.ymx=2<a.k_sf?34:0<a.k_sf?30:26;a.ymn=-2;break;default:a.ymx=24,a.ymn=0}}function xf(){function a(a,c,d){var e=["15mb(","8vb(",null,"8va(","15ma("],f=["15mb)","8vb)",null,"8va)","15ma)"];la.push((d?e:f)[2+c]);ib(a)}var c,d,e,f,g=S+1,h=new Int16Array(Array(2*
g)),m=new Int8Array(Array(g));for(d=0;d<=S;d++)h[d]=0,m[d]=0;for(c=P;c;c=c.ts_next){d=c.st;if(void 0!=c.ottava)for(;c.ottava.length;)(e=c.ottava.shift())?0==m[d]++&&(a(c,e,!0),h[d]=7*-e):0==--m[d]&&(a(c,-h[d]/7),h[d]=0);switch(c.type){case n.REST:if(1==F.length)break;case n.NOTE:if((e=h[d])&&!c.p_v.ckey.k_drum)for(g=c.nhd;0<=g;g--){var k=c.notes[g];k.opit||(k.opit=k.pit);k.pit+=e}break;case n.GRACE:for(f=c.extra;f;f=f.next)if((e=h[d])&&!c.p_v.ckey.k_drum)for(g=0;g<=f.nhd;g++)k=f.notes[g],k.opit||
(k.opit=k.pit),k.pit+=e}}}function ae(a,c,d){var e;var f=12;var g=20;for(e=c;e&&(e.type!=n.STAVES||e==c);e=e.ts_next)if(e.st==a)if(e.type!=n.NOTE){if(e.type==n.CLEF){if("a"!=e.clef_type)break;jb(e)}}else e.notes[0].pit<g&&(g=e.notes[0].pit),e.notes[e.nhd].pit>f&&(f=e.notes[e.nhd].pit);if(19<=g||13<=g&&"b"!=d)return"t";if(13>=f||19>=f&&"t"!=d)return"b";"a"==d&&(d=16<=(f+g)/2?"t":"b");g=d;var h=e,m=null;for(e=c;e!=h&&(e.type!=n.STAVES||e==c);e=e.ts_next)if(e.st==a&&e.type==n.NOTE){var k=e.time;if("t"==
g){if(12<e.notes[0].pit||20<e.notes[e.nhd].pit){20<e.notes[0].pit&&(m=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==n.NOTE&&19<=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==n.NOTE&&19<=f.notes[0].pit)continue}else{if(12>=e.notes[0].pit||20>e.notes[e.nhd].pit){12>=e.notes[e.nhd].pit&&(m=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==n.NOTE&&13>=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==n.NOTE&&13>=f.notes[0].pit)continue}if(m){k=
e;for(f=e.ts_prev;f!=m;f=f.ts_prev)if(f.st==a){if(f.type==n.BAR&&f.v==e.v){k=":"!=f.bar_type[0]?f:f.next;break}f.type==n.NOTE&&f.beam_st&&!f.p_v.second&&(k=f)}k.time==m.time?m=e:(m=e,g="t"==g?"b":"t",f=Ud(k,g,"t"==g?2:4),f.clef_auto=!0)}else g=d="t"==g?"b":"t",m=e}return d}function tc(a,c,d){a.p_v=c;a.v=c.v;a.st=c.st;a.time=d.time;c.last_sym&&(a.next=c.last_sym.next,a.next&&(a.next.prev=a),c.last_sym.next=a,a.prev=c.last_sym);c.last_sym=a;Pb(a,d)}function yf(){var a,c;var d=F.length;for(a=0;a<d;a++)if(J.voices[a]){var e=
F[a];e.st=J.voices[a].st;e.second=J.voices[a].second;e.last_sym=e.sym}var f=P;for(c=f.fmt;f;){switch(f.type){case n.CLEF:case n.KEY:case n.METER:switch(f.type){case n.CLEF:z[f.st].clef=f;break;case n.KEY:f.p_v.ckey=f;break;case n.METER:f.p_v.meter=f,Jc=0<=p.writefields.indexOf("M")&&f.a_meter.length,!Jc&&f.part&&(f.next.part=f.part)}jb(f);case n.TEMPO:case n.BLOCK:case n.REMARK:f=f.ts_next;continue}break}var g=P;for(a=0;a<d;a++)if(e=F[a],J.voices[a]&&(!J.voices[a].second||e.bar_start)){var h=J.voices[a].st;
z[h]&&z[h].clef&&(f=B(z[h].clef),f.v=a,f.p_v=e,f.st=h,f.time=P.time,f.prev=null,f.next=e.sym,f.next&&(f.next.prev=f),e.sym=e.last_sym=f,f.ts_next=g,f.ts_prev=g?g.ts_prev:null,f.ts_prev?(f.ts_prev.ts_next=f,delete f.seqst):P=f,g&&(g.ts_prev=f,g.type==n.CLEF&&delete g.seqst),delete f.clef_small,delete f.part,f.second=J.voices[a].second,J.st_print[h]||(f.invis=!0),f.fmt=c)}for(a=0;a<d;a++)J.voices[a]&&!J.voices[a].second&&J.st_print[J.voices[a].st]&&(e=F[a],h=e.ckey,h.k_sf||h.k_a_acc)&&(f=B(h),tc(f,
e,g),delete f.invis,delete f.part,f.k_old_sf=h.k_sf,f.fmt=c);if(Jc){for(a=0;a<d;a++)e=F[a],h=e.meter,J.voices[a]&&!J.voices[a].second&&J.st_print[J.voices[a].st]&&(f=B(h),tc(f,e,g),delete f.part,f.fmt=c);Jc=!1}for(a=0;a<d;a++)e=F[a],e.sls.length&&(f={type:n.BAR,fname:g.fname,bar_type:"|",dur:0,multi:0,invis:!0,sls:e.sls,fmt:c},tc(f,e,g),e.sls=[]);for(a=0;a<d;a++){e=F[a];h=e.bar_start;e.bar_start=null;for(f=g;f&&f.time==g.time;f=f.ts_next)if(f.rbstop){h=null;break}h&&J.voices[a]&&J.st_print[J.voices[a].st]&&
(e.last_sym.type==n.BAR?e.last_sym.rbstop||(e.last_sym.rbstart=1):(tc(h,e,g),h.fmt=c))}V.set_pitch(g);f=P;f.seqst=!0;for(d=0;;){h=f;c=a=0;do V.set_width(f),e=f.wl+d,e>a&&(a=e),f.wr>c&&(c=f.wr),f=f.ts_next;while(f!=g&&!f.seqst);h.shrink=a;h.space=0;if(f==g)break;d=c}e=0;g.type==n.BAR&&h.type==n.CLEF&&(c+=4);do V.set_width(f),f.a_ly&&Oc(f),e<f.wl&&(e=f.wl),f=f.ts_next;while(f&&!f.seqst);g.shrink=c+e;g.space=0}function zf(a){function c(a){a.prev.trem2=!0;a.prev.head=++a.head;0<--a.nflags?a.nflags+=a.ntrem:
(-2>=a.nflags&&(a.stemless=!0,a.prev.stemless=!0),a.nflags=a.ntrem);a.prev.nflags=a.nflags}var d,e,f=!0,g=127;for(d=a.sym;d;d=d.next)if(d.type==n.NOTE){g=d.notes[0].pit;break}for(d=a.sym;d;d=d.next){d.a_gch&&V.gch_build(d);switch(d.type){case n.MREST:f=!0;break;case n.BAR:if(e=d.fmt.bardef[d.bar_type])d.bar_type=e;d.beam_on||(f=!0);d.next||!d.prev||d.invis||d.prev.head!=n.OVALBARS||(d.prev.head=n.SQUARE);break;case n.GRACE:for(a=d.extra;a;a=a.next)a.notes.sort(abc2svg.pitcmp),e=ac(a,a.dur_orig),a.head=
e[0],a.dots=e[1],a.nflags=e[2],!a.trem2||a.next&&!a.next.trem2||c(a);break;case n.NOTE:case n.REST:if(e=ac(d,d.dur_orig),d.head=e[0],d.dots=e[1],d.nflags=e[2],-2>=d.nflags&&(d.stemless=!0),d.xstem&&(d.nflags=0),d.trem1&&(d.nflags=0<d.nflags?d.nflags+d.ntrem:d.ntrem),!d.next||!d.next.trem2)if(d.trem2)c(d);else{a=d.nflags;d.ntrem&&(a+=d.ntrem);d.type==n.REST&&d.beam_end&&!d.beam_on&&(f=!0);if(f||0>=a){if(h){h.beam_end=!0;var h=null}if(0>=a)d.beam_st=d.beam_end=!0;else if(d.type==n.NOTE||d.beam_on)d.beam_st=
!0,f=!1}d.beam_end&&(f=!0);if(d.type==n.NOTE||d.beam_on)h=d}}if(d.type==n.NOTE)for(d.nhd&&d.notes.sort(abc2svg.pitcmp),g=d.notes[0].pit,a=d.prev;a&&a.type==n.REST;a=a.prev)a.notes[0].pit=g;else d.notes||(d.notes=[],d.notes[0]={},d.nhd=0),d.notes[0].pit=g}h&&(h.beam_end=!0)}function Af(){function a(a,c){var d=0;for(a+="\n";;){var e=a.indexOf("\n",d);if(0>e)break;d=sa(a.slice(d,e))[0]+12;d>c&&(c=d);if(0>e)break;d=e+1}return c}var c,d=0,e=0,f=F.length;for(c=0;c<f;c++){var g=F[c];var h=g.nm;g=g.snm;if((h||
g)&&!m){fa("voice");var m=H.deffont}h&&(h=a(h,d),h>d&&(d=h));g&&(h=a(g,e),h>e&&(e=h))}for(c=h=0;c<=J.nstaff;c++){if(J.staves[c].flags&1280){h=12;break}J.staves[c].flags&5&&(h=6)}return[d+h,e+h]}function Bf(a,c){var d,e,f,g=a.fmt.shiftunison||0;if(3<=g||(e=a.dur)>=n.BLEN||(f=c.dur)>=n.BLEN||a.stemless&&c.stemless||a.dots!=c.dots&&(g&1||0!=a.dots*c.dots)||0<a.stem*c.stem)return!1;var h=d=0;if(a.notes[0].pit>c.notes[0].pit){if(0>a.stem)return!1;for(;c.notes[d].pit!=a.notes[0].pit;)if(++d>c.nhd)return!1}else if(a.notes[0].pit<
c.notes[0].pit){if(0>c.stem)return!1;for(;c.notes[0].pit!=a.notes[h].pit;)if(++h>a.nhd)return!1}if(c.notes[d].acc!=a.notes[h].acc)return!1;var m=h;var k=d;var r=a.notes[h].shhd;var l=c.notes[d].shhd;do{h++;d++;if(h>a.nhd)break;if(d>c.nhd)break;if(c.notes[d].acc!=a.notes[h].acc)return!1;r<a.notes[h].shhd&&(r=a.notes[h].shhd);l<c.notes[d].shhd&&(l=c.notes[d].shhd)}while(c.notes[d].pit==a.notes[h].pit);if(h<=a.nhd){if(d<=c.nhd||0<c.stem)return!1}else if(d<=c.nhd&&0<a.stem)return!1;var p=h;h=d;d=0;if(e!=
f)if(e<f&&(e=f,f=a.dur),e<n.BLEN/2)c.dots?d=2:a.dots&&(d=1);else if(f<n.BLEN/4){if(g&2)return!1;d=c.dur>=n.BLEN/2?2:1}else return!1;d||(d=a.p_v.scale<c.p_v.scale?2:1);if(1==d){for(d=k;d<h;d++)c.notes[d].invis=!0,delete c.notes[d].acc;for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=r}else{for(h=m;h<p;h++)a.notes[h].invis=!0,delete a.notes[h].acc;for(h=0;h<=a.nhd;h++)a.notes[h].shhd+=l}return!0}function Cf(a,c,d,e){var f;if(f=c.notes[e].acc){e=2*Qb[a.head]+a.xmx+c.notes[e].shac+2;"object"==typeof f&&(e+=2);a.dots&&
(e+=6);for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=e,c.notes[d].shac-=e;c.xmx+=e}else{e=2*Qb[c.head]+c.xmx+a.notes[d].shac+2;f=a.notes[d].acc;"object"==typeof f&&(e+=2);c.dots&&(e+=6);for(d=0;d<=a.nhd;d++)a.notes[d].shhd+=e,a.notes[d].shac-=e;a.xmx+=e}}function ed(a){var c,d=Qb[a.head],e=d,f=[];for(c=0;96>c;c++)f.push(-100);if(-2<a.nflags){if(0<a.stem){e=-e;c=2*a.notes[0].pit;var g=2*(Math.ceil((a.ymx-2)/3)+18)}else c=2*(Math.ceil((a.ymn+2)/3)+18),g=2*a.notes[a.nhd].pit;0>c&&(c=0);for(96<=g&&(g=95);c<=
g;)f[c++]=e}var h=a.notes[0<a.stem?0:a.nhd].shhd;for(g=0;g<=a.nhd;g++)e=-a.notes[g].shhd+d+h,c=2*a.notes[g].pit,0>c?c=0:95<=c&&(c=94),e>f[c]&&(f[c]=e),a.head!=n.SQUARE&&--e,e>f[c-1]&&(f[c-1]=e),e>f[c+1]&&(f[c+1]=e);return f}function fd(a){var c,d=Qb[a.head],e=d,f=0<a.nflags&&a.beam_st&&a.beam_end,g=[];for(c=0;96>c;c++)g.push(-100);if(-2<a.nflags){if(0>a.stem){e=-e;c=2*(Math.ceil((a.ymn+2)/3)+18);var h=2*a.notes[a.nhd].pit;var m=c+4}else c=2*a.notes[0].pit,h=2*(Math.ceil((a.ymx-2)/3)+18);0>c&&(c=0);
for(96<h&&(h=96);c<h;)g[c++]=e}if(f)if(0<a.stem)for(c=0==a.xmx?2*a.notes[a.nhd].pit:2*a.notes[0].pit,c+=4,0>c&&(c=0);96>c&&c<=h-4;c++)g[c]=11;else for(c=m,0>c&&(c=0);96>c&&c<=2*a.notes[0].pit-4;c++)g[c]=3.5;m=a.notes[0<a.stem?0:a.nhd].shhd;for(h=0;h<=a.nhd;h++)e=a.notes[h].shhd+d-m,c=2*a.notes[h].pit,0>c?c=0:95<=c&&(c=94),e>g[c]&&(g[c]=e),a.head!=n.SQUARE&&--e,e>g[c-1]&&(g[c-1]=e),e>g[c+1]&&(g[c+1]=e);return g}function Df(){function a(){l=d;d=c;u=w;B=q;z=A;m=h}var c,d,e,f,g,h,m,k=J;for(c=P;c;c=c.ts_next)if(c.type!=
n.NOTE||c.invis)c.type==n.STAVES&&(k=c.sy);else{if(c.xstem&&0>c.ts_prev.stem)for(e=0;e<=c.nhd;e++)c.notes[e].shhd-=7,c.notes[e].shac+=16;for(d=c;;){d=d.ts_next;if(!d)break;if(d.time!=c.time){d=null;break}if(d.type==n.NOTE&&!d.invis&&d.st==c.st)break}if(d){var l=c;k.voices[l.v].range<k.voices[d.v].range?d.dot_low=!0:l.dot_low=!0;if(!(l.ymn>d.ymx||l.ymx<d.ymn||Bf(l,d)))if(l.dots||d.dots||!(0<l.stem&&0>d.stem&&l.notes[0].pit==d.notes[d.nhd].pit+1||0>l.stem&&0<d.stem&&l.notes[l.nhd].pit+1==d.notes[0].pit)){var A=
fd(l);var p=ed(d);if((e=l.ts_prev)&&e.time==l.time&&e.st==l.st&&e.type==n.NOTE&&!e.invis){var y=fd(e);for(f=0;96>f;f++)y[f]>A[f]&&(A[f]=y[f])}else e=null;var u=-10;for(f=0;96>f;f++)p[f]+A[f]>u&&(u=p[f]+A[f]);if(!(-3>u&&(d.notes[0].pit&1||!l.dots&&!d.dots||!(l.notes[l.nhd].pit==d.notes[0].pit+2&&l.dot_low||l.notes[l.nhd].pit+2==d.notes[0].pit&&d.dot_low)))){var t=fd(d);var q=ed(l);if(e)for(y=ed(e),f=0;96>f;f++)y[f]>q[f]&&(q[f]=y[f]);var w=h=m=-100;for(f=0;96>f;f++)q[f]+t[f]>w&&(w=q[f]+t[f]),t[f]>m&&
(m=t[f]),A[f]>h&&(h=A[f]);f=0;y=l.nhd;for(g=d.nhd;;){var x=l.notes[y].pit-d.notes[g].pit;switch(x){case 2:l.notes[y].pit&1||(l.dot_low=!1);break;case 1:l.notes[y].pit&1?d.dot_low=!0:l.dot_low=!1;break;case 0:if(l.notes[y].acc!=d.notes[g].acc){f=-1;break}d.notes[g].acc&&(l.notes[y].acc||(l.notes[y].acc=d.notes[g].acc),d.notes[g].acc=0);l.dots&&d.dots&&l.notes[y].pit&1&&(f=1);break;case -1:l.notes[y].pit&1?d.dot_low=!1:l.dot_low=!0;break;case -2:l.notes[y].pit&1||(d.dot_low=!1)}if(0>f)break;if(0<=x&&
0>--y)break;if(0>=x&&0>--g)break}if(0>f)Cf(l,d,y,g);else{g=0;l.dots?d.dots?f||(g=1):a():d.dots&&w+h<u+m&&(g=1);var B=p;var z=t;!e&&w+h<u+m&&a();u+=3;0>u&&(u=0);e=0<=l.stem?0:l.nhd;u+=l.notes[e].shhd;e=0<=d.stem?0:d.nhd;u-=d.notes[e].shhd;if(l.dots)if(e=7.7+l.xmx+3.5*l.dots-3.5+3,!g){w=-100;for(y=0;y<=l.nhd;y++)f=l.notes[y].pit,f&1||(l.dot_low?f--:f++),f*=2,1>f?f=1:95<=f&&(f=94),B[f]>w&&(w=B[f]),B[f-1]+1>w&&(w=B[f-1]+1),B[f+1]+1>w&&(w=B[f+1]+1);e+w+2>u&&(u=e+w+2)}else if(e<u+m+d.xmx){for(y=w=0;y<=
l.nhd;y++)f=l.notes[y].pit,f&1||(l.dot_low?f--:f++),f*=2,1>f?f=1:95<=f&&(f=94),z[f]>w&&(w=z[f]),z[f-1]+1>w&&(w=z[f-1]=1),z[f+1]+1>w&&(w=z[f+1]+1);4.5<w&&7.7+l.xmx+2<u+w+d.xmx&&(d.xmx=w+3-7.7)}for(e=d.nhd;0<=e;e--)d.notes[e].shhd+=u;d.xmx+=u;g&&(l.xmx=d.xmx)}}}else{0>l.stem&&(l=d,d=c);u=l.notes[0].shhd+7;for(e=0;e<=d.nhd;e++)d.notes[e].shhd+=u;d.xmx+=u;l.xmx=d.xmx}}}}function Ef(a){for(var c=P;c&&!c.nl;c=c.ts_next)c.st==a&&c.type!=n.CLEF&&(c.st++,c.type!=n.TEMPO&&(c.invis=!0))}function Ff(){function a(a){var c=
z[a],d=h.staves[a];c||(c=z[a]={});c.y=0;c.stafflines=d.stafflines;c.staffscale=d.staffscale;c.ann_top=c.ann_bot=0}function c(){var a,c,d=h.staves.length;for(a=0;a<d;a++)if(h.staves[a].flags&257){var e=0;for(c=a;a<d;){e|=f[a]?1:2;if(h.staves[a].flags&514)break;a++}if(3==e)for(;c<=a;)f[c]=!0,g[c++]=!0}}var d,e,f=[],g=[],h=J;if(P.type==n.STAVES){var m=P;P=P.ts_next;P.ts_prev=null;m.seqst&&(P.seqst=!0);if(m.p_v.sym=m.next)m.next.prev=null}S=h.nstaff;for(d=0;d<=S;d++)a(d);for(m=P;m&&!m.nl;m=m.ts_next){switch(m.type){case n.STAVES:c();
h.st_print=new Uint8Array(f);for(h=m.sy;S<h.nstaff;)a(++S);f=[];continue;case n.BLOCK:m.play?m.ts_next&&m.ts_next.shrink&&(m.ts_next.shrink=0):(Qc.push(m),jb(m));continue}d=m.st;if(d>S){switch(m.type){case n.CLEF:z[d].clef=m;break;case n.KEY:m.p_v.ckey=m;break;case n.METER:m.p_v.meter=m}jb(m)}else if(!f[d]){switch(m.type){default:continue;case n.BAR:if(m.bar_mrep||1<h.staves[d].staffnonote)break;continue;case n.GRACE:break;case n.NOTE:case n.REST:case n.SPACE:case n.MREST:if(!(1<h.staves[d].staffnonote)){if(m.invis)continue;
if(!h.staves[d].staffnonote&&m.type!=n.NOTE)continue}}g[d]=f[d]=!0}}ya=m;c();h.st_print=new Uint8Array(f);(function(){var a,c,d;for(a=0;a<=S;a++){var e=z[a];e.hlu=[];e.hld=[];var f=e.stafflines.length;e.topbar=6*(f-1);for(c=0;c<f-1;c++){switch(e.stafflines[c]){case ".":case "-":continue}break}e.botline=e.botbar=6*c;if(c>=f-2)if("."!=e.stafflines[c])e.botbar-=6,e.topbar+=6;else{e.botbar-=12;e.topbar+=12;continue}if(g[a])for(e.hll=17+2*c,e.hlmap=new Int8Array(Array(2*(f-c+1))),d=1;c<f;c++,d+=2)switch(e.stafflines[c]){case "|":case "[":e.hlmap[d-
1]=1,e.hlmap[d]=1,e.hlmap[d+1]=1}}})();for(d=0;d<S;d++)g[d]||Ef(d);g[S]||(z[S].topbar=0);yf();H.st_print=new Uint8Array(g);if(ya){m=ya;delete m.nl;m=m.ts_prev;m.ts_next=null;var k=F.length;for(e=0;e<k;e++){d=F[e];if(d.sym&&d.sym.time<=ya.time){for(m=ya.ts_prev;m;m=m.ts_prev)if(m.v==e){d.s_next=m.next;m.next=null;break}if(m)continue}d.s_next=d.sym;d.sym=null}}}function be(){for(var a=P,c=a.time;a;a=a.ts_next){if(a.time!=c){Ra();return}switch(a.type){case n.NOTE:case n.REST:case n.MREST:case n.SPACE:Ra();
return;default:continue;case n.STAVES:J=a.sy;continue;case n.BLOCK:if(a.play)continue;V.block_gen(a)}jb(a);a.p_v.s_next==a&&(a.p_v.s_next=a.next)}P=null}function Ib(a){a.fname=t.fname;a.istart=t.istart;a.iend=t.iend}function ce(a){var c={type:n.CLEF,clef_line:2,clef_type:"t",v:l.v,p_v:l,time:l.time,dur:0},d=1;Ib(c);switch(a[0]){case '"':d=a.indexOf('"',1);c.clef_name=a.slice(1,d);d++;break;case "a":if("u"==a[1]){c.clef_type="a";c.clef_auto=!0;d=4;break}d=4;case "C":c.clef_type="c";c.clef_line=3;break;
case "b":d=4;case "F":c.clef_type="b";c.clef_line=4;break;case "n":d=4;c.invis=!0;break;case "t":if("e"==a[1]){c.clef_type="c";c.clef_line=4;break}d=6;case "G":break;case "p":d=4;case "P":c.clef_type="p";c.clef_line=3;l.key.k_sf=0;l.ckey.k_sf=0;l.ckey.k_map=abc2svg.keys[7];l.ckey.k_b40=2;l.ckey.k_drum=!0;break;default:w(1,"Unknown clef '$1'",a);return}"1"<=a[d]&&"9">=a[d]&&(c.clef_line=+a[d],d++);delete l.snd_oct;if("8"!=a[d+1]&&"1"!=a[d+1])return c;switch(a[d]){case "^":c.clef_oct_transp=!0;case "+":c.clef_octave=
"8"==a[d+1]?7:14;c.clef_oct_transp||(l.snd_oct=8==a[d+1]?12:24);break;case "_":c.clef_oct_transp=!0;case "-":c.clef_octave="8"==a[d+1]?-7:-14,c.clef_oct_transp||(l.snd_oct=8==a[d+1]?-12:-24)}return c}function bb(a,c){var d;var e=new K;e.buffer=a;var f=[];for(a=0;2>a;a++)if(d=e.buffer[e.index]?ob(e):null){if("object"==typeof d.acc){w(1,I.bad_transp);return}f[a]=abc2svg.pab40(d.pit,d.acc)}else{if(1!=a||!c){w(1,I.bad_transp);return}f[a]=242}return f[1]-f[0]}function de(a){var c;if(c=a.match(/(.)[=\s]*(\[I:.+\]|".+"|!.+!)$/)){a=
c[1];var d=c[2];"\\"==a[0]&&("t"==a[1]?a="\t":a[1]||(a=" "));c=a.charCodeAt(0);if(128<=c)w(1,I.not_ascii);else{switch(za[c][0]){case "0":case "d":case "i":case " ":break;case '"':case "!":case "[":if(1<za[c].length)break;default:w(1,"Bad user character '$1'",a);return}switch(d){case "!beambreak!":d=" ";break;case "!ignore!":d="i";break;case "!nil!":case "!none!":d="d"}za[c]=d}}else w(1,'Lack of starting [, ! or " in U: / %%user')}function Gf(a){if(a){if(/^[\]\[|.-]+$/.test(a))return a.replace(/\]/g,
"[");a=+a;switch(a){case 0:return"...";case 1:return"..|";case 2:return".||";case 3:return".|||"}if(!(isNaN(a)||0>a||16<a))return"||||||||||||||||".slice(0,a)}}function Za(a){var c={type:n.BLOCK,subtype:a,dur:0};"midi"!=a.slice(0,4)&&(l=F[0]);Ca(c);return c}function Wc(a){l.init||(l.init=!0,N.V&&(N.V[l.id]&&(a=N.V[l.id].concat(a)),N.V["*"]&&(a=N.V["*"].concat(a))));a.length&&V.set_vp(a)}function cc(a,c){c.length&&(N.V||(N.V={}),N.V[a]?Array.prototype.push.apply(N.V[a],c):N.V[a]=c)}function Hf(a){function c(a){var c;
if((c=a.match(/(\d+)\/(\d+)/))&&(a=+c[2])&&!isNaN(a)&&!(a&a-1)&&(c=+c[1],!isNaN(c)))return n.BLEN*c/a;w(1,"Invalid note duration $1",f)}var d=a,e={type:n.TEMPO,dur:0};Ib(e);0>p.writefields.indexOf("Q")&&(e.invis=!0);if('"'==a[0]){var f=a.match(/"([^"]*)"/);if(!f){w(1,"Unterminated string in Q:");return}e.tempo_str1=f[1];a=a.slice(f[0].length).replace(/^\s+/,"")}if('"'==a.slice(-1)){var g=a.indexOf('"');e.tempo_str2=a.slice(g+1,-1);a=a.slice(0,g).replace(/\s+$/,"")}g=a.indexOf("=");if(0<g){var h=a.slice(0,
g).split(/\s+/);for(a=a.slice(g+1).replace(/^\s+/,"");;){f=h.shift();if(!f)break;g=c(f);if(!g)return;e.tempo_notes||(e.tempo_notes=[]);e.tempo_notes.push(g)}"ca. "==a.slice(0,4)&&(e.tempo_ca="ca. ",a=a.slice(4));g=a.indexOf("/");if(0<g){g=c(a);if(!g)return;e.new_beat=g}else if(e.tempo=+a,!e.tempo||isNaN(e.tempo)){w(1,"Bad tempo value");return}}2>t.state||!l.time&&!ha.tempo?(N.Q=d,ha.tempo=e):(a=l.time,ha.tempo||w(0,"No previous tempo"),t.ctrl||(t.ctrl={}),t.ctrl[a]||(t.ctrl[a]={}),t.ctrl[a].tempo=
e,e.v=L.top_voice,e.p_v=F[e.v],e.fmt=p,e.st=e.p_v.st,e.time=a)}function bd(a,c){var d;if(l&&l.ignore)switch(a){default:return;case "P":case "Q":case "V":}switch(a){case "I":V.do_pscom(c);break;case "L":if(d=c.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){var e=+d[1];if(!e||0!=(e&e-1))break;e=n.BLEN/e;var f=d[2]?(f=+d[4])?+d[3]/f*n.BLEN:0:e}else"auto"==c&&(e=f=-1);if(!f){w(1,"Bad L: value");break}1>=t.state?ha.ulen=e:(l.ulen=e,l.dur_fact=f/e);break;case "M":a:{d={type:n.METER,dur:0,a_meter:[]};var g={},h=0;
var m=0;Ib(d);if(0==c.indexOf("none")){m=4;var k=1}else for(k=0;m<c.length&&"="!=c[m];){switch(c[m]){case "C":g.top=c[m++];if(!h)var r=h=4;break;case "c":case "o":g.top=c[m++];if(!h)switch(h="c"==c[m-1]?2:3,r=4,c[m]){case "|":r/=2;break;case ".":h*=3,r*=2}break;case ".":case "|":h=0;g.top=c[m++];break;case "(":if("("==c[m+1]){var A=!0;g.top=c[m++];d.a_meter.push(g);g={}}for(a=m+1;a<c.length&&")"!=c[a]&&"/"!=c[a];)a++;if(")"==c[a]&&"/"==c[a+1]){m++;continue}case ")":A="("==c[m];g.top=c[m++];d.a_meter.push(g);
g={};continue;default:if("0">=c[m]||"9"<c[m]){w(1,"Bad char '$1' in M:",c[m]);break a}r=2;for(g.top=c[m++];;){for(;"0"<=c[m]&&"9">=c[m];)g.top+=c[m++];if(")"==c[m]){if("/"!=c[m+1])break;m++}if("/"==c[m]){m++;if("0">=c[m]||"9"<c[m]){w(1,"Bad char '$1' in M:",c[m]);break a}for(g.bot=c[m++];"0"<=c[m]&&"9">=c[m];)g.bot+=c[m++];break}if(" "!=c[m]&&"+"!=c[m])break;if(m>=c.length||"("==c[m+1])break;g.top+=c[m++]}h=+g.top}A||(g.bot&&(r=+g.bot),k+=h*n.BLEN/r);d.a_meter.push(g);for(g={};" "==c[m];)m++;"+"==
c[m]&&(g.top=c[m++],d.a_meter.push(g),g={})}if("="==c[m]){k=c.substring(++m).match(/^(\d+)\/(\d+)$/);if(!k){w(1,"Bad duration '$1' in M:",c.substring(m));break a}k=n.BLEN*k[1]/k[2]}if(k)if(d.wmeasure=k,0>p.writefields.indexOf("M")&&(d.a_meter=[]),3!=t.state){if(N.M=c,ha.meter=d,t.state)for(ha.ulen||(ha.ulen=1>=k||k>=3*n.BLEN/4?n.BLEN/8:n.BLEN/16),m=0;m<F.length;m++)F[m].meter=d,F[m].wmeasure=k}else for(l.wmeasure=k,Cc()?l.meter=d:Ca(d),d=l.voice_down;d;d=d.voice_down)d.wmeasure=k;else w(1,I.bad_val,
"M:")}break;case "U":de(c);break;case "P":if(!t.state)break;if(1==t.state){N.P=c;break}d=l.time;k={text:c,time:d};Ib(k);0>p.writefields.indexOf(a)&&(k.invis=!0);t.ctrl||(t.ctrl={});t.ctrl[d]||(t.ctrl[d]={});t.ctrl[d].part=k;k.v=L.top_voice;k.p_v=F[k.v];k.fmt=p;k.st=k.p_v.st;break;case "Q":if(!t.state)break;Hf(c);break;case "V":gd(c);3==t.state&&(l.ignore=!L.voices[l.v]);break;case "K":if(!t.state)break;a:{b:{r="FCGDAEB".indexOf(c[0])-1;A=0;a={type:n.KEY,dur:0};Ib(a);e=1;if(-1>r)switch(c[0]){case "H":var C=
!0;if("p"!=c[1].toLowerCase()){w(1,"Unknown bagpipe-like key");break}a.k_bagpipe=c[1];r="P"==c[1]?0:2;e++;p.temper||(p.temper=new Float32Array([11.62,12.55,1.66,2.37,3.49,0,1.66,2.37,3.49,4.41,5.53,0,3.49,4.41,5.53,6.63,7.35,4.41,5.53,6.63,7.35,8.19,0,6.63,7.35,8.19,9.39,10.51,0,8.19,9.39,10.51,11.62,12.55,0,10.51,11.62,12.55,1.66,1.66]));break;case "P":w(1,"K:P is deprecated");r=0;C=a.k_drum=!0;break;case "n":if(0==c.indexOf("none")){r=0;a.k_none=!0;e=4;break}default:a.k_map=[];a.k_mode=0;c=[a,Rb(c)];
break b}if(!C){switch(c[e]){case "#":r+=7;e++;break;case "b":r-=7,e++}c=c.slice(e).trim();switch(c.slice(0,3).toLowerCase()){default:if("m"!=c[0]||" "!=c[1]&&"\t"!=c[1]&&"\n"!=c[1]){C=!0;break}case "aeo":case "m":case "min":r-=3;A=5;break;case "dor":r-=2;A=1;break;case "ion":case "maj":break;case "loc":r-=5;A=6;break;case "lyd":r+=1;A=3;break;case "mix":--r;A=4;break;case "phr":r-=4,A=2}C||(c=c.replace(/\w+\s*/,""));if(0==c.indexOf("exp ")){(c=c.replace(/\w+\s*/,""))||w(1,"No accidental after 'exp'");
var y=!0}e=c[0];if("^"==e||"_"==e||"="==e){a.k_a_acc=[];C=new K;C.buffer=c;do{f=ob(C);if(!f)break;a.k_a_acc.push(f);for(e=c[C.index];" "==e;)e=c[++C.index]}while("^"==e||"_"==e||"="==e);if(!y){var u=r,v;e=[];f=[];if(0<u)for(y=0;y<u;y++)e[y]=1,f[y]=[26,23,27,24,21,25,22][y];else for(y=0;y<-u;y++)e[y]=-1,f[y]=[22,25,21,24,20,23,26][y];var x=a.k_a_acc.length;for(u=0;u<x;u++){var z=a.k_a_acc[u];for(v=0;v<y;v++)if(f[v]==z.pit){e[v]=z.acc;break}v==y&&(e[v]=z.acc,f[v]=z.pit,y++)}for(u=0;u<y;u++)(z=a.k_a_acc[u])||
(z=a.k_a_acc[u]={}),z.acc=e[u],z.pit=f[u]}c=c.slice(C.index)}else y&&0==c.indexOf("none")&&(r=0,c=c.replace(/\w+\s*/,""))}if(-7>r||7<r)w(1,"Key with double sharps/flats"),r=7<r?r-12:r+12;a.k_sf=r;if(a.k_a_acc)for(a.k_map=[],e=a.k_a_acc.length;0<=--e;)f=a.k_a_acc[e],a.k_map[(f.pit+19)%7]=f.acc;else a.k_map=a.k_bagpipe&&!r?abc2svg.keys[9]:abc2svg.keys[r+7];a.k_mode=A;a.k_b40=[1,24,7,30,13,36,19,2,25,8,31,14,37,20,3][r+7];c=[a,Rb(c)]}r=c[0];c=c[1];if(1==t.state){void 0!=r.k_sf||r.k_a_acc||(r.k_sf=0,
r.k_none=!0,r.k_map=abc2svg.keys[7]);for(A=0;A<F.length;A++)a=F[A],a.key=B(r),a.okey=B(r),a.ckey=B(r);t.ckey=r;ha.ulen||(ha.ulen=n.BLEN/8);c.length&&(cc("*",c),c="");Ra();A=bc();ia(p.topspace);if(p.titleformat){var D;h={};a=Object.create(If);C={A:p.infospace,C:p.composerspace,O:p.composerspace,R:p.infospace};y={};x="";e=p.titleformat;for(f=0;;){for(;" "==e[f];)f++;m=e[f++];if(!m)break;if("A">m||"Z"<m)switch(m){case "+":g="+";m=e[f++];break;case ",":x+="\n";default:continue;case "<":g="l";m=e[f++];
break;case ">":g="r",m=e[f++]}else switch(e[f]){case "-":g="l";f++;break;case "1":g="r";f++;break;case "0":f++;default:g="c"}if(h[m])y[m]++;else{if(!N[m])continue;h[m]=N[m].split("\n");y[m]=1}x+=g+m}u={l:p.titlespace,c:p.titlespace,r:p.titlespace};A={l:0,c:.5*A,r:A};v={};var G;e=x+"\n";for(f=0;;){v.l=v.c=v.r=z=0;for(D=f;;){g=e[D++];if("\n"==g)break;m=e[D++];if("+"!=g&&!v[g]&&(G=h[m])){(x=a[m])||(x="history");var E=ma(x);var J=1.1*E.size;C[m]&&(J+=C[m]);z<J&&(z=J);v[g]=J}}u.l+=z-v.l;u.c+=z-v.c;for(u.r+=
z-v.r;;){g=e[f++];if("\n"==g)break;m=e[f++];if(h[m].length){G=h[m].shift();"+"==e[f]&&(y[m]--,f++,m=e[f++],h[m].length&&(G=G?G+(" "+h[m].shift()):" "+h[m].shift()));(x=a[m])||(x="history");E=ma(x);J=1.1*E.size;C[m]&&(J+=C[m]);fa(E);D=A[g];z=u[g]+J;"Q"==m?(V.set_width(ha.tempo),ha.tempo.invis||("l"!=g&&(ee(ha.tempo),E=ha.tempo.tempo_wh[0],"c"==g&&(E*=.5),D-=E),Fd(ha.tempo,D,-z))):G&&("T"==m&&(G=fe(G,"s"==a.T[0])),ka(D,-z,G,g));"T"==m&&(x=a.T="subtitle",C.T=p.subtitlespace);if(1>=y[m])for("T"==m&&(E=
ma(x),J=1.1*E.size,C[m]&&(J+=C[m]),fa(E));0<h[m].length;)z+=J,G=h[m].shift(),ka(D,-z,G,g);y[m]--;u[g]=z}}u.c>u.l&&(u.l=u.c);u.r>u.l&&(u.l=u.r);if(f>=e.length)break;u.c=u.r=u.l}ia(u.l);ia(p.musicspace)}else{if(N.T&&0<=p.writefields.indexOf("T"))for(a=0;;){C=N.T.indexOf("\n",a);if(0>C){hd(N.T.substring(a),0!=a);break}hd(N.T.slice(a,C),0!=a);a=C+1}e=0;t.ckey.k_bagpipe&&!p.infoline&&0<=p.writefields.indexOf("R")&&(h=N.R);h&&(fa("composer"),ka(0,-p.composerspace,h),e=p.composerspace);y=N.A;0<=p.writefields.indexOf("C")&&
(m=N.C);0<=p.writefields.indexOf("O")&&(g=N.O);if(m||g||p.infoline){fa("composer");ia(p.composerspace);0>p.aligncomposer?(u=0,v=" "):0==p.aligncomposer?(u=.5*A,v="c"):(u=A,v="r");f=e;if(m||g){0<=p.aligncomposer&&e!=f&&ia(e-f);for(a=0;;){ia(H.curfont.size);C=m?m.indexOf("\n",a):-1;if(0>C){ge(u,0,m?m.substring(a):null,g,v);break}ka(u,0,m.slice(a,C),v);e+=H.curfont.size;a=C+1}f>e&&ia(f-e)}((h=h?null:N.R)||y)&&p.infoline&&(fa("info"),ia(H.curfont.size+p.infospace),ge(A,0,h,y,"r"),e+=H.curfont.size+p.infospace)}else f=
p.composerspace;N.P&&0<=p.writefields.indexOf("P")&&(fa("parts"),e=p.partsspace+H.curfont.size-e,0<e&&(f+=e),.01<f&&ia(f),ka(0,0,N.P),f=0);ia(f+p.musicspace)}ha.new_nbar?(H.nbar=ha.new_nbar,ha.new_nbar=0):H.nbar=1;F.length?l=F[0>pb?0:L.top_voice]:(gd("1"),l.clef.istart=l.key.istart,l.clef.iend=l.key.iend,l.default=!0);for(m=0;m<F.length;m++)g=F[m],g.ulen=ha.ulen,g.ckey.k_bagpipe&&!g.pos.stm&&(g.pos=B(g.pos),g.pos.stm&=-8,g.pos.stm|=n.SL_BELOW);if(0>pb)for(m=F.length,L.nstaff=S=m-1;0<=--m;)g=F[m],
delete g.new,g.st=g.cst=m,L.voices[m]={st:m,range:m},L.staves[m]={stafflines:g.stafflines||"|||||",staffscale:1};t.state=3}Wc(c);l.ckey.k_bagpipe||l.ckey.k_drum||void 0==p.transp&&void 0==l.transp&&void 0==l.shift||(d=(p.transp||0)+(l.transp||0)+(l.shift||0));if(void 0!=l.sndtran||void 0!=l.sndsh)k=(l.sndtran||0)+(l.sndsh||0);if(void 0==r.k_sf){if(!r.k_a_acc&&void 0==d){if(void 0==k)break a;r.invis=!0}r.k_sf=l.okey.k_sf}l.okey=B(r);void 0!=d&&(l.vtransp=d,r.k_transp=d);void 0!=k&&(r.k_sndtran=k);
r.k_old_sf=l.ckey.k_sf;r.k_a_acc&&r.k_a_acc.length||r.k_sf||r.k_old_sf||(r.invis=!0);r.k_b40||(r.k_b40=l.ckey.k_b40);l.ckey=r;Cc()?(r.fmt=p,l.key=B(r),r.k_none&&(l.key.k_sf=0)):Ca(r)}break;case "N":case "R":N[a]=N[a]?N[a]+("\n"+c):c;break;case "r":if(!q.keep_remark||3!=t.state)break;k={type:n.REMARK,text:c,dur:0};Ca(k);break;default:w(0,"'$1:' line ignored",a)}}function he(){var a,c=t.line,d={type:n.BAR,fname:t.fname,istart:t.bol+c.index,dur:0,multi:0};ea&&ea.bar&&Hb("|");ha.new_nbar&&(d.bar_num=
ha.new_nbar,ha.new_nbar=0);for(a=c.char();;){var e=c.next_char();switch(e){case "|":case "[":case "]":case ":":a+=e;continue}break}":"==a[0]&&(":"==a?(a="|",d.bar_dotted=!0):d.rbstop=2);Ia&&dc(d);la.length&&ib(d);if(t.ottava.length){var f=d;l.cst!=l.st&&(f={type:n.SPACE,fname:t.fname,istart:t.bol+c.index,dur:0,multi:0,invis:!0,width:1},Ca(f));f.ottava=t.ottava;t.ottava=[]}"["!=a.slice(-1)||/[0-9" ]/.test(e)||(a=a.slice(0,-1),c.index--,e="[");if("0"<e&&"9">=e)for(d.text=e;;){e=c.next_char();if(0>"0123456789,.-".indexOf(e))break;
d.text+=e}else if('"'==e&&"["==a.slice(-1))for(d.text="";;){e=c.next_char();if(!e){w(1,"No end of repeat string");return}if('"'==e){c.index++;break}d.text+=e}"]"==a[0]&&(d.rbstop=2,1!=a.length?a=a.slice(1):d.invis=!0);d.iend=t.bol+c.index;d.text&&"["==a.slice(-1)&&"["!=a&&(a=a.slice(0,-1));":"==a.slice(-1)&&(d.rbstop=2,d.text&&(w(1,"Variant ending on a left repeat bar"),delete d.text),l.tie_s_rep=null);d.text&&(d.rbstart=d.rbstop=2,"1"==d.text[0]?(l.tie_s_rep=l.tie_s,l.acc_tie?l.acc_tie_rep=l.acc_tie.slice():
l.acc_tie_rep&&(l.acc_tie_rep=null)):(l.tie_s=l.tie_s_rep,l.acc_tie_rep&&(l.acc_tie=l.acc_tie_rep.slice())));d.rbstart&&l.norepbra&&!l.second&&(d.norepbra=!0);if(0>l.ulen&&(f=l.last_sym)&&f.type!=n.MREST&&f.type!=n.BAR){for(;f.type!=n.BAR&&f.prev;)f=f.prev;e=f.time;var g=l.time-e;c=l.wmeasure/g;if(!e){for(;f&&!f.dur;)f=f.next;f&&f.type==n.REST&&f.invis&&(e+=f.dur*c,f.prev?f.prev.next=f.next:l.sym=f.next,f.next&&(f.next.prev=f.prev),f=f.next)}if(l.wmeasure!=g){for(;f;f=f.next)if(f.time=e,f.dur&&!f.grace&&
(f.dur*=c,f.dur_orig*=c,e+=f.dur,f.type==n.NOTE||f.type==n.REST))for(g=0;g<=f.nhd;g++)f.notes[g].dur*=c;l.time=d.time=e}}if(("["==a||"|:"==a)&&(f=l.last_sym)&&f.time==l.time){do{if(f.type==n.BAR)break;if(Ka[f.type])break;f=f.prev}while(f);if(f&&f.type==n.BAR){if("["==a&&!f.text&&(!l.st||L.staves[l.st-1].flags&64||d.norepbra)||"|"==f.bar_type){"["!=a&&(f.bar_type=a);d.text&&(f.text=d.text);d.a_gch&&(f.a_gch=d.a_gch);d.norepbra&&(f.norepbra=d.norepbra);d.rbstart&&(f.rbstart=d.rbstart);d.rbstop&&(f.rbstop=
d.rbstop);return}if("|:"==a){if(":|"==f.bar_type){f.bar_type="::";f.rbstop=2;return}if("||"==f.bar_type){f.bar_type="||:";f.rbstop=2;return}}}}switch(a){case "[":case "[]":case "[|]":d.invis=!0;a=d.rbstart?"[":"[]";break;case ":|:":case ":||:":a="::";break;case "||":if("2.2"<=p["abc-version"])break;case "[|":case "|]":d.rbstop=2}d.bar_type=a;l.lyric_restart||(l.lyric_restart=d);l.sym_restart||(l.sym_restart=d);Ca(d);d.st=l.st;d.rbstart&&"["!=a&&!l.norepbra&&0<d.st&&!(L.staves[d.st-1].flags&64)&&(f=
{type:n.BAR,fname:d.fname,istart:d.istart,iend:d.iend,bar_type:"[",multi:0,invis:!0,text:d.text,rbstart:2},Ca(f),f.st=d.st,delete d.text,d.rbstart=0);d.bar_dotted||d.invis||(l.acc=[])}function Rb(a){if(!a)return[];a=a.match(/[^\s"=]+=?|"[^"]+"/g);return a?a:(w(1,"Unterminated string"),[])}function uc(a){id.lastIndex=a.index;var c=id.exec(a.buffer);if(!c[0])return[1,1];var d=c[1]||1;var e=c[3]||1;c[3]||(e*=1<<c[2].length);a.index=id.lastIndex;return[d,e]}function ob(a){var c=a.char();switch(c){case "^":c=
a.next_char();if("^"==c){var d=2;c=a.next_char()}else d=1;break;case "=":d=3;c=a.next_char();break;case "_":c=a.next_char(),"_"==c?(d=-2,c=a.next_char()):d=-1}if(1==d||-1==d)if("1"<=c&&"9">=c||"/"==c){var e=uc(a);0>d&&(e[0]=-e[0]);p.nedo&&1==e[1]&&(e[0]*=12,e[1]*=p.nedo);d=e;c=a.char()}e=Sb.indexOf(c)+16;c=a.next_char();if(16>e)w(1,"'$1' is not a note",a.buffer[a.index-1]);else{for(;"'"==c;)e+=7,c=a.next_char();for(;","==c;)e-=7,c=a.next_char();a={pit:e,shhd:0,shac:0};d&&(a.acc=d);return a}}function Tb(){var a=
t.line,c=0;la.length&&"dot"==la[la.length-1]&&(c=n.SL_DOTTED,la.pop());switch(a.next_char()){case "'":return a.index++,c+n.SL_ABOVE;case ",":return a.index++,c+n.SL_BELOW}return c+n.SL_AUTO}function ie(a,c){var d;for(d=l.sls.length;0<=--d;){var e=l.sls[d];var f=e.note;var g=e.is_note;delete e.is_note;if(f.s!=a.s){e.note=a;c&&(e.is_note=c);var h=g?f:f.s;h.sls||(h.sls=[]);h.sls.push(e);l.sls.splice(d,1);g&&(f.s.sl1=!0);e.grace&&(e.grace.sl1=!0);a.s.grace&&(a.s.sl2=!0);return}}for(h=a.s.prev;h;h=h.prev)if(h.type==
n.BAR&&":"==h.bar_type[0]&&h.text){h.sls||(h.sls=[]);h.sls.push({note:a,ty:n.SL_AUTO});c&&(h.sls[h.sls.length-1].is_note=c);return}h=a.s;h.sls||(h.sls=[]);h.sls.push({note:a,ty:n.SL_AUTO,loc:"i"})}function je(a,c){var d=[0,2,4,5,7,9,11][a%7],e=12*(a/7|0);l.snd_oct&&(e+=l.snd_oct);3==c&&(c=0);if(c)if("object"==typeof c){var f=c[0]/c[1];if(100==c[1])return d+e+f}else f=c;else return p.temper?p.temper[abc2svg.p_b40[a%7]]+e:d+e;if(p.nedo){if("object"!=typeof c)return a=abc2svg.p_b40[a%7]+c,p.temper[a]+
e;if(c[1]==p.nedo)return a=abc2svg.p_b40[a%7],p.temper[a]+e+f}else if(!p.temper)return d+(e+f);c=p.temper[abc2svg.p_b40[a%7]];0<f?(a=p.temper[(abc2svg.p_b40[a%7]+1)%40],a<c&&(a+=12)):(a=p.temper[(abc2svg.p_b40[a%7]+39)%40],a>c&&(a-=12),f=-f);return c+e+(a-c)*f}function ke(){for(var a,c=t.line,d=c.index,e="";;){a=c.next_char();if(!a){c.index=d;w(1,"No end of decoration");return}if("!"==a)break;e+=a}void 0!=le[e]?(ha.ottava=!0,t.ottava.push(le[e])):la.push(e)}function Qd(){function a(a){for(var c="";0>
a;)a+=7,c+=",";for(;14<=a;)a-=7,c+="'";return Sb[a]+c}function c(c,d){if(void 0==d)return c;var e,f="",g=c.length;for(e=0;e<g;e++){var h=c[e];f="h"<=h&&"z">=h?f+a(d+h.charCodeAt(0)-110):f+h}return f}function d(y){for(var u,v,x,q;;){u=A.char();if(!u)break;if(!y&&Ac[u]){q=void 0;for(x in nb)if(nb.hasOwnProperty(x)&&x[0]==u){if(0>x.indexOf("n")){if(A.buffer.indexOf(x,A.index)!=A.index)continue;A.index+=x.length}else{a:{v=void 0;var z=x;var B=1;for(q=A.index+1;B<z.length;B++,q++)if(z[B]!=A.buffer[q]){if("n"!=
z[B]){q=void 0;break a}v=Sb.indexOf(A.buffer[q]);if(0>v){q=void 0;break a}for(;"'"==A.buffer[q+1];)v+=7,q++;for(;","==A.buffer[q+1];)v-=7,q++}A.index=q;q=v}if(void 0==q)continue}var D=x;v=nb[x];B=A;z=t.istart;t.line=A=new K;t.istart+=B.index;if(0>p.writefields.indexOf("m")){A.buffer=D.replace("n",a(q));D=l.last_sym;var F=l.time;d(!0);D||(D=l.sym);for(D=D.next;D;D=D.next)D.noplay=!0;var G=l.time;var E=l;l=me(E.id+"-p");L.voices[l.v]||(l.second=!0,L.voices[l.v]={st:E.st,second:!0,range:l.v});l.time=
F;D=l.last_sym;t.line=A=new K;t.istart+=B.index;A.buffer=c(v,q);d(!0);l.time!=G&&w(1,"Bad length of the macro sequence");D||(D=l.sym);for(;D;D=D.next)D.invis=D.play=!0;l=E}else A.buffer=c(v,q),d(!0);t.line=A=B;t.istart=z;q=1;break}if(q)continue}v=u.charCodeAt(0);if(128<=v){w(1,I.not_ascii);A.index++;break}v=za[v];switch(v[0]){case " ":if(v=l.last_note)v.beam_end=!0,e&&(e.gr_shift=!0);break;case "\n":if(p.barsperstaff)break;l.eoln=!0;break;case "&":if(e){w(1,I.bad_grace);break}u=A.next_char();if(")"==
u){Hb(u);break}Hb("&");continue;case "(":u=A.next_char();if("0"<u&&"9">=u){if(e){w(1,I.bad_grace);break}v=A.get_int();q=Jf[v];B=v;u=A.char();if(":"==u&&(u=A.next_char(),"0"<u&&"9">=u&&(q=A.get_int(),u=A.char()),":"==u))if(u=A.next_char(),"0"<u&&"9">=u)B=A.get_int(),A.char();else{w(1,"Invalid 'r' in tuplet");continue}if(0==q||void 0==q)q=0==l.wmeasure%9?3:2;0>k&&(k=m.length);m.push({p:v,q:q,r:B,ro:B,f:l.tup||p.tuplets});continue}if("&"==u){if(e){w(1,I.bad_grace);break}Hb("(");break}A.index--;r.push(Tb());
continue;case ")":if(v=l.last_sym)switch(v.type){case n.SPACE:v.notes||(v.notes=[],v.notes[0]={});case n.NOTE:case n.REST:break;case n.GRACE:for(v=v.extra;v.next;v=v.next);break;default:v=null}if(!v){w(1,I.bad_char,u);break}v.notes[0].s=v;ie(v.notes[0]);break;case "!":1<v.length?la.push(v.slice(1,-1)):ke();break;case '"':if(e){w(1,I.bad_grace);break}ne(v);break;case "[":if(1<v.length){V.do_pscom(v.slice(3,-1));break}q=A.buffer[A.index+1];if(0<='|[]: "'.indexOf(q)||"1"<=q&&"9">=q){if(e){w(1,I.bar_grace);
break}he();continue}if(":"==A.buffer[A.index+2]){if(e){w(1,I.bad_grace);break}u=A.buffer.indexOf("]",A.index+1);if(0>u){w(1,"Lack of ']'");break}v=A.buffer.slice(A.index+3,u).trim();t.istart=t.bol+A.index;t.iend=t.bol+ ++u;A.index=0;bd(q,v);A.index=u;continue}case "n":v=V.new_note(e,r);if(!v)continue;if(e||!v.notes)continue;if(0<=k)v.tp=m.slice(k),k=-1,C&&(v.tp[0].s=C),C=v;else if(!C)continue;x=m[m.length-1];if(0<--x.r)continue;for(;;){u=C;v=x.q/x.p;q=u.time;for(l.time=q+(l.time-q)*v;;){u.in_tuplet=
!0;u.grace||(u.time=q,u.dur&&(u.dur*=v,q+=u.dur));if(!u.next){u.tpe?u.tpe++:u.tpe=1;break}u=u.next}u=x.ro;x.s&&(C=x.s);m.pop();if(!m.length){C=null;break}x=m[m.length-1];x.r-=u;if(0<x.r)break}continue;case "<":if(!l.last_note){w(1,"No note before '<'");break}if(e){w(1,"Cannot have a broken rhythm in grace notes");break}for(q="<"==u?1:-1;"<"==u||">"==u;)q*=2,u=A.next_char();l.brk_rhythm=q;continue;case "i":break;case "{":if(e){w(1,"'{' in grace note");break}f=l.last_note;l.last_note=null;g=la;la=[];
e={type:n.GRACE,fname:t.fname,istart:t.bol+A.index,dur:0,multi:0};l.color&&(e.color=l.color);switch(l.pos.gst&7){case n.SL_ABOVE:e.stem=1;break;case n.SL_BELOW:e.stem=-1;break;case n.SL_HIDDEN:e.stem=2}Ca(e);u=A.next_char();if("/"==u){e.sappo=!0;break}continue;case "|":if(e){w(1,I.bar_grace);break}he();continue;case "}":if(l.ignore){e=null;break}v=l.last_note;if(!e||!v){w(1,I.bad_char,u);break}la.length&&w(1,"Decoration ignored");e.extra=e.next;e.extra.prev=null;e.next=null;l.last_sym=e;e=null;if(!v.prev&&
!l.ckey.k_bagpipe){for(u=0;u<=v.nhd;u++)v.notes[u].dur*=2;v.dur*=2;v.dur_orig*=2}l.last_note=f;la=g;break;case "\\":if(!A.buffer[A.index+1]){h=!0;break}default:w(1,I.bad_char,u)}A.index++}}var e,f,g,h,m=[],k=-1,r=[],A=t.line;if(3==t.state){if(t.tp){m=t.tp;k=t.tpn;var C=t.tps;t.tp=null}d();m.length&&(t.tp=m,t.tps=C,t.tpn=k);r.length&&w(1,"Start of slur without note");e&&(w(1,"No end of grace note sequence"),l.last_sym=e.prev,l.last_note=f,e.prev&&(e.prev.next=null));h||p.barsperstaff||ea||"\n"!=za[10]||
(l.eoln=!0);l.eoln&&p.breakoneoln&&l.last_note&&(l.last_note.beam_end=!0)}}function mc(a){a=a.charCodeAt(0);if(128<=a){if(768<=a&&880>a)return 0;a=97}return oe[a]}function qb(a){function c(a,c){return'<tspan\n\tclass="'+(a.class&&a.name==c.name&&a.size==c.size&&a.weight==c.weight&&a.style==c.style?a.class:db(a))+'">'}if("object"==typeof a)return a;var d,e=H.deffont,f=H.curfont,g="";f!=e&&(g=c(f,e));g+=a.replace(/<|>|&[^&\s]*?;|&|\$./g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";
case "&":return"&amp;";default:if("$"==a[0]){if("0"==a[1])d=H.deffont;else if("1"<=a[1]&&"9">=a[1])d=ma("u"+a[1]);else break;a="";if(d!=f&&(f!=e&&(a="</tspan>"),f=d,f!=e))return a+c(f,e)}}return a});f!=e&&(g+="</tspan>");g=new String(g);"undefined"!=typeof document?sa(g):g.wh=sa(a);H.curfont=f;return g}function fa(a){"string"==typeof a&&(a=ma(a));oe="sans"==a.name.slice(0,4)?Kf:pe;H.curfont=H.deffont=a}function ka(a,c,d,e,f,g){g||(g=d.wh||sa(d));G+='<text class="'+db(H.deffont);"j"!=e&&5<d.length&&
H.deffont.wadj&&(G+='" lengthAdjust="'+H.deffont.wadj+'" textLength="'+g[0].toFixed(1));G+='" x="';Pa(a,'" y="',c+.2*g[1]);switch(e){case "c":G+='" text-anchor="middle">';break;case "j":G+='" textLength="'+f.toFixed(1)+'">';break;case "r":G+='" text-anchor="end">';break;default:G+='">'}G+=qb(d);G+="</text>\n"}function fe(a,c){if(p.titletrim){var d=a.lastIndexOf(", ");if(0>d||"A">a[d+2]||"Z"<a[d+2])d=0;else if(1==p.titletrim){if(d<a.length-7||0<=a.indexOf(" ",d+3))d=0}else d<a.length-p.titletrim-2&&
(d=0);d&&(a=a.slice(d+2).trim()+" "+a.slice(0,d))}!c&&0<=p.writefields.indexOf("X")&&(a=N.X+".  "+a);return p.titlecaps?a.toUpperCase():a}function bc(){return(Z.width-Z.lm-Z.rm-2)/p.scale}function hd(a,c){if(a){Ra();a=fe(a,c);c?(fa("subtitle"),c=p.subtitlespace):(fa("title"),c=p.titlespace);var d=sa(a);d[1]+=2*H.curfont.pad;ia(d[1]+c+H.curfont.pad);c=H.curfont.pad;p.titleleft?ka(0,c,a,null,null,d):ka(bc()/2,c,a,"c",null,d)}}function ge(a,c,d,e,f){if(!d){if(!e)return;d=e;e=null}e?ka(a,c,d+" ("+e+")",
f):ka(a,c,d,f)}function jd(a,c){if("s"!=c){Ra();var d=bc(),e=H.curfont.size,f=e*p.lineskipfac;e*=p.parskipfac;var g,h,m;switch(c){default:var k=H.curfont;switch(c){case "c":d/=2;break;case "r":d-=k.pad;break;default:d=k.pad}for(g=0;;){var l=a.indexOf("\n",g);if(l==g){ia(e);ab();for(Gb(H.curfont);"\n"==a[l+1];)ia(f),l++;if(l==a.length)break}else if(g=0>l?a.slice(g):a.slice(g,l),ia(sa(g)[1]*p.lineskipfac+2*k.pad),ka(d,k.pad,g,c),0>l)break;g=l+1}ia(e);ab();break;case "f":case "j":for(g=0;;){l=a.indexOf("\n\n",
g);var n=0>l?a.slice(g):a.slice(g,l);n=n.split(/\s+/);for(g=h=m=k=0;g<n.length;g++){var t=sa(n[g]+"&#x00a0;");h+=t[0];h>=d&&(ia(k*p.lineskipfac),ka(0,0,n.slice(m,g).join(" "),c,d),m=g,h=t[0],k=0);t[1]>k&&(k=t[1])}0!=h&&(ia(k*p.lineskipfac),ka(0,0,n.slice(m).join(" ")));ia(e);ab();if(0>l)break;for(;"\n"==a[l+2];)ia(f),l++;if(l==a.length)break;Gb(H.curfont);g=l+2}}}}function rf(a){function c(a,c){var d=0,e=0;"$"==a[0]&&"0"<=a[1]&&"9">=a[1]&&(H.curfont="0"==a[1]?H.deffont:ma("u"+a[1]),a=a.slice(2));
if("0"<=a[d]&&"9">=a[d]||"."==a[d+1]){for(;d<a.length&&(d++," "!=a[d]&&":"!=a[d-1]&&"."!=a[d-1]););for(e=d;" "==a[d];)d++}0!=e&&ka(c,0,a.slice(0,e),"r");d<a.length&&ka(c+5,0,a.slice(d),"l")}var d,e;var f=0;var g=1;fa("words");ia(p.wordsspace);rb();a=a.split("\n");var h=a.length;for(d=0;d<h;d++){var m=a[d];if(!m){for(;d+1<h&&!a[d+1];)d++;g++}else if(m.length>f){f=m.length;var k=d}}f=bc()/2;var l=sa(a[k])[0];k=e=0;if(l<f){var n=g>>1;for(d=0;d<h;d++)if(m=a[d],!m){for(0>=--n&&(k=d);d+1<h&&!a[d+1];)d++;
if(0>=n){e=d+1;break}}g>>=1}if(e){var t=(f-l)/2+10;n=t+f}else n=f-l/2+10;var y=!0;for(d=0;d<k||e<h;d++,e++)ia(p.lineskipfac*H.curfont.size),d<k&&((m=a[d])?c(m,t):Gb(H.curfont)),e<h&&((m=a[e])?c(m,n):0==--g&&(d<k?g++:e<h-1&&(n=f-l/2+10,rb()))),a[d+1]||a[e+1]?y=!0:y&&(rb(),y=!1)}function oc(a){return a.replace(/[Cco]\||[co]\.|./g,function(a){return(a=Sc["mtr"+a])?a.c:0})}function qe(a){var c,d;if(!kd[a])if(kd[a]=!0,d=lb[a]){for(c=0;;){a=d.indexOf('xlink:href="#',c);if(0>a)break;a+=13;c=d.indexOf('"',
a);qe(d.slice(a,c))}Dc+="\n"+d}else x(1,null,"Unknown glyph: '$1'",a)}function re(a){var c=0;for(a=a.replace(/\x3c!--.*?--\x3e/g,"");;){var d=a.indexOf("<",c);if(0>d)break;var e=a.indexOf('id="',d);if(0>e)break;e+=4;c=a.indexOf('"',e);if(0>c)break;var f=a.slice(e,c);c=a.indexOf(">",c);if(0>c)break;if("/"==a[c-1])c++;else{e=a.indexOf(" ",d);if(0>e)break;e=a.slice(d+1,e);c=a.indexOf("</"+e+">",c);if(0>c)break;c+=3+e.length}"<filter"==a.substr(d,7)?ld+=a.slice(d,c)+"\n":lb[f]=a.slice(d,c)}}function md(){E.started&&
(E.started=!1,ec(),G+="</g>\n");if(1!=E.scale||E.color)ec(),G+="<g ",1!=E.scale&&(G=0>E.st?G+F[E.v].scale_str:0>E.v?G+z[E.st].scale_str:G+('transform="translate(0,'+(T-E.dy).toFixed(1)+") scale("+E.scale.toFixed(2)+')"')),E.color&&(1!=E.scale&&(G+=" "),G+='color="'+E.color+'"'),G+=">\n",E.started=!0}function Xa(a){if(a!=E.color){var c=E.color;E.color=a;md();return c}}function Fa(a){a!=E.st&&1!=E.scale&&(E.scale=0);var c=0<=a?z[a].staffscale:1;var d=0<=a&&1!=c?z[a].y:T;if(c!=E.scale||d!=E.dy)E.scale=
c,E.dy=d,E.st=a,E.v=-1,md()}function Ub(a){var c=a.p_v.scale;if(1==c)Fa(a.st);else{var d=T;1!=z[a.st].staffscale&&(c*=z[a.st].staffscale,d=z[a.st].y);if(c!=E.scale||E.dy!=T)E.scale=c,E.dy=d,E.st=1==z[a.st].staffscale?-1:a.st,E.v=a.v,md()}}function Ea(a,c){G&&(E.started&&(E.started=!1,ec(),G+="</g>\n"),0>E.st?z[0].output+=G:1==E.scale?z[E.st].output+=G:z[E.st].sc_out+=G,G="");E.scale=0>a?1:c?1:z[a].staffscale;E.st=a;E.dy=0}function se(a,c,d){if(void 0!=a.istart){var e=a.type,f=a.ymx-a.ymn+4,g=a.wl||
2,h=a.wr||2;a.grace&&(e=n.GRACE);d(c||abc2svg.sym_name[e],a.istart,a.iend,a.x-g-2,z[a.st].y+a.ymn+f-2,g+h+4,f,a)}}function pf(a,c){se(a,c,q.anno_start)}function qf(a,c){se(a,c,q.anno_stop)}function Vb(){}function U(a,c,d,e,f){c=Ya(c);d=sb(d);G+=a.replace(/X|Y|A|B|F|G/g,function(a){switch(a){case "X":return c.toFixed(1);case "Y":return d.toFixed(1);case "A":return e;case "B":return f;case "F":return e.toFixed(1);default:return f.toFixed(1)}})}function kb(a,c,d,e,f){ec();U('<g transform="translate(X,Y',
a,c);d&&(G+=") rotate("+d.toFixed(2));e&&(G=f?G+(") scale("+e.toFixed(2)+", "+f.toFixed(2)):G+(") scale("+e.toFixed(2)));G+=')">\n';E.g++}function Db(){ec();E.g--;G+="</g>\n"}function Ya(a){return E.g?a:(a+nc)/E.scale}function sb(a){return E.g?-a:1==E.scale?T-a:0<=E.v?(E.dy-a)/F[E.v].scale:E.dy-a}function Pa(a,c,d){a=Ya(a);d=sb(d);G+=a.toFixed(1)+c+d.toFixed(1)}function Cb(a,c,d){d?U('<path d="mX Y',a,c):U('<path class="stroke" d="mX Y',a,c)}function kf(){function a(a,c){var e,f,m,k=a.length;if(k)for(f=
0;f<k;f++)if((e=a[f])&&e.length){var l=Ya(e[0][0]);G+='<path class="stroke" stroke-width="1" d="M'+l.toFixed(1)+" "+sb(d.y+c*f).toFixed(1);for(m=0;;){var n=e.shift();if(!n)break;var p=Ya(n[0]);G+="m"+(p-l+n[1]-m).toFixed(2)+" 0h"+(-n[1]+n[2]).toFixed(2);l=p;m=n[2]}G+='"/>\n'}}var c;for(c=0;c<=S;c++){var d=z[c];d.hlu&&(Fa(c),a(d.hlu,6),a(d.hld,-6))}}function ec(){var a=[];if(wa[0].length){for(;;){var c=wa[0].shift();if(void 0==c)break;a.push(c.toFixed(1))}G+='<text x="'+a.join(",");for(a=[];;){c=wa[1].shift();
if(void 0==c)break;a.push(c.toFixed(1))}G+='"\ny="'+a.join(",");G+='"\n>'+wa[2]+"</text>\n";wa[2]=""}if(wa[3].length){for(G+='<path class="sW" d="';;){c=wa[3].shift();if(void 0==c)break;G+="M"+c.toFixed(1)+" "+wa[3].shift().toFixed(1)+"v"+wa[3].shift().toFixed(1)}G+='"/>\n'}}function Q(a,c,d){if(lb[d])qe(d),U('<use x="X" y="Y" xlink:href="#A"/>\n',a,c,d);else{var e=Sc[d];e?(a+=e.x*E.scale,c-=e.y,e.sc?U('<text transform="translate(X,Y) scale(A)">B</text>\n',a,c,e.sc,e.c):(wa[0].push(Ya(a)),wa[1].push(sb(c)),
wa[2]+=e.c)):x(1,null,"no definition of $1",d)}}function te(a,c,d){var e=25+3*(d/20|0);var f=15<d?(d-15)/e|0:0;U('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',a+(d-e*f-5)/2,c+6,Math.round((e-5)/E.scale),e*f+5)}function Uc(a,c,d,e,f,g){var h=e?2.3:3.5,m=-d;0>d&&(h=-h);a+=h*E.scale;0<=E.v&&(m/=F[E.v].scale);wa[3].push(Ya(a));wa[3].push(sb(c));wa[3].push(m);if(f){c+=d;if(0<d)if(g)if(G+='<path d="',e)for(;0<=--f;)U("MX Yl3 1.5 0 2 -3 -1.5z\n",a,c),c-=3;else for(;0<=
--f;)U("MX Yl7 3.2 0 3.2 -7 -3.2z\n",a,c),c-=5.4;else if(e)if(G+='<path d="',1==f)U("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",a,c);else for(;0<=--f;)U("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",a,c),c-=3.5;else{Q(a,c,"flu"+f);return}else if(g){if(G+='<path d="',!e)for(;0<=--f;)U("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",a,c),c+=5.4}else if(e)if(G+='<path d="',1==f)U("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",a,c);else for(;0<=--f;)U("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",
a,c),c+=3.5;else{Q(a,c,"fld"+f);return}G+='"/>\n'}}function nd(a,c,d){U('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',a,c+3,d)}function ue(a,c,d,e){if("fng"==d)U('<text x="X" y="Y" style="font-size:14px" text-anchor="middle">A</text>\n',a,c,oc(e));else{var f=Lf[d];f?(a+=f.dx,c+=f.dy,f.def||(tb+="\n."+d+" {"+f.style+"}",f.def=!0),U('<text x="X" y="Y" class="A"B>',a,c,d,f.anchor||""),fa("annotation"),G+=qb(e),G+="</text>\n"):Q(a,c,d)}}function ve(a,c,d){kb(a,c,270);a=0;for(d=Math.ceil(d/
6);0<=--d;)Q(a,6,"ltr"),a+=6;Db()}function we(a,c,d){c+=4;for(d=Math.ceil(d/6);0<=--d;)Q(a,c,"ltr"),a+=6}function od(a,c,d,e,f){if(xe[d])xe[d](a,c,e,f);else x(1,null,"No function for decoration '$1'",d)}function ye(a,c){c=ac(a,c);switch(c[0]){case n.OVAL:a="\ueca2";break;case n.EMPTY:a="\ueca3";break;default:switch(c[2]){case 2:a="\ueca9";break;case 1:a="\ueca7";break;default:a="\ueca5"}}c[1]&&(a+='<tspan dx=".1em">\uecb7</tspan>');return a}function ee(a){var c,d=0,e=[];if(!a.tempo_str){p.musicfont.used||
ma("music");fa("tempo");a.tempo_str1&&(e.push(a.tempo_str1),d+=sa(a.tempo_str1)[0]);if(a.tempo_notes){var f=' dy="-1"';for(c=0;c<a.tempo_notes.length;c++){var g=ye(a,a.tempo_notes[c]);e.push('<tspan\nclass="'+db(p.musicfont)+'" style="font-size:'+(1.3*H.curfont.size).toFixed(1)+'px"'+f+">"+g+"</tspan>");g=1<g.length?2:1;d+=g*H.curfont.swfac;f=""}e.push('<tspan dy="1">=</tspan>');d+=mc("=")*H.curfont.swfac;a.tempo_ca&&(e.push(a.tempo_ca),d+=sa(a.tempo_ca)[0]);a.tempo?(e.push(a.tempo),d+=sa(a.tempo.toString())[0]):
(g=ye(a,a.new_beat),e.push('<tspan\nclass="'+db(p.musicfont)+'" style="font-size:'+(1.3*H.curfont.size).toFixed(1)+'px" dy="-1">'+g+"</tspan>"),g=1<g.length?2:1,d+=g*H.curfont.swfac,f="y")}a.tempo_str2&&(f?e.push('<tspan\n\tdy="1">'+a.tempo_str2+"</tspan>"):e.push(a.tempo_str2),d+=sa(a.tempo_str2)[0]);a.tempo_str=e.join(" ");d+=mc(" ")*H.curfont.swfac*(e.length-1);a.tempo_wh=[d,13]}}function Fd(a,c,d){fa("tempo");if(H.curfont.box){H.curfont.box=!1;var e=H.curfont.size+4}G+='<text class="'+db(H.curfont)+
'" x="';Pa(c,'" y="',d+.2*H.curfont.size);G+='">'+a.tempo_str+"</text>\n";e&&(H.curfont.box=!0,G+='<rect class="stroke" x="',Pa(c-2,'" y="',d+e-1),G+='" width="'+(a.tempo_wh[0]+2).toFixed(1)+'" height="'+e.toFixed(1)+'"/>\n');a.invis=!0}function ia(a){T+=a}function rb(){if(!R&&G&&q.img_out&&0!=T){var a='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tfill="currentColor" stroke-width=".7"',c="";ec();var d=ma("music");a+=' class="'+db(d)+" tune"+
ad.length+'"\n';T*=p.scale;a=q.imagesize?a+(q.imagesize+' viewBox="0 0 '+Z.width.toFixed(0)+" "+T.toFixed(0)+'">\n'):a+(' viewBox="0 0 '+Z.width.toFixed(0)+" "+T.toFixed(0)+'" width="'+Z.width.toFixed(0)+'px" height="'+T.toFixed(0)+'px">\n');a+=ld;if(tb||fb){a+="<style>"+fb;if(p.fgcolor||p.bgcolor)a+="\n.f"+d.fid+(p.fullsvg||"")+"{"+(p.fgcolor?"color:"+p.fgcolor+";":"")+(p.bgcolor?"background-color:"+p.bgcolor:"")+"}";a+=tb+"\n</style>\n"}Dc&&(a+="<defs>"+Dc+"\n</defs>\n");1!=p.scale&&(a+='<g class="g" transform="scale('+
p.scale.toFixed(2)+')">\n',c="</g>\n");ze&&ze.ps_flush(!0);0<Ma&&(q.img_out(1==Ma?'<div class="nobrk">':'<div class="nobrk newpage">'),Ma=-1);q.img_out(a+G+c+"</svg>");fb=G="";if(p.fullsvg)for(kd={},d=0;d<Fb.length;d++)Fb[d].used=!1;else ld=tb="";Dc="";T=0}}function ab(){rb();0>Ma&&(!t.state||p.splittune)&&(q.img_out("</div>"),Ma=0)}function Mf(){function a(a,c){c=new RegExp(c);if(c.test(l.id)||c.test(l.nm))for(c=0;c<a.length;c++)V.do_pscom(a[c])}var c;if(t.voice_opts)for(c in t.voice_opts)t.voice_opts.hasOwnProperty(c)&&
a(t.voice_opts[c],c);if(t.tune_v_opts)for(c in t.tune_v_opts)t.tune_v_opts.hasOwnProperty(c)&&a(t.tune_v_opts[c],c)}function Ca(a){var c=l.time;a.fname||Ib(a);l.ignore||((a.prev=l.last_sym)?l.last_sym.next=a:l.sym=a);l.last_sym=a;a.v=l.v;a.p_v=l;a.st=l.cst;a.time=c;a.dur&&!a.grace&&(l.time+=a.dur);t.ufmt=!0;a.fmt=p;a.pos=l.pos;l.second&&(a.second=!0);l.floating&&(a.floating=!0);l.eoln&&(a.soln=!0,l.eoln=!1)}function Vd(a,c){c={type:c,dur:0};var d=l;l=a;Ca(c);l=d;a=c.prev;a||(a=c.next);a&&(c.fname=
a.fname,c.istart=a.istart,c.iend=a.iend);return c}function $c(a){var c,d;l&&l.clone&&(t.istart=t.eol,Ae());for(d=0;d<F.length;d++){var e=F[d];if(!a)for(delete e.eoln;;){var f=e.sls.shift();if(!f)break;var g=f.note.s;for(c=g.next;c&&(!c.bar_type||":"!=c.bar_type[0]);c=c.next);c?(g.sls||(g.sls=[]),g.sls.push({ty:f.ty,note:{s:c}})):(g.sls||(g.sls=[]),g.sls.push({ty:f.ty,note:{s:c},loc:"o"}))}for(g=e.sym;g&&!(g.time>=pb);g=g.next);for(;g;g=g.next){(Ka[g.type]||g.type==n.STAVES)&&g.type!=n.SPACE&&g.type!=
n.GRACE||g.prev&&!(g.time>g.prev.time+g.prev.dur)||(c={type:n.SM,v:g.v,p_v:g.p_v,time:g.time,dur:0,next:g,prev:g.prev,fmt:g.fmt},g.prev?g.prev.next=c:F[g.v].sym=c,g.prev=c);switch(g.type){case n.GRACE:if(!p.graceword)continue;for(c=g.next;c;c=c.next){switch(c.type){case n.SPACE:continue;case n.NOTE:c.a_ly&&(g.a_ly=c.a_ly,c.a_ly=null)}break}continue}if(g.feathered_beam){var h;var m=g;f=m.dur;var k=1;for(h=m;h&&!h.beam_end&&h.next;h=h.next)k++;if(1>=k)delete m.feathered_beam;else{var r=h;c=f/2;e=f/
(k-1);var A=m.time;if(0<m.feathered_beam)for(h=m,m=k-1;h!=r;h=h.next,m--)f=(e*m|0)+c,h.dur=f,h.time=A,A+=f;else for(h=m,m=0;h!=r;h=h.next,m++)f=(e*m|0)+c,h.dur=f,h.time=A,A+=f;h.dur=h.time+h.dur-A;h.time=A}}}}}function Be(a){var c={voices:[],staves:[],top_voice:0};if(a)J=L=c;else{for(a=0;a<F.length;a++)if(L.voices[a]){var d=L.voices[a].st;d=L.staves[d];var e=F[a];d.staffnonote=e.staffnonote;e.staffscale&&(d.staffscale=e.staffscale)}for(d=0;d<L.staves.length;d++)c.staves[d]=B(L.staves[d]),c.staves[d].flags=
0;L=L.next=c}}function Ce(a,c){var d="";if(c&&3!=c)if("object"!=typeof c)d=["__","_","","^","^^"][c+2];else{var e=c[0];0<e?d+="^":(d+="_",e=-e);d+=e+"/"+c[1]}d+=Sb[(a+75)%7];for(e=a;23<=e;e-=7)d+="'";for(e=a;16>e;e+=7)d+=",";return d}function fc(){var a;if(!l.ckey.k_bagpipe&&!l.ckey.k_drum){p.transp&&l.shift&&w(0,"Mix of old and new transposition syntaxes");if(void 0!=p.transp||void 0!=l.transp||void 0!=l.shift)var c=(p.transp||0)+(l.transp||0)+(l.shift||0);if(void 0!=l.sndtran||void 0!=l.sndsh)var d=
(l.sndtran||0)+(l.sndsh||0);if(void 0==c){if(void 0==d)return}else l.vtransp=c;if(Cc())l.okey.fmt=p,l.key=a=B(l.okey);else for(a=l.last_sym;a.type!=n.KEY;)if(a=a.prev,!a){a=l.key;break}void 0!=c&&(a.k_transp=c);void 0!=d&&(a.k_sndtran=d);l.ckey=B(a);l.key.k_none&&(a.k_sf=0)}}function Nd(a,c,d){var e=d.pit;var f=d.acc;if("object"==typeof f){var g=f[1];f=f[0];if(2!=g){x(1,a,"Microtone transposition not coded");return}}!f&&c.k_a_acc&&(f=c.k_map[(e+19)%7]);e=abc2svg.pab40(e,f)+c.k_transp;d.pit=abc2svg.b40p(e);
if(f||c.k_a_acc||c.k_none){e=abc2svg.b40a(e);if(f)c.k_a_acc&&(a=c.k_map[(d.pit+19)%7],a==e&&(e=0)),e||(e=3);else if(c.k_none){if(De(a,d.pit))return}else if(c.k_a_acc){if(De(a,d.pit))return;(a=c.k_map[(d.pit+19)%7])&&(e=3)}else return;if(g&&e!=f)switch(Number(f)){case -3:switch(e){case -2:e=-1;break;case 3:e=-3;d.pit++;break;case 2:e=-1}break;case -1:switch(e){case -2:e=-3;break;case 3:e=1}break;case 1:switch(e){case -1:e=-3;break;case 3:e=-1;break;case 2:e=3}break;case 3:switch(e){case -1:e=1;break;
case 1:e=1,d.pit++}}d.acc=g?[e,g]:e}}function Ee(a){if("0"==a[0])return 0;if(0<="123456789-+".indexOf(a[0])){var c=parseInt(a);if(isNaN(c)||-36>c||36<c)w(1,I.bad_transp);else return c+=36,40*((c/12|0)-3)+("b"==a.slice(-1)?abc2svg.ifb40:abc2svg.isb40)[c%12]}}function Md(a){if(!a.k_a_acc&&!a.k_none){var c,d=(a.k_b40+200+a.k_transp)%40;if(c=abc2svg.b40k[d]-d)a.k_transp=0<a.k_transp?a.k_transp+c:a.k_transp-c,d+=c;a.k_b40=d;c=abc2svg.b40sf[d];a.k_old_sf=a.k_sf;a.k_sf=c;a.k_map=abc2svg.keys[c+7]}}function De(a,
c){var d,e=a.time;for(a=a.prev;a;a=a.prev)switch(a.type){case n.BAR:if(a.time<e)return;for(;;){a=a.prev;if(!a)return;if(a.type==n.NOTE){if(a.time+a.dur==e)break;return}if(a.time<e)return}for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==c&&a.notes[d].tie_ty)return a=a.notes[d].acc,void 0==a||3==a;return;case n.NOTE:for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==c)return a=a.notes[d].acc,void 0==a||3==a}}function me(a){var c;for(c=0;c<F.length;c++){var d=F[c];if(d.id==a)return d}d=B(l);d.v=F.length;d.id=a;d.sym=d.last_sym=
null;d.key=B(l.key);d.sls=[];delete d.nm;delete d.snm;delete d.new_name;delete d.lyric_restart;delete d.lyric_cont;delete d.sym_restart;delete d.sym_cont;delete d.have_ly;delete d.tie_s;F.push(d);return d}function Hb(a){if("|"==a||")"==a)if(l.last_note)if(l.last_note.beam_end=!0,ea){l.time!=ea.p_voice.time&&(w(1,"Wrong duration in voice overlay"),l.time>ea.p_voice.time&&(ea.p_voice.time=l.time));l.acc=[];a=ea.p_voice;var c=l.last_sym;if(c.type==n.SPACE&&a.last_sym.type!=n.SPACE){c.p_v=a;for(c.v=c.p_v.v;c.prev.type==
n.SPACE;)c=c.prev,c.p_v=a,c.v=c.p_v.v;var d=c.prev;d.next=null;c.prev=a.last_sym;c.prev.next=c;a.last_sym=l.last_sym;l.last_sym=d}l=a;ea=null}else w(1,"Erroneous end of voice overlay");else w(1,I.nonote_vo);else if("("==a)ea?w(1,"Voice overlay already started"):ea={p_voice:l,time:l.time};else if(l.last_note){l.last_note.beam_end=!0;a=l.voice_down;if(!a){a=me(l.id+"o");l.voice_down=a;a.time=0;a.second=!0;var e=a.v;L.voices[e]={st:l.st,second:!0};c=L.voices[l.v].range;for(d=0;d<L.voices.length;d++)L.voices[d]&&
L.voices[d].range>c&&L.voices[d].range++;L.voices[e].range=c+1}a.ulen=l.ulen;a.dur_fact=l.dur_fact;a.acc=[];if(ea)l!=ea.p_voice&&l.time!=ea.p_voice.time&&(w(1,"Wrong duration in voice overlay"),l.time>ea.p_voice.time&&(ea.p_voice.time=l.time));else{d=a.time;for(c=l.last_sym;!(c.type==n.BAR||c.time<=d);c=c.prev);ea={bar:c&&c.bar_type?c.bar_type:"|",p_voice:l,time:c.time}}a.time=ea.time;l=a}else w(1,I.nonote_vo)}function Cc(){var a;if(!l.last_sym)return!0;if(l.time)return!1;for(a=l.last_sym;a;a=a.prev)if(Ka[a.type])return!1;
return!0}function Fe(a){if(!l.time&&Cc())l.clef=a,a.fmt=p;else{Ca(a);a.clef_small=!0;var c=a.prev;c&&c.type==n.BAR&&":"!=c.bar_type[0]&&(a.next=c,a.prev=c.prev,a.prev&&(a.prev.next=a),c.prev=a,c.next=null,l.last_sym=c,a.soln&&(delete a.soln,l.eoln=!0))}}function pd(a){var c,d=F[0],e=F.length;if(1==e&&d.default&&(delete d.default,!d.time))return d.id=a,delete d.init,p.transp&&2<=t.state&&(a=l,l=d,fc(),l=a),d;for(c=0;c<e;c++)if(d=F[c],d.id==a)return d;d={v:c,id:a,time:0,new:!0,pos:{},scale:1,ulen:ha.ulen,
dur_fact:1,key:B(t.ckey),ckey:B(t.ckey),okey:B(t.ckey),meter:B(ha.meter),wmeasure:ha.meter.wmeasure,staffnonote:1,clef:{type:n.CLEF,clef_auto:!0,clef_type:"a",time:0},acc:[],sls:[],hy_st:0};F.push(d);return d}function Pd(){S=-1;F=[];l=null;Be(!0);pb=-1;H={};da=[];cb={}}function Ae(){var a=l.clone;var c=a.vs,d=a.a,e=a.bol,f=t.istart,g=t,h=t.file;delete l.clone;"["==h[f-1]&&f--;mb++;for(a=0;a<c.length;a++)t=Object.create(g),t.line=Object.create(g.line),gd(c[a],d),Zc(t.fname,h,e,f);mb--;t=g}function gd(a){var c=
Rb(a),d=c.shift();if(d)if(l&&l.clone&&Ae(),a=0<d.indexOf(",")?d.split(","):[d],2>t.state)for(;;){d=a.shift();if(!d)break;c.length&&cc(d,c);"*"!=d&&1==t.state&&(l=pd(d))}else if("*"==d)w(1,"Cannot have V:* in tune body");else{l=pd(a[0]);1<a.length&&(a.shift(),l.clone={vs:a,a:c,bol:t.iend},"]"!=t.file[l.clone.bol-1]&&l.clone.bol++);Wc(c);a=l.v;if(l.new){delete l.new;if(0>pb)l.st=l.cst=++S,L.nstaff=S,L.voices[a]={st:S,range:a},L.staves[S]={stafflines:l.stafflines||"|||||",staffscale:1};else if(!L.voices[a]){l.ignore=
1;return}fc()}!l.filtered&&L.voices[a]&&(t.voice_opts||t.tune_v_opts)&&(l.filtered=!0,Mf())}}function tf(a,c){var d;if(!l.ignore){if(c){if(c=l.sym_cont,!c){w(1,"+: symbol line without music");return}}else if(l.sym_restart&&(l.sym_start=l.sym_restart,l.sym_restart=null),c=l.sym_start,c||(c=l.sym),!c){w(1,"s: without music");return}for(d=0;;){for(;" "==a[d]||"\t"==a[d];)d++;var e=a[d];if(!e)break;switch(e){case "|":for(;c&&c.type!=n.BAR;)c=c.next;if(!c){w(1,"Not enough measure bars for symbol line");
return}c=c.next;d++;continue;case "!":case '"':var f=++d;d=a.indexOf(e,f);if(0>d){w(1,"!"==e?"No end of decoration":"No end of chord symbol/annotation");d=a.length;continue}var g=a.slice(f-1,d+1);break;case "*":break;default:g=e.charCodeAt(0);if(128>g&&(g=za[g],1<g.length&&("!"==g[0]||'"'==g[0]))){e=g[0];break}w(1,I.bad_char,e)}for(;c&&c.type!=n.NOTE;)c=c.next;if(!c){w(1,"Too many elements in symbol line");return}switch(e){case "!":la.push(g.slice(1,-1));ib(c,c.prev);break;case '"':ne(g),Ia&&dc(c)}c=
c.next;d++}l.sym_cont=c}}function uf(a,c){var d;if(!l.ignore){(l.pos.voc&7)!=n.SL_HIDDEN&&(l.have_ly=!0);if(c){c=l.lyric_cont;if(!c){w(1,"+: lyric without music");return}var e=ma("vocal");H.deffont!=e&&(H.curfont==H.deffont&&(H.curfont=e),H.deffont=e)}else if(fa("vocal"),l.lyric_restart?(l.lyric_start=c=l.lyric_restart,l.lyric_restart=null,l.lyric_line=0):(l.lyric_line++,c=l.lyric_start),c||(c=l.sym),!c){w(1,"w: without music");return}e=0;for(d=H.curfont;;){for(;" "==a[e]||"\t"==a[e];)e++;if(!a[e])break;
var f=0;var g=t.istart+e+2;switch(a[e]){case "|":for(;c&&c.type!=n.BAR;)c=c.next;if(!c){w(1,"Not enough measure bars for lyric line");return}c=c.next;e++;continue;case "-":case "_":var h=a[e];f=2;break;case "*":h="";break;default:for(h="";a[e];){switch(a[e]){case "_":case "*":case "|":e--;case " ":case "\t":break;case "~":h+="&#x00a0;";e++;continue;case "-":f=1;break;case "\\":if(!a[++e])continue;h+=a[e++];continue;case "$":h+=a[e++];var m=a[e];"0"==m?H.curfont=H.deffont:"1"<=m&&"9">=m&&(H.curfont=
ma("u"+m));default:h+=a[e++];continue}break}}for(;c&&c.type!=n.NOTE;)c=c.next;if(!c){w(1,"Too many words in lyric line");return}h&&(c.pos.voc&7)!=n.SL_HIDDEN&&(h={t:h,font:d,istart:g,iend:g+h.length},f&&(h.ln=f),c.a_ly||(c.a_ly=[]),c.a_ly[l.lyric_line]=h,d=H.curfont);c=c.next;e++}l.lyric_cont=c}}function Oc(a){var c,d,e,f,g=a,h=0,m=0,k=0,l=0,p=a.a_ly,t=0;for(e=a.ts_next;e;e=e.ts_next){e.shrink&&(l+=e.shrink,k++);if(e.bar_type){l+=3;break}if(e.a_ly){for(c=e.a_ly.length;0<=--c&&(!(d=e.a_ly[c])||2==
d.ln););if(0<=c)break}}for(c=0;c<p.length;c++)if(d=p[c])if(H.curfont=d.font,d.t=f=qb(d.t),2==d.ln)d.shift=0;else{var y=mc(" ")*d.font.swfac;var u=f.wh[0]+1.5*y;if(a.type==n.GRACE)var v=a.wl;else"0"<=f[0]&&"9">=f[0]&&2<f.length||":"==f[1]||"("==f[0]||")"==f[0]?("("!=f[0]&&(y=f.indexOf("&#x00a0;"),fa(d.font),y=0<y?sa(f.slice(0,y))[0]:.2*u),u-=y,v=.4*u,14<v&&(v=14),v+=y,"0"<=f[0]&&"9">=f[0]&&v>t&&(t=v)):(v=.4*u,14<v&&(v=14));d.shift=v;v>m&&(m=v);u-=v;u>h&&(h=u)}for(;!g.seqst;)g=g.ts_prev;g.ts_prev&&
g.ts_prev.bar_type&&(m-=4);g.wl<m&&(g.shrink+=m-g.wl,g.wl=m);l-=6;if(l<h)for(l=(h-l)/k,a=a.ts_next;;){a.shrink&&(a.shrink+=l,g.wr+=l,g=a);if(a==e)break;a=a.ts_next}if(0<t)for(c=0;c<p.length;c++)(d=p[c])&&"0"<=d.t[0]&&"9">=d.t[0]&&(d.shift=t)}function Ge(a,c,d){var e,f,g;if(a.hy_st&1<<c){var h=!0;a.hy_st&=~(1<<c)}for(e=a.sym;e.type==n.CLEF||e.type==n.KEY||e.type==n.METER;e=e.next);var m=e.prev?e.prev.x:P.x;for(g=0;e;e=e.next)if(f=e.a_ly?e.a_ly[c]:null){f.font!=H.curfont&&(H.curfont=f.font);var k=f.t;
var l=k.wh[0];var p=f.shift;h&&(2==f.ln&&"_"==k?k="-":2!=f.ln&&(te(m,d,e.x-p-m),h=!1,m=e.x+e.wr));if(t&&(2!=f.ln||"_"!=k)){nd(m+3,d,g-m+3);var t=!1;m=e.x+e.wr}if(2==f.ln)0==g&&m>e.x-18&&(m=e.x-18),"-"==k?h=!0:t=!0,g=e.x-p;else{g=e.x-p;f.ln&&(h=!0);if(q.anno_start||q.anno_stop){var y={st:e.st,istart:f.istart,iend:f.iend,x:g,y:d,ymn:d,ymx:d+H.curfont.size,wl:0,wr:l};pa(y,"lyrics")}ka(g,d,k);Mb(y,"lyrics");m=g+l}}else switch(e.type){case n.REST:case n.MREST:t&&(nd(m+3,d,g-m),t=!1,m=e.x+e.wr)}h&&(g=ra-
10,g<m+10&&(g=m+10),te(m,d,g-m),a.s_next&&a.s_next.fmt.hyphencont&&(a.hy_st|=1<<c));for(a.s_next;e;e=e.next)if(e.type==n.NOTE){if(!e.a_ly)break;(f=e.a_ly[c])&&f.ln&&"_"==f.t&&(t=!0,g=ra-15,g<m+12&&(g=m+12));break}t&&nd(m+3,d,g-m+3)}function He(a,c,d,e,f){var g=z[a.st].staffscale;fa("vocal");if(0<f){e>-P.fmt.vocalspace&&(e=-P.fmt.vocalspace);e*=g;for(f=0;f<c;f++)e-=1.1*d[f],Ge(a,f,e);return(e-d[f-1]/6)/g}f=z[a.st].topbar+P.fmt.vocalspace;e<f&&(e=f);e*=g;for(f=c;0<=--f;)Ge(a,f,e),e+=1.1*d[f];return e/
g}function ff(){var a,c,d,e,f,g=Array(S+1),h=F.length,m=Array(h),k=Array(h),l=Array(h),p=Array(h),t=0,y=0,u=-1;for(c=0;c<h;c++){var v=F[c];if(v.sym){v.st!=u&&(y=t=0,u=v.st);var q=0;if(v.have_ly)for(m[c]||(m[c]=[]),a=v.sym;a;a=a.next){if(e=a.a_ly){var x=a.x;var w=10;for(d=0;d<e.length;d++)if(f=e[d]){x-=f.shift;w=f.t.wh[0];break}d=aa(v.st,1,x,w);t<d&&(t=d);d=aa(v.st,0,x,w);for(y>d&&(y=d);q<e.length;)m[c][q++]=0;for(d=0;d<e.length;d++)(f=e[d])&&(!m[c][d]||f.t.wh[1]>m[c][d])&&(m[c][d]=f.t.wh[1])}}else d=
aa(v.st,1,0,ra),t<d&&(t=d),d=aa(v.st,0,0,ra),y>d&&(y=d);g[u]||(g[u]={});g[u].top=t;g[u].bot=y;k[c]=q;0!=q&&(l[c]=v.pos.voc?(v.pos.voc&7)==n.SL_ABOVE:F[c+1]&&F[c+1].st==u&&F[c+1].have_ly?!0:!1,l[c]?g[u].a=!0:g[u].b=!0)}}for(c=d=0;c<h;c++)v=F[c],v.sym&&v.have_ly&&(l[c]?p[d++]=c:(u=v.st,Ea(u,!0),0<k[c]&&(g[u].bot=He(v,k[c],m[c],g[u].bot,1))));for(;0<=--d;)c=p[d],v=F[c],u=v.st,Ea(u,!0),g[u].top=He(v,k[c],m[c],g[u].top,-1);for(c=0;c<h;c++)if(v=F[c],v.sym){u=v.st;if(g[u].a)for(t=g[u].top+2,a=v.sym.next;a;a=
a.next)a.a_ly&&Y(u,1,a.x-2,10,t);if(g[u].b)if(y=g[u].bot-2,0<k[v.v])for(a=v.sym.next;a;a=a.next)a.a_ly&&Y(u,0,a.x-2,10,y);else Y(u,0,0,ra,y)}}function ne(a){function c(){for(var a="";;){r=m[d++];if(0>"1234567890.-".indexOf(r))return parseFloat(a);a+=r}}var d,e=ma("annotation"),f=e.size;var g=t.line;var h=t.bol+g.index;if(1<a.length){var m=a.slice(1,-1);var k=h+1}else{for(d=++g.index;;){a=g.buffer.indexOf('"',d);if(0>a){w(1,"No end of chord symbol/annotation");return}if("\\"!=g.buffer[a-1])break;d=
a+1}m=Ob(g.buffer.slice(g.index,a));g.index=a;k=t.bol+g.index+1}e.pad&&(f+=e.pad);d=0;for(a="g";;){var r=m[d];if(!r)break;g={text:"",istart:h,iend:k,font:e};switch(r){case "@":a=r;d++;var p=c();if(","!=r){w(1,"',' lacking in annotation '@x,y'");var q=0}else q=c()," "!=r&&d--;g.x=p;q-=.3*f;g.y=q;break;case "^":g.pos=n.SL_ABOVE;case "_":"_"==r&&(g.pos=n.SL_BELOW);case "<":case ">":d++;a=r;break;default:switch(a){case "g":g.font=ma("gchord");g.pos=l.pos.gch||n.SL_ABOVE;break;case "^":g.pos=n.SL_ABOVE;
break;case "_":g.pos=n.SL_BELOW;break;case "@":g.x=p,q-=f,g.y=q}}for(g.type=a;;){r=m[d];if(!r)break;switch(r){case "\\":r=m[++d];if(!r||"n"==r)break;g.text+="\\";default:g.text+=r;d++;continue;case "&":for(;;){g.text+=r;r=m[++d];switch(r){default:continue;case ";":case void 0:case "\\":}break}if(";"==r){d++;g.text+=r;continue}case ";":}d++;break}g.otext=g.text;Ia||(Ia=[]);Ia.push(g)}}function Od(a,c){var d,e,f=a.split("/");for(d=0;d<f.length;d++){a=f[d];var g=a.search(/[A-G]/);if(!(0>g)){var h=g+
1;for(e=0;"#"==a[h]||"\u266f"==a[h];)e++,h++;for(;"b"==a[h]||"\u266d"==a[h];)e--,h++;var m=Ie.indexOf(a[g])+16;m=(abc2svg.pab40(m,e)+c+200)%40;m=abc2svg.b40k[m];f[d]=a.slice(0,g)+Ie[abc2svg.b40_p[m]]+Nf[abc2svg.b40_a[m]+2]+a.slice(h)}}return f.join("/")}function dc(a){var c;if(a.type==n.BAR)for(c=0;c<Ia.length;c++)"g"==Ia[c].type&&(w(1,"There cannot be chord symbols on measure bars"),Ia.splice(c));a.a_gch=a.a_gch?a.a_gch.concat(Ia):Ia;Ia=null}function Ye(){function a(a){var c,d,f;for(d=e;d;d=d.ts_next)if(c=
d.a_gch){var g=c.length-a-1;if(c=c[g]){if(c.pos==n.SL_ABOVE){var h=d.x+c.x;(f=c.text.wh[0])&&h+f>ra&&(h=ra-f);f=aa(d.st,1,h,f);"g"==c.type&&f<m[d.st].yup&&(f=m[d.st].yup)}else if(c.pos==n.SL_BELOW||c.pos==n.SL_HIDDEN)continue;else h=d.x+c.x,f=c.y;V.draw_gchord(g,d,h,f)}}}function c(a){for(var c,d,f,g=e;g;g=g.ts_next)(c=g.a_gch)&&(c=c[a])&&c.pos==n.SL_BELOW&&(d=g.x+c.x,(f=c.text.wh[0])&&d+f>ra&&(d=ra-f),f=aa(g.st,0,d,f),"g"==c.type&&f>m[g.st].ydn&&(f=m[g.st].ydn),V.draw_gchord(a,g,d,f))}var d,e,f,
g,h=0,m=Array(S+1);for(g=0;g<=S;g++)m[g]={ydn:z[g].botbar-3,yup:z[g].topbar+4};for(d=P;d;d=d.ts_next)if(f=d.a_gch)for(e||(e=d),g=f.length,g>h&&(h=g);0<=--g;)if("g"==f[g].type){f=f[g];g=f.text.wh[0];f.pos==n.SL_ABOVE?(f=aa(d.st,!0,d.x,g),f>m[d.st].yup&&(m[d.st].yup=f)):f.pos==n.SL_BELOW&&(f=aa(d.st,!1,d.x,g),f<m[d.st].ydn&&(m[d.st].ydn=f));break}if(e)for(Ea(-1),g=0;g<h;g++)a(g),c(g)}function sf(){function a(a){for(var c=0;c<a.length;c++)a[c](V)}var c=abc2svg.modules.hooks,d=abc2svg.modules.g_hooks;
Je?c.length&&(a(c),d.push.apply(d,c),abc2svg.modules.hooks=[]):(c.length&&(d.push.apply(d,c),abc2svg.modules.hooks=[]),a(d),Je=!0)}var n=abc2svg.C,Ha,I={bad_char:"Bad character '$1'",bad_grace:"Bad character in grace note sequence",bad_transp:"Bad transpose value",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%score",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",
not_ascii:"Not an ASCII character",not_enough_n:"Not enough notes/rests for %%repeat",not_enough_m:"Not enough measures for %%repeat",not_enough_p:"Not enough parameters in %%map",not_in_tune:"Cannot have '$1' inside a tune",notransp:"Cannot transpose with a temperament"},V=this,ha={meter:{type:n.METER,wmeasure:1,a_meter:[]}},N={},t={ctx:{},prefix:"%",state:0,ottava:[],line:new K},ad=[],ze,Bb={},da,cb,$b={dot:"0 stc 6 1 1",tenuto:"0 emb 6 3 3",slide:"1 sld 3 7 0",arpeggio:"2 arp 12 10 2",roll:"3 roll 3,3 6 6",
emphasis:"3 accent 3.5,3.5 4 4",lowermordent:"3 lmrd 4,4 5 5",uppermordent:"3 umrd 4,4 5 5",trill:"3 trl 14 5 5",upbow:"3 upb 10 5 5",downbow:"3 dnb 9 5 5",gmark:"3 grm 6 5 5",wedge:"0 wedge 8 3 3",longphrase:"3 lphr 0 1 1",mediumphrase:"3 mphr 0 1 1",shortphrase:"3 sphr 0 1 1",turnx:"3 turnx 5,5 6 6",invertedturn:"3 turn 5,5 6 6",0:"3 fng 5,5 3 3 0",1:"3 fng 5,5 3 3 1",2:"3 fng 5,5 3 3 2",3:"3 fng 5,5 3 3 3",4:"3 fng 5,5 3 3 4",5:"3 fng 5,5 3 3 5",plus:"3 dplus 7 3 3","+":"3 dplus 7 3 3",accent:"3 accent 3.5,3.5 4 4",
">":"3 accent 3.5,3.5 4 4",marcato:"3 marcato 9 3 3","^":"3 marcato 9 3 3",mordent:"3 lmrd 4,4 5 5",open:"3 opend 10 3 3",snap:"3 snap 14 3 3",thumb:"3 thumb 14 3 3",turn:"3 turn 5,5 6 6","trill(":"3 ltr 8 4 0","trill)":"3 ltr 8 4 0","8va(":"5 8va 12 6 6","8va)":"5 8va 12 6 6","8vb(":"7 8vb 12 6 6","8vb)":"7 8vb 12 6 6","15ma(":"5 15ma 12 9 9","15ma)":"5 15ma 12 9 9","15mb(":"7 15mb 12 9 9","15mb)":"7 15mb 12 9 9",breath:"5 brth 0 1 20",caesura:"5 caes 0 1 10",short:"5 short 0 1 4",tick:"5 tick 0 1 4",
coda:"5 coda 24 10 10",dacapo:"5 dacs 16 20 20 Da Capo",dacoda:"5 dacs 16 20 20 Da Coda","D.C.":"5 dcap 16 10 10","D.S.":"5 dsgn 16 10 10","D.C.alcoda":"5 dacs 16 38 38 D.C. al Coda","D.S.alcoda":"5 dacs 16 38 38 D.S. al Coda","D.C.alfine":"5 dacs 16 38 38 D.C. al Fine","D.S.alfine":"5 dacs 16 38 38 D.S. al Fine",fermata:"3 hld 12 7 7",fine:"5 dacs 16 10 10 Fine",invertedfermata:"4 hld 12 7 7",segno:"5 sgno 22 8 8",f:"6 f 18 4 4",ff:"6 ff 18 6 6",fff:"6 fff 18 9 9",ffff:"6 ffff 18 12 12",mf:"6 mf 18 9 9",
mp:"6 mp 18 10 10",p:"6 p 18 5 5",pp:"6 pp 18 9 9",ppp:"6 ppp 18 13 13",pppp:"6 pppp 18 17 17",pralltriller:"3 umrd 4,4 5 5",sfz:"6 sfz 18 8 8",ped:"7 ped 18 6 10","ped-up":"7 pedoff 12 4 4","ped(":"7 lped 20 5 5","ped)":"7 lped 20 5 5","crescendo(":"6 cresc 18 0 0","crescendo)":"6 cresc 18 0 0","<(":"6 cresc 18 0 0","<)":"6 cresc 18 0 0","diminuendo(":"6 dim 18 0 0","diminuendo)":"6 dim 18 0 0",">(":"6 dim 18 0 0",">)":"6 dim 18 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0",
"~)":"8 glisq 0 0 0",invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",rbstop:"37 0 0 0 0","/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0",editorial:"42 0 0 0 0","sacc-1":"3 sacc-1 6,4 4 4",sacc3:"3 sacc3 6,5 4 4",sacc1:"3 sacc1 6,4 4 4",courtesy:"43 0 0 0 0","cacc-1":"3 cacc-1 0 0 0",
cacc3:"3 cacc3 0 0 0",cacc1:"3 cacc1 0 0 0","tie(":"44 0 0 0 0","tie)":"44 0 0 0 0"},vd=[function(a){var c,d=a.s,e=a.dd;if(!e.str){var f=(c="^"==e.ty?1:"_"==e.ty?0:d.multi?0<d.multi:0>d.stem)?d.ymx:d.ymn;0<f&&24>f&&(f=6*((f+9)/6|0)-6);c?(f+=e.hd,d.ymx=f+e.h):"w"==e.name[0]?(a.inv=!0,f-=e.h,d.ymn=f):(f-=e.h,d.ymn=f-e.hd);a.y=f;d.type==n.NOTE&&(a.x+=d.notes[0<=d.stem?0:d.nhd].shhd);"d"==e.name[0]&&(d.beam_st&&d.beam_end?c&&0<d.stem&&(f=d.y+.6*(f-d.y),27<=f&&(a.y=f,d.ymx=a.y+e.h)):c?0<d.stem&&(a.x+=
3.5):0>d.stem&&(a.x-=3.5))}},function(a){var c,d=a.s,e=d.notes[0].pit,f=5;for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=4+d.notes[c].shac;else switch(g=5-d.notes[c].shhd,d.head){case n.SQUARE:g+=3.5;break;case n.OVALBARS:case n.OVAL:g+=2}d.notes[c].pit<=e+3&&g>f&&(f=g)}a.x-=f;a.y=3*(e-18)},function(a){var c,d=a.s,e=a.dd,f=e.wr;if(d.type==n.NOTE)for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=d.notes[c].shac;else switch(g=1-d.notes[c].shhd,d.head){case n.SQUARE:g+=3.5;break;case n.OVALBARS:case n.OVAL:g+=
2}g>f&&(f=g)}g=3*(d.notes[d.nhd].pit-d.notes[0].pit)+4;c=e.h;g<c&&(g=c);a.has_val=!0;a.val=g;a.x-=f;a.y=3*((d.notes[0].pit+d.notes[d.nhd].pit)/2-18)-g/2-3}],wd=[null,null,null,Jb,Jb],Wa=[null,null,null,null,null,Jb,function(a){var c,d,e=a.s,f=a.dd;if(!a.ldst)if((a.pos&n.SL_ALI_MSK)==n.SL_CLOSE||0==(a.pos&n.SL_ALI_MSK)&&0>e.fmt.dynalign)Jb(a);else if(a.start){if(!a.ldst){e=a.dd;var g=a.s;var h=a.start;var m=h.s;f=m.x+3;a.st=g.st;a.lden=!1;a.has_val=!0;"^"==e.ty?c=1:"_"!=e.ty&&(c=Zb(g,g.pos.dyn));c&&
(a.up=!0);for(d=h.ix;0<=--d;){var k=da[d];if(!k||k.s!=m)break}for(;;){d++;k=da[d];if(!k||k.s!=m)break;if(k!=a&&k!=h&&!(a.up^k.up)&&Wa[k.dd.func]){m=k.x+k.dd.wr+2;m>f&&(f=m);break}}if(a.defl.noen)d=a.x-f,20>d&&(f=a.x-20-3,d=20);else{m=g.x;for(d=a.ix;0<--d&&(k=da[d],k&&k.s==g););for(;;){d++;k=da[d];if(!k||k.s!=g)break;if(k!=a&&k!=h&&!(a.up^k.up)&&Wa[k.dd.func]){m-=k.dd.wl;break}}d=m-f-4;20>d&&(f-=.5*(20-d),d=20)}a.val=d;a.x=f;a.y=aa(a.st,c,f,d);a.y=c?a.y+e.hd:a.y-e.h}}else{a.val=f.wl+f.wr;if(d=Zb(e,
a.pos))a.up=!0;c=e.x;0<a.ix&&(g=da[a.ix-1],g.s==e&&(a.up&&!g.up||!a.up&&g.up)&&(k=g.dd,Wa[k.func]&&(k=g.x+g.val+4,k>c&&(c=k))));a.x=c;a.y=aa(e.st,d,c-f.wl,a.val);a.y=d?a.y+f.hd:a.y-f.h}},Jb];Abc.prototype.draw_all_deco=function(){if(da.length){var a,c,d=[],e=[];var f=S;for(c=z[f].y;0<=--f;){var g=z[f].y;e[f]=.5*(c+24+g);c=g}for(;;){var h=da.shift();if(!h)break;if((a=h.dd)&&!a.dd_en){var m=h.s;var k=a.glyph;var l=k.indexOf("/");0<l&&(k=0<=m.stem?k.slice(0,l):k.slice(l+1));Wa[a.func]?Fa(m.st):Ub(m);
f=h.st;if(z[f].topbar){l=h.x;c=h.y+z[f].y;if(void 0!=h.m)f=m.notes[h.m],f.shhd&&(l+=f.shhd*E.scale);else if(6==a.func&&((h.pos&n.SL_ALI_MSK)==n.SL_CENTER||0==(h.pos&n.SL_ALI_MSK)&&!m.fmt.dynalign)&&(h.up&&0<f||!h.up&&f<S)){var p=h.up?e[--f]:e[f++];p-=.5*a.h;if(h.up&&c<p||!h.up&&c>p)if(g=aa(f,!h.up,h.x,h.val)+z[f].y,h.up&&(g-=a.h),h.up&&g>p||!h.up&&g<p)c=p,1!=E.scale&&(c+=E.dy/2)}if((f=q[k])&&"function"==typeof f)f(l,c,h);else if(!V.psdeco(k,l,c,h)){pa(m,"deco");h.inv&&(c=c+a.h-a.hd,kb(l,c,0,1,-1),
l=c=0);if(h.has_val)2!=a.func||0>E.st?od(l,c,k,h.val/E.scale,h.defl):od(l,c,k,h.val,h.defl),h.cont&&d.push(h.start);else if(void 0!=a.str)h=a.str,"@"==h[0]&&(a=h.match(/^@([0-9.-]+),([0-9.-]+);?/),l+=Number(a[1]),c+=Number(a[2]),h=h.replace(a[0],"")),ue(l,c,k,h);else if(h.lden)if(k=h.dd.glyph,Ke[k])Ke[k](l,c,h);else x(1,null,"No function for decoration '$1'",k);else Q(l,c,k);E.g&&Db();Mb(m,"deco")}}}}da=d}};var rc,gc=[],Of=[[16,16,14,12,10,10],[14,14,10,9,9,9]];Abc.prototype.calculate_beam=function(a,
c){var d,e,f,g,h,m;if(!c.beam_st){var k=xd(c);Ic(k,c);Pb(k,c);k.x-=12;k.x>c.prev.x+12&&(k.x=c.prev.x+12);k.beam_st=!0;delete k.beam_end;k.tmp=!0;delete k.sls;c=k}var l=e=0;var p=f=!1;var t=c.st;var q=c.v;var u=c.grace?2.3:3.5;for(d=c;d.type!=n.NOTE||(d.nflags>e&&(e=d.nflags),l++,d.st!=t&&(p=!0),d.stem!=c.stem&&(f=!0),g||d.invis||d.stemless&&!d.trem2||(g=!0),!d.beam_end);d=d.next)if(!d.next){for(;d.type!=n.NOTE;d=d.prev);k=xd(d);k.next=d.next;k.next&&(k.next.prev=k);d.next=k;k.prev=d;k.ts_next=d.ts_next;
k.ts_next&&(k.ts_next.ts_prev=k);d.ts_next=k;k.ts_prev=d;delete k.beam_st;k.beam_end=!0;k.tmp=!0;delete k.sls;k.x+=12;k.x<ra-12&&(k.x=ra-12);d=k;l++;break}if(!g)return!1;a.s2=d;if(0==z[t].y){if(p)return!1}else if(!p)return a.s1=c,a.a=(c.ys-d.ys)/(c.xs-d.xs),a.b=c.ys-c.xs*a.a+z[t].y,a.nflags=e,!0;var v=c;var x=100;var w=0;for(k=c;k.type!=n.NOTE||(1==(m=k.p_v.scale)&&(m=z[k.st].staffscale),0<=k.stem?(g=u+k.notes[0].shhd,k.notes[k.nhd].pit>w&&(w=k.notes[k.nhd].pit,v=k)):(g=-u+k.notes[k.nhd].shhd,k.notes[0].pit<
x&&(x=k.notes[0].pit,v=k)),k.xs=k.x+g*m,k!=d);k=k.next);k.grace&&c.fmt.flatbeams?h=0:!f&&3<=l&&v!=c&&v!=d&&(h=0);g=c.ys+z[t].y;void 0==h&&(h=(d.ys+z[d.st].y-g)/(d.xs-c.xs));0!=h&&(h=c.fmt.beamslope*h/(c.fmt.beamslope+Math.abs(h)),-.04<h&&.04>h&&(h=0));l=(g+d.ys+z[d.st].y)/2-h*(d.xs+c.xs)/2;u=0;k=c;if(f)g=.5*((c.grace?3.5:5)*(e-1)+3.2),c.nflags!=d.nflags&&(l=c.stem!=d.stem&&c.nflags<d.nflags?l+g*d.stem:l+g*c.stem);else if(c.grace)for(;g=h*k.xs+l-z[k.st].y,w=13,w=0<k.stem?w-(g-3*(k.notes[k.nhd].pit-
18)):w+(g-3*(k.notes[0].pit-18)),w+=3*(k.nflags-1),w>u&&(u=w),k!=d;k=k.next);else{for(x=3.2+5*(e-1);k.ts_prev&&k.ts_prev.type==n.NOTE&&k.ts_prev.time==k.time&&k.ts_prev.x>c.xs;)k=k.ts_prev;for(;k&&k.time<=d.time;k=k.ts_next)if(!(k.type!=n.NOTE||k.invis||k.st!=t&&k.v!=q)){g=k.v==q?k.xs:k.x;g=h*g+l-z[k.st].y;if(k.v==q)w=Of[0==k.nhd?0:1][k.nflags],0<k.stem?(26<k.notes[k.nhd].pit&&(w-=2,28<k.notes[k.nhd].pit&&(w-=2)),w-=g-3*(k.notes[k.nhd].pit-18)):(18>k.notes[0].pit&&(w-=2,16>k.notes[0].pit&&(w-=2)),
w-=3*(k.notes[0].pit-18)-g),w+=3.2+5*(k.nflags-1);else{if(0<c.stem)if(0<k.stem){if(k.ymn>g+4||k.ymx<g-x-2)continue;w=k.v>q?k.ymx-g:k.ymn+8-g}else w=k.ymx-g;else if(0>k.stem){if(k.ymx<g-4||k.ymn>g-x-2)continue;w=k.v<q?g-k.ymn:g-k.ymx+8}else w=g-k.ymn;w+=2+x}w>u&&(u=w)}}0<u&&(l+=c.stem*u);if(!p&&!f)for(k=c.next;;k=k.next){switch(k.type){case n.REST:if(!k.multi)break;q=k.ts_next;if(!q||q.st!=t||q.type!=n.NOTE&&q.type!=n.REST)break;case n.BAR:if(k.invis)break;case n.CLEF:g=h*k.x+l;0<c.stem?(g=k.ymx-g+
3.2+5*(e-1)+2,0<g&&(l+=g)):(g=k.ymn-g-3.2-5*(e-1)-2,0>g&&(l+=g));break;case n.GRACE:for(q=k.extra;q;q=q.next)g=h*q.x+l,0<c.stem?(g=q.ymx-g+3.2+5*(e-1)+2,0<g&&(l+=g)):(g=q.ymn-g-3.2-5*(e-1)-2,0>g&&(l+=g))}if(k==d)break}0==h&&(l+=$e(c.grace,c.stem,e,l-z[t].y));for(k=c;;k=k.next){switch(k.type){case n.NOTE:k.ys=h*k.xs+l-z[k.st].y;0<k.stem?(k.ymx=k.ys+2.5,k.ts_prev&&0<k.ts_prev.stem&&k.ts_prev.st==k.st&&k.ts_prev.ymn<k.ymx&&k.ts_prev.x==k.x&&0==k.notes[0].shhd&&(k.ts_prev.x-=3,k.ts_prev.xs-=3)):k.ymn=
k.ys-2.5;break;case n.REST:g=h*k.x+l-z[k.st].y;q=3.2+5*(e-1)+(k.head!=n.FULL?4:9);if(0<c.stem){if(g-=q,0==c.multi&&12<g&&(g=12),k.y<=g)break}else if(g+=q,0==c.multi&&12>g&&(g=12),k.y>=g)break;k.head!=n.FULL&&(g=6*((g+3+12)/6|0)-12);k.y=g}if(k==d)break}if(0==z[t].y)return!1;a.s1=c;a.a=h;a.b=l;a.nflags=e;return!0};var Bd={};Abc.prototype.draw_hl=function(a){var c,d,e=[],f=z[a.st];if(f.hll&&!a.invis){for(c=0;c<=a.nhd;c++){var g=a.notes[c];f.hlmap[g.pit-f.hll]||e.push([g.pit-18,g.shhd*E.scale])}if(d=
e.length){var h=f.stafflines,m=h.length-1,k=m,l=f.botline/6,n=l,p=a.grace?4:1.3*Le[a.head];g=a.notes[0>a.stem?a.nhd:0];var t=g.shhd;for(c=0;c<e.length;c++){var u=e[c][0];g=(e[c][1]<t?e[c][1]:t)-p;var q=(e[c][1]>t?e[c][1]:t)+p;u<2*l?(u<2*n&&(n=++u>>1),d--):u>2*m&&(k=u>>1,d--);Oa(f,u>>1,a.x,g,q)}g=t-p;for(q=t+p;++n<l;)Oa(f,n,a.x,g,q);for(;--k>m;)Oa(f,k,a.x,g,q);if(d){c=n;for(d=k;c>l&&"-"==h[c];)c--;for(;d<m&&"-"==h[d];)d++;for(;c<d;c++)"-"==h[c]&&Oa(f,c,a.x,g,q)}}}};var Me=new Int8Array([24,9,15,21,
6,12,18]),Ne=new Int8Array([12,18,24,9,15,21,6]),Oe=new Int8Array([-9,12,-9,-9,12,-9]),Pe=new Int8Array([12,-9,12,-9,12,-9]),Qe=new Int8Array([9,-12,9,-12,9,-12]),Re=new Int8Array([-12,9,-12,9,-12,9]);Abc.prototype.draw_keysig=function(a,c){var d=c.k_old_sf,e=z[c.st].y,f,g=c.k_y_clef;g&1&&(g+=7);for(g/=2;0>g;)g+=7;g%=7;if(!c.k_a_acc){if(c.fmt.cancelkey||0==c.k_sf)if(0==c.k_sf||0>d*c.k_sf){var h=Me[g];var m=9<h?Oe:Pe;for(f=0;f<d;f++)Q(a,e+h,"acc3"),h+=m[f],a+=5.5;h=Ne[g];m=18>h?Qe:Re;for(f=0;f>d;f--)Q(a,
e+h,"acc3"),h+=m[-f],a+=5.5;0!=c.k_sf&&(a+=3)}if(0<c.k_sf){h=Me[g];m=9<h?Oe:Pe;for(f=0;f<c.k_sf;f++)Q(a,e+h,"acc1"),h+=m[f],a+=5.5;if(c.fmt.cancelkey&&f<d)for(a+=2;f<d;f++)Q(a,e+h,"acc3"),h+=m[f],a+=5.5}if(0>c.k_sf){h=Ne[g];m=18>h?Qe:Re;for(f=0;f>c.k_sf;f--)Q(a,e+h,"acc-1"),h+=m[-f],a+=5.5;if(c.fmt.cancelkey&&f>d)for(a+=2;f>d;f--)Q(a,e+h,"acc3"),h+=m[-f],a+=5.5}}else if(c.k_a_acc.length){m=c.k_a_acc[0].acc;g=100;var k=[{}];for(f=0;f<c.k_a_acc.length;f++){d=c.k_a_acc[f];for(h=3*(c.k_y_clef+d.pit-18);-3>
h;)h+=21;for(;27<h;)h-=21;0!=f&&(h>g+18||h<g-18)?a-=5.5:d.acc!=m&&(a+=3);m=d.acc;k[0].pit=h/3+18;g=h;Tc(a,e+h,d.acc);a+=5.5}}};var Pf="r128 r64 r32 r16 r8 r4 r2 r1 r0 r00".split(" ");Abc.prototype.draw_symbols=function(a){var c={},d;for(d=a.sym;d;d=d.next){if(d.invis)switch(d.type){case n.KEY:a.ckey=d;default:continue;case n.NOTE:}var e=d.st;var f=d.x;Xa(d.color);switch(d.type){case n.NOTE:Ub(d);d.beam_st&&!d.beam_end&&V.calculate_beam(c,d)&&yd(c);d.invis||(pa(d),pc(d,!c.s2),gc.push(d));d==c.s2&&
(c.s2=null);break;case n.REST:if(!H.st_print[e])break;var g=d;var h=z[g.st];var m=h.y,k=g.x;g.notes[0].shhd&&(k+=g.notes[0].shhd*E.scale);if(g.rep_nb)Fa(g.st),pa(g),m="|||||"==h.stafflines?m+12:m+(h.topbar+h.botbar)/2,0>g.rep_nb?Q(k,m,"srep"):(Q(k,m,"mrep"),2<g.rep_nb&&g.v==J.top_voice&&0<g.fmt.measrepnb&&!(g.rep_nb%g.fmt.measrepnb)&&Cd(k,m+h.topbar,g.rep_nb));else{Ub(g);pa(g);g.notes[0].color&&Xa(g.notes[0].color);f=g.y;e=5-g.nflags;7==e&&12==f&&2>=h.stafflines.length&&(f-=6);g.notes[0].invis||Q(k,
f+m,Pf[e]);if(g.dots)for(k+=8,f+=m+3,h=g.dots,e=g.dur_orig/12>>5-g.nflags-h;0<h--;)Q(k,f,e&1<<h?"dot":"dot+"),k+=3.5;Xa()}gc.push(g);break;case n.BAR:break;case n.CLEF:d.time>=z[e].clef.time&&(z[e].clef=d);if(d.second||!z[e].topbar)break;Xa();Fa(e);pa(d);e=z[e].y;d.clef_name?Q(f,e+d.y,d.clef_name):d.clef_small?Q(f,e+d.y,"s"+d.clef_type+"clef"):Q(f,e+d.y,d.clef_type+"clef");d.clef_octave&&(0<d.clef_octave?(e+=d.ymx-10,d.clef_small&&--e):(e+=d.ymn+6,d.clef_small&&(e+=1)),Q(f-2,e,7==d.clef_octave||-7==
d.clef_octave?"oct":"oct2"));gc.push(d);break;case n.METER:a.meter=d;if(d.second||!z[d.st].topbar)break;Xa();Fa(d.st);pa(d);Ad(d);gc.push(d);break;case n.KEY:a.ckey=d;if(d.second||!z[d.st].topbar)break;Xa();Fa(d.st);pa(d);V.draw_keysig(f,d);gc.push(d);break;case n.MREST:f=d;e=z[f.st];e=e.y+(e.topbar+e.botbar)/2;g=f.nmes.toString();if(f.next){Ub(f);for(k=f;!k.seqst;)k=k.ts_prev;for(k=k.ts_prev;!k.seqst;)k=k.ts_prev;h=k.x+20;k=f.next.x-20;f.x=(h+k)/2;pa(f);U('<path d="mX Y',h+.6,e-2.7);G+="v2.7h-1.4v-10.8h1.4v2.7h"+
((k-h-2.8)/E.scale).toFixed(1)+'v-2.7h1.4v10.8h-1.4v-2.7z"/>\n';U('<text x ="X" y="Y" text-anchor="middle">A</text>\n',f.x,e+22,oc(g));gc.push(f)}else x(1,f,"Lack of bar after multi-measure rest");break;case n.GRACE:Ub(d);f=d;g={};for(e=f.extra;;){e.beam_st&&!e.beam_end&&V.calculate_beam(g,e)&&yd(g);pa(e);pc(e,!g.s2);e==g.s2&&(g.s2=null);gc.push(f);if(!e.next)break;e=e.next}f.sappo&&(e=f.extra,e.next?(k=.5*(e.next.x-e.x)+4,g=.5*(e.ys+e.next.ys)-e.y,g=0<e.stem?g-1:g+1):(k=9,g=0<e.stem?5:-5),m=e.notes[0>
e.stem?0:e.nhd],h=e.x+m.shhd*E.scale,m=z[e.st].y+3*(m.pit-18),0<e.stem?(--h,m+=4):(h-=5,m-=4),U('<path class="stroke" d="mX YlF G"/>\n',h,m,k,-g));if(e=f.slur)pa(f,"slur"),Cb(e.x0,e.y0+z[f.st].y),G+="c"+e.x1.toFixed(1)+" "+e.y1.toFixed(1)+" "+e.x2.toFixed(1)+" "+e.y2.toFixed(1)+" "+e.x3.toFixed(1)+" "+e.y3.toFixed(1)+'"/>\n',Mb(f,"slur");break;case n.SPACE:case n.STBRK:break;case n.CUSTOS:Ub(d);pc(d,0);break;case n.BLOCK:case n.REMARK:case n.STAVES:case n.TEMPO:break;default:x(2,d,"draw_symbols - Cannot draw symbol "+
d.type)}}Ub(a.sym)};var Fb=[],Ld={},Hd={serif:1,serifBold:1,"sans-serif":1,"sans-serifBold":1,Palatino:1.1,monospace:1.35},Se={},p={"abc-version":"1",annotationfont:{name:"text,sans-serif",size:12},aligncomposer:1,beamslope:.4,bardef:{"[":"","[]":"","|:":"[|:","|::":"[|::","|:::":"[|:::",":|":":|]","::|":"::|]",":::|":":::|]","::":":][:"},breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerfont:{name:"text,serif",style:"italic",size:14},composerspace:6,decoerr:!0,dynalign:!0,footerfont:{name:"text,serif",
size:16},fullsvg:"",gchordfont:{name:"text,sans-serif",size:12},gracespace:new Float32Array([6,8,11]),graceslurs:!0,headerfont:{name:"text,serif",size:16},historyfont:{name:"text,serif",size:16},hyphencont:!0,indent:0,infofont:{name:"text,serif",style:"italic",size:14},infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:1.4*37.8,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2E3,maxsysstaffsep:2E3,
measrepnb:1,measurefont:{name:"text,serif",style:"italic",size:10},measurenb:-1,musicfont:{name:"music",src:'url("data:application/octet-stream;base64,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Ngd1bmlFMDg3B3VuaUUwODgHdW5pRTA4OQd1bmlFMDhBB3VuaUUwOEIHdW5pRTA4Qwd1bmlFMDk0B3VuaUUwOTUHdW5pRTBBMAd1bmlFMEExB3VuaUUwQTIHdW5pRTBBMwd1bmlFMEE0B3VuaUUwQTkHdW5pRTBCMwd1bmlFMTAxB3VuaUUxQjkHdW5pRTFCQgd1bmlFMUU3B3VuaUUxRjIHdW5pRTFGNAd1bmlFMUY3B3VuaUUxRjkHdW5pRTFGQwd1bmlFMUZFB3VuaUUxRkYHdW5pRTIwMAd1bmlFMjQwB3VuaUUyNDEHdW5pRTI0Mgd1bmlFMjQzB3VuaUUyNDQHdW5pRTI0NQd1bmlFMjQ2B3VuaUUyNDcHdW5pRTI0OAd1bmlFMjQ5B3VuaUUyNjAHdW5pRTI2MQd1bmlFMjYyB3VuaUUyNjMHdW5pRTI2NAd1bmlFMjZhB3VuaUUyNmIHdW5pRTI4MAd1bmlFMjgxB3VuaUUyODIHdW5pRTI4Mwd1bmlFNEEwB3VuaUU0QTIHdW5pRTRBNAd1bmlFNEE4B3VuaUU0QUMHdW5pRTRDMAd1bmlFNENFB3VuaUU0RDEHdW5pRTRFMQd1bmlFNEUyB3VuaUU0RTMHdW5pRTRFNAd1bmlFNEU1B3VuaUU0RTYHdW5pRTRFNwd1bmlFNEU4B3VuaUU0RTkHdW5pRTRFQQd1bmlFNTAwB3VuaUU1MDEHdW5pRTUyMAd1bmlFNTIxB3VuaUU1MjIHdW5pRTUyMwd1bmlFNTI0B3VuaUU1MjUHdW5pRTUyOQd1bmlFNTJBB3VuaUU1MkIHdW5pRTUyQwd1bmlFNTJEB3VuaUU1MkYHdW5pRTUzMAd1bmlFNTMxB3VuaUU1MzkHdW5pRTU2Ngd1bmlFNTY3B3VuaUU1NjkHdW5pRTU2Qwd1bmlFNTZEB3VuaUU1ODIHdW5pRTVEMAd1bmlFNUUyB3VuaUU2MTAHdW5pRTYxMgd1bmlFNjE0B3VuaUU2MTgHdW5pRTYyNAd1bmlFNjMwB3VuaUU2NTAHdW5pRTY1NQd1bmlFOTEwB3VuaUU5MTEHdW5pRTkxMgd1bmlFOTE0B3VuaUU5MTUHdW5pRTkxOAd1bmlFOTIwB3VuaUU5MjUHdW5pRTk1RAd1bmlFQTAyB3VuaUVBQTQHdW5pRUNBMgd1bmlFQ0EzB3VuaUVDQTUHdW5pRUNBNwd1bmlFQ0E5B3VuaUVDQjcAAAAAAAAB//8AAgABAAAAAAAAAAwAFAAEAAAAAgAAAAEAAAABAAAAAAABAAAAAN2HW+gAAAAA0ZciFwAAAADeLXWv") format("truetype")',
size:24},musicspace:6,partsfont:{name:"text,serif",size:15},parskipfac:.4,partsspace:8,pagewidth:793.8,printmargin:0,rightmargin:1.4*37.8,rbmax:4,rbmin:2,repeatfont:{name:"text,serif",size:9},scale:1,slurheight:1,spatab:new Float32Array([10.2,13.3,17.3,22.48,29.2,38,49.4,64.2,83.5,108.5]),staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlefont:{name:"text,serif",size:16},subtitlespace:3,sysstaffsep:34,tempofont:{name:"text,serif",weight:"bold",size:12},textfont:{name:"text,serif",size:16},
textspace:14,tieheight:1,titlefont:{name:"text,serif",size:20},titlespace:6,titletrim:!0,topspace:22,tuplets:[0,0,0,0],tupletfont:{name:"text,serif",style:"italic",size:12},vocalfont:{name:"text,serif",weight:"bold",size:13},vocalspace:10,voicefont:{name:"text,serif",weight:"bold",size:13},writefields:"CMOPQsTWw",wordsfont:{name:"text,serif",size:16},wordsspace:5},Te={bardef:!0,barsperstaff:!0,beamslope:!0,breaklimit:!0,bstemdown:!0,cancelkey:!0,dynalign:!0,flatbeams:!0,gracespace:!0,hyphencont:!0,
keywarn:!0,maxshrink:!0,maxstaffsep:!0,measrepnb:!0,rbmax:!0,rbmin:!0,shiftunison:!0,slurheight:!0,squarebreve:!0,staffsep:!0,stemheight:!0,stretchlast:!0,stretchstaff:!0,tieheight:!0,timewarn:!0,vocalspace:!0},lf={align:"j",center:"c",fill:"f",justify:"j",obeylines:"l",ragged:"f",right:"r",skip:"s"},qd={above:n.SL_ABOVE,auto:0,below:n.SL_BELOW,down:n.SL_BELOW,hidden:n.SL_HIDDEN,opposite:n.SL_HIDDEN,under:n.SL_BELOW,up:n.SL_ABOVE};Abc.prototype.set_format=function(a,c){var d;if(/.+font(-[\d])?$/.test(a))"soundfont"==
a?p.soundfont=c:Kb(a,c);else{Te[a]&&t.ufmt&&(p=Object.create(p));switch(a){case "aligncomposer":case "barsperstaff":case "infoline":case "measurenb":case "rbmax":case "rbmin":case "measrepnb":case "shiftunison":var e=parseInt(c);if(isNaN(e)){w(1,"Bad integer value");break}p[a]=e;break;case "abc-version":case "bgcolor":case "fgcolor":case "titleformat":p[a]=c;break;case "beamslope":case "breaklimit":case "lineskipfac":case "maxshrink":case "pagescale":case "parskipfac":case "scale":case "slurheight":case "stemheight":case "tieheight":var f=
+c;if(isNaN(f)){w(1,I.bad_val,"%%"+a);break}switch(a){case "scale":f/=.75;case "pagescale":a="scale",Z.chg=!0}p[a]=f;break;case "annotationbox":case "gchordbox":case "measurebox":case "partsbox":Kb(a.replace("box","font"),"* * "+(Eb(c)?"box":"nobox"));break;case "altchord":case "bstemdown":case "breakoneoln":case "cancelkey":case "checkbars":case "contbarnb":case "custos":case "decoerr":case "flatbeams":case "graceslurs":case "graceword":case "hyphencont":case "keywarn":case "linewarn":case "quiet":case "singleline":case "squarebreve":case "splittune":case "straightflags":case "stretchstaff":case "timewarn":case "titlecaps":case "titleleft":p[a]=
Eb(c);break;case "dblrepbar":c=":: "+c;case "bardef":e=c.split(/\s+/);2!=e.length?w(1,I.bad_val,"%%bardef"):(t.ufmt&&(p.bardef=Object.create(p.bardef)),p.bardef[e[0]]=e[1]);break;case "chordalias":e=c.split(/\s+/);e.length?abc2svg.ch_alias[e[0]]=e[1]||"":w(1,I.bad_val,"%%chordalias");break;case "composerspace":case "indent":case "infospace":case "maxstaffsep":case "maxsysstaffsep":case "musicspace":case "partsspace":case "staffsep":case "subtitlespace":case "sysstaffsep":case "textspace":case "titlespace":case "topspace":case "vocalspace":case "wordsspace":f=
Qa(c);isNaN(f)?w(1,I.bad_val,"%%"+a):p[a]=f;break;case "page-format":q.page_format=Eb(c);break;case "print-leftmargin":w(0,"$1 is deprecated - use %%printmargin instead","%%"+a),a="printmargin";case "printmargin":case "leftmargin":case "pagewidth":case "rightmargin":f=Qa(c);if(isNaN(f)){w(1,I.bad_val,"%%"+a);break}p[a]=f;Z.chg=!0;break;case "concert-score":"play"!=p.sound&&(p.sound="concert");break;case "writefields":e=c.split(/\s+/);if(Eb(e[1]))for(d=0;d<e[0].length;d++)f=e[0][d],0>p.writefields.indexOf(f)&&
(p.writefields+=f);else for(d=0;d<e[0].length;d++)f=e[0][d],0<=p.writefields.indexOf(f)&&(p.writefields=p.writefields.replace(f,""));break;case "dynamic":case "gchord":case "gstemdir":case "ornament":case "stemdir":case "vocal":case "volume":Jd(a,c);break;case "font":f=Rb(c);1>=f.length||(d=+f[f.length-1],isNaN(d)||.5>=d?w(1,"Bad scale value in %%font"):Hd[f[0]]=d);break;case "fullsvg":if(0!=t.state){w(1,I.not_in_tune,"%%fullsvg");break}p[a]=c;break;case "gracespace":e=c.split(/\s+/);for(c=0;3>c;c++)if(isNaN(+e[c])){w(1,
I.bad_val,"%%gracespace");break}t.ufmt&&(p[a]=new Float32Array(3));for(c=0;3>c;c++)p[a][c]=+e[c];break;case "tuplets":e=c.split(/\s+/);(f=e[3])&&(f=qd[f]);f&&(e[3]=f);l?l.tup=e:p[a]=e;break;case "infoname":a:{f=c;d=p.infoname.split("\n");e=f[0];for(c=0;c<d.length;c++)if(d[c][0]==e){1==f.length?d.splice(c,1):d[c]=f;p.infoname=d.join("\n");break a}p.infoname+="\n"+f}break;case "notespacingfactor":if(e=c.match(/([.\d]+)[,\s]*(\d+)?/))f=+e[1],isNaN(f)||1>f||2<f?f=0:e[2]?(d=+e[2],isNaN(f)&&(f=0)):d=p.spatab[5];
if(!f){w(1,I.bad_val,"%%"+a);break}p[a]=c;p.spatab=new Float32Array(10);c=5;do p.spatab[c]=d,d/=f;while(0<=--c);c=5;for(d=p.spatab[c];++c<p.spatab.length;)d*=f,p.spatab[c]=d;break;case "play":p.sound="play";break;case "pos":a=c.match(/(\w*)\s+(.*)/);if(!a||!a[2]){w(1,"Error in %%pos");break}if("tup"==a[1].slice(0,3)&&l){l.tup=l.tup?Object.create(l.tup):p.tuplets;e=qd[a[2]];switch(e){case n.SL_ABOVE:l.tup[3]=1;break;case n.SL_BELOW:l.tup[3]=2;break;case n.SL_HIDDEN:l.tup[2]=1}break}Jd(a[1],a[2]);break;
case "sounding-score":"play"!=p.sound&&(p.sound="sounding");break;case "staffwidth":e=Qa(c);if(isNaN(e)){w(1,I.bad_val,"%%"+a);break}if(100>e){w(1,"%%staffwidth too small");break}e=p.pagewidth-e-p.leftmargin;if(2>e){w(1,"%%staffwidth too big");break}p.rightmargin=e;Z.chg=!0;break;case "textoption":p[a]=Id(c);break;case "dynalign":case "stretchlast":case "titletrim":e=+c;isNaN(e)&&(e=Eb(c)?0:1);if("s"==a[0]&&(0>e||1<e)){w(1,I.bad_val,"%%"+a);break}p[a]=e;break;case "combinevoices":w(1,"%%combinevoices is deprecated - use %%voicecombine instead");
break;case "voicemap":sc("map",c);break;case "voicescale":sc("scale",c);break;case "rbdbstop":(e=Eb(c))&&"2.2"<=p["abc-version"]?p["abc-version"]="1":!e&&"2.2">p["abc-version"]&&(p["abc-version"]="2.2");break;default:t.state||(p[a]=c)}Te[a]&&t.ufmt&&(t.ufmt=!1)}};Abc.prototype.style_font=Xc;var Ba={},nb={},Ac={},nf={"=D":"\u0110","=H":"\u0126","=T":"\u0166","=d":"\u0111","=h":"\u0127","=t":"\u0167","/O":"\u00d8","/o":"\u00f8","/L":"\u0141","/l":"\u0142",vL:"\u013d",vl:"\u013e",vd:"\u010f",".i":"\u0131",
AA:"\u00c5",aa:"\u00e5",AE:"\u00c6",ae:"\u00e6",DH:"\u00d0",dh:"\u00f0",OE:"\u0152",oe:"\u0153",ss:"\u00df",TH:"\u00de",th:"\u00fe"},mf={1:"\u266f",2:"\u266d",3:"\u266e",4:"&#x1d12a;",5:"&#x1d12b;"},mb=0;Abc.prototype.tosvg=Zc;var H,z,S,ya,ra,Jc,Ec,cd,Sd=new Float32Array([10,10,11,13,15]),Le=new Float32Array([4.7,5,6,7.2,7.5]),Qb=new Float32Array([3.5,3.7,5,6,7]);Abc.prototype.set_width=function(a){var c,d,e;if(!a.play)switch(a.type){case n.NOTE:case n.REST:a.wr=e=Le[a.head];0<a.xmx&&(a.wr+=a.xmx+
4);for(c=a.prev;c&&!Ka[c.type];c=c.prev);if(c)switch(c.type){case n.BAR:case n.CLEF:case n.KEY:case n.METER:e+=3;break;case n.STBRK:e+=8}for(d=0;d<=a.nhd;d++){var f=a.notes[d];var g=f.shhd;0>g&&e<-g+5&&(e=-g+5);if(g=f.acc)g=f.shac+("object"==typeof g?5.5:3.5),e<g&&(e=g);if(f.a_dd){g=e;var h=0;var m=f.a_dd.length;for(e=0;e<m;e++){var k=f.a_dd[e];"<"==k.ty&&(k=k.wl+k.wr+8,k>h&&(h=k))}e=g+h}}if(c)switch(c.type){case n.BAR:case n.CLEF:case n.KEY:case n.METER:e-=3}a.a_dd&&(e+=zc(a));a.beam_st&&a.beam_end&&
0<a.stem&&0<a.nflags&&a.wr<a.xmx+9&&(a.wr=a.xmx+9);if(a.dots){if(void 0==a.wl)switch(a.head){case n.SQUARE:case n.OVALBARS:a.xmx+=3;break;case n.OVAL:a.xmx+=1}a.wr<a.xmx+8&&(a.wr=a.xmx+8);2<=a.dots&&(a.wr+=3.5*(a.dots-1))}a.trem2&&a.beam_end&&20>e&&(e=20);f=e;if(c)switch(c.type){case n.NOTE:0<c.stem&&0>a.stem&&7>f&&(f=7);(27<a.y&&27<c.y||-3>a.y&&-3>c.y)&&6>f&&(f=6);c.tie&&14>f&&(f=14);break;case n.CLEF:if(c.second||c.clef_small)break;f+=8;break;case n.KEY:f+=4}a.a_gch&&(f=Wd(a,e,f));a.prev&&a.prev.type==
n.GRACE?(a.prev.wl+=e-4.5,a.wl=a.prev.wl):a.wl=f;return;case n.SPACE:g=a.width/2;a.wr=g;a.a_gch&&(g=Wd(a,g,g));a.a_dd&&(g+=zc(a));a.wl=g;return;case n.BAR:d=a.bar_type;switch(d){case "|":g=5;break;case "[":g=0;break;default:for(g=2+2.8*d.length,c=0;c<d.length;c++)switch(d[c]){case "[":case "]":g+=1;case ":":g+=2}}a.wl=g;a.wr=a.next&&a.next.type!=n.METER?7:5;(c=a.prev)&&c.type==n.GRACE&&(a.wl-=6);for(;c;c=c.prev)if(Ka[c.type]){c.type==n.STBRK&&(a.wl-=12);break}a.a_dd&&(a.wl+=zc(a));a.text&&4>a.text.length&&
a.next&&a.next.a_gch&&(fa("repeat"),a.wr+=sa(a.text)[0]+2,0<p.measurenb&a.bar_num&&a.bar_num%p.measurenb&&(a.wr+=4));return;case n.CLEF:if(a.invis){a.wl=a.wr=1;return}a.wl=a.clef_small?11:12;a.wr=a.clef_small?10:12;a.prev&&a.prev.type==n.STBRK&&(a.wl-=6,delete a.next.clef_small);a.next&&a.next.type==n.BAR&&(a.wr-=4);return;case n.KEY:if(a.invis){a.wl=a.wr=0;return}a.wl=3;h=4;if(a.k_a_acc){if(f=e=a.k_a_acc.length)d=a.k_a_acc[0].acc;for(c=1;c<e;c++)g=a.k_a_acc[c],g.pit>a.k_a_acc[c-1].pit+6||g.pit<a.k_a_acc[c-
1].pit-6?f--:g.acc!=d&&(h+=3),d=g.acc}else f=a.k_sf,e=a.k_old_sf&&(a.fmt.cancelkey||0==f)?a.k_old_sf:0,0<=f*e?(0>f&&(f=-f),0>e&&(e=-e),e>f&&(f=e)):(f-=e,0>f&&(f=-f),h+=3);a.wr=5.5*f+h;return;case n.METER:f=0;a.x_meter=[];for(c=0;c<a.a_meter.length;c++)switch(e=a.a_meter[c],e.top[0]){case "C":case "c":case "o":a.x_meter[c]=f+6;f+=12;break;case ".":case "|":a.x_meter[c]=a.x_meter[c-1];break;default:g=0;e=!e.bot||e.top.length>e.bot.length?e.top:e.bot;for(d=0;d<e.length;d++)switch(e[d]){case "(":f+=4;
case ")":case "1":g+=4;break;default:g+=12}a.x_meter[c]=f+g/2;f+=g}a.wl=0;a.wr=f+6;return;case n.MREST:a.wl=6;a.wr=66;return;case n.GRACE:if(a.invis)break;g=a.fmt.gracespace[0];d=a.fmt.gracespace[1];c=a.fmt.gracespace[2];f=a.extra;a.prev&&a.prev.type==n.BAR&&(g-=3);for(f.beam_st=!0;;f=f.next){Rd(f);Td(f.notes,6.5);h=0;for(e=f.nhd;0<=e;e--)f.notes[e].shac-2>h&&(h=f.notes[e].shac-2);g+=h;f.x=g;0>=f.nflags&&(f.beam_st=f.beam_end=!0);e=f.next;if(!e){f.beam_end=!0;break}0>=e.nflags&&(f.beam_end=!0);f.beam_end&&
(e.beam_st=!0,g+=d/4);0>=f.nflags&&(g+=d/4);f.y>e.y+8&&(g-=1.5);g+=d}(e=a.next)&&e.type==n.NOTE&&(f.y>=3*(e.notes[e.nhd].pit-18)?--c:f.beam_st&&f.y<3*(e.notes[e.nhd].pit-18)-4&&(c+=2));a.wl=g+c;a.wr=0;a.a_ly&&Oc(a);return;case n.STBRK:a.wl=a.xmx;a.wr=8;return;case n.CUSTOS:a.wl=a.wr=4;return;case n.TEMPO:ee(a);break;case n.BLOCK:case n.REMARK:case n.STAVES:break;default:x(2,a,"set_width - Cannot set width for symbol $1",a.type)}a.wl=a.wr=0};var rd={t:-4,c:0,b:4,p:-6},Ue=[[18,18],[12,18],[12,12],[0,
12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,10]];Abc.prototype.set_pitch=function(a){var c,d,e=n.BLEN,f=S+1,g=new Int16Array(Array(2*f));for(c=0;c<=S;c++){var h=z[c].clef;g[c]=rd[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);p.sound?h.clef_octave&&!h.clef_oct_transp&&(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave)}for(h=P;h!=a;h=h.ts_next)switch(c=h.st,h.type){case n.CLEF:g[c]=rd[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);p.sound?h.clef_octave&&!h.clef_oct_transp&&
(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave);dd(h);break;case n.GRACE:for(c=h.extra;c;c=c.next){if((d=g[c.st])&&!h.p_v.ckey.k_drum)for(f=0;f<=c.nhd;f++){var m=c.notes[f];m.opit=m.pit;m.pit+=d}c.ymn=3*(c.notes[0].pit-18)-2;c.ymx=3*(c.notes[c.nhd].pit-18)+2}dd(h);break;case n.KEY:h.k_y_clef=g[c];default:dd(h);break;case n.MREST:if(h.invis)break;h.y=12;h.ymx=39;h.ymn=-2;break;case n.REST:if(1==F.length){h.y=12;h.ymx=24;h.ymn=0;break}case n.NOTE:if((d=g[c])&&!h.p_v.ckey.k_drum)for(f=
h.nhd;0<=f;f--)m=h.notes[f],m.opit=m.pit,m.pit+=d;h.type==n.REST&&(h.y=6*((h.notes[0].pit-18)/2|0),h.ymx=h.y+Ue[5-h.nflags][0],h.ymn=h.y-Ue[5-h.nflags][1]);h.dur<e&&(e=h.dur)}a||(cd=e)};Abc.prototype.set_stem_dir=function(){for(var a,c,d,e,f,g,h,m=[],k=P,l=J,p=l.nstaff;k;){for(a=0;a<=p;a++)m[a]=[];h=[];for(c=k;c&&c.type!=n.BAR;c=c.ts_next)if(c.type==n.STAVES){if(c!=k)break;l=k.sy;for(a=p;a<=l.nstaff;a++)m[a]=[];p=l.nstaff}else if(!(c.type!=n.NOTE&&c.type!=n.REST||c.invis)){a=c.st;if(a>p)throw c="*** fatal set_stem_dir(): bad staff number "+
a+" max "+p,x(2,null,c),Error(c);d=c.v;e=h[d];e||(e={st1:-1,st2:-1},h[d]=e);0>e.st1?e.st1=a:e.st1!=a&&(a>e.st1?a>e.st2&&(e.st2=a):(e.st1>e.st2&&(e.st2=e.st1),e.st1=a));f=m[a];e=l.voices[d].range;for(d=f.length;0<=--d&&(g=f[d],g.v!=e););if(0>d){g={v:e,ymx:0,ymn:24};for(d=0;d<f.length;d++)if(e<f[d].v){f.splice(d,0,g);break}d==f.length&&f.push(g)}c.type==n.NOTE&&(c.ymx>g.ymx&&(g.ymx=c.ymx),c.ymn<g.ymn&&(g.ymn=c.ymn),c.xstem&&(c.ts_prev.st!=a-1||c.ts_prev.type!=n.NOTE?(x(1,k,"Bad !xstem!"),c.xstem=!1):
(c.ts_prev.multi=1,c.multi=1,c.stemless=!0)))}for(;k!=c;k=k.ts_next)if(!k.multi){switch(k.type){default:continue;case n.REST:if(void 0!=k.combine&&0>k.combine||!k.ts_next||k.ts_next.type!=n.REST||k.ts_next.st!=k.st||k.time!=k.ts_next.time||k.dur!=k.ts_next.dur||k.a_dd&&k.ts_next.a_dd||k.a_gch&&k.ts_next.a_gch||k.invis)break;k.ts_next.a_dd&&(k.a_dd=k.ts_next.a_dd);k.ts_next.a_gch&&(k.a_gch=k.ts_next.a_gch);jb(k.ts_next);case n.NOTE:case n.GRACE:}a=k.st;d=k.v;e=h[d];f=m[a];if(e&&0<=e.st2)a==e.st1?k.multi=
-1:a==e.st2&&(k.multi=1);else if(1>=f.length)k.floating&&(k.multi=a==F[d].st?-1:1);else{e=l.voices[d].range;for(d=f.length;0<=--d&&f[d].v!=e;);0>d||(d==f.length-1?k.multi=-1:(k.multi=1,d&&d+2==f.length&&(f[d].ymn-k.fmt.stemheight>=f[d+1].ymx&&(k.multi=-1),a=k.ts_next,k.ts_prev&&k.ts_prev.time==k.time&&k.ts_prev.st==k.st&&k.notes[k.nhd].pit==k.ts_prev.notes[0].pit&&k.beam_st&&k.beam_end&&(!a||a.st!=k.st||a.time!=k.time)&&(k.multi=-1))))}}for(;k&&k.type==n.BAR;)k=k.ts_next}};Abc.prototype.set_stems=
function(){var a,c,d,e;for(a=P;a;a=a.ts_next)if(a.type!=n.NOTE){if(a.type==n.GRACE){var f=e=a.mid;for(c=a.extra;c;c=c.next){var g=15;1<c.nflags&&(g+=1.2*(c.nflags-1));var h=3*(c.notes[0].pit-18);var m=3*(c.notes[c.nhd].pit-18);0<=a.stem?(c.y=h,c.ys=m+g,m=Math.round(c.ys)):(c.y=m,c.ys=h-g,h=Math.round(c.ys));m+=4;h-=4;h<f?f=h:m>e&&(e=m);c.ymx=m;c.ymn=h}a.ymx=e;a.ymn=f}}else{Rd(a);c=a.nflags;if(a.beam_st&&!a.beam_end){a.feathered_beam&&(c=++a.nflags);for(g=a.next;g.type!=n.NOTE||(a.feathered_beam&&
g.nflags++,!g.beam_end);g=g.next);g.nflags>c&&(c=g.nflags)}else if(!a.beam_st&&a.beam_end){for(g=a.prev;!g.beam_st;g=g.prev);g.nflags>c&&(c=g.nflags)}g=a.fmt.stemheight;switch(c){case 2:g+=0;break;case 3:g+=4;break;case 4:g+=8;break;case 5:g+=12}1!=(d=a.p_v.scale)&&(g*=.5*(d+1));h=3*(a.notes[0].pit-18);0<a.nhd?(g-=2,m=3*(a.notes[a.nhd].pit-18)):m=h;a.ntrem&&(g+=2*a.ntrem);a.stemless?(0<=a.stem?(a.y=h,a.ys=m):(a.ys=h,a.y=m),a.ymx=m+4,a.ymn=h-4):0<=a.stem?(26<a.notes[a.nhd].pit&&(0>=c||!a.beam_st||
!a.beam_end)&&(g-=2,28<a.notes[a.nhd].pit&&(g-=2)),a.y=h,a.notes[0].tie&&(h-=3),a.ymn=h-4,a.ys=m+g,a.ys<a.mid&&(a.ys=a.mid),a.ymx=a.ys+2.5|0):(18>a.notes[0].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(g-=2,16>a.notes[0].pit&&(g-=2)),a.ys=h-g,a.ys>a.mid&&(a.ys=a.mid),a.ymn=a.ys-2.5|0,a.y=m,a.notes[a.nhd].tie&&(m+=3),a.ymx=m+4)}};var Qc=[];Abc.prototype.block_gen=function(a){switch(a.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":V.set_format(a.subtype,
a.param);break;case "mc_start":R={posy:T,maxy:T,lmarg:p.leftmargin,rmarg:p.rightmargin};break;case "mc_new":if(!R){x(1,a,"%%multicol new without start");break}T>R.maxy&&(R.maxy=T);p.leftmargin=R.lmarg;p.rightmargin=R.rmarg;Z.chg=!0;Ra();T=R.posy;break;case "mc_end":if(!R){x(1,a,"%%multicol new without start");break}T<R.maxy&&(T=R.maxy);p.leftmargin=R.lmarg;p.rightmargin=R.rmarg;R=void 0;ab();Z.chg=!0;Ra();break;case "ml":ab();q.img_out(a.text);break;case "newpage":if(!q.page_format)break;ab();0>Ma&&
q.img_out("</div>");Ma=2;break;case "sep":Ra();ia(a.sk1);G+='<path class="stroke"\n\td="M';Pa((Z.width-a.l)/2-Z.lm," ",0);G+="h"+a.l.toFixed(1)+'"/>\n';ia(a.sk2);break;case "text":fa(a.font);Gb(a.font);jd(a.text,a.opt);break;case "title":hd(a.text,!0);break;case "vskip":ia(a.sk)}};Abc.prototype.set_sym_glue=function(a){var c,d,e,f=0,g=0,h=0,m=0;for(c=P;c;c=c.ts_next)c.type!=n.GRACE||e||(e=c),c.seqst&&(f+=c.shrink,c.space?c.space<c.shrink?(m+=c.shrink,g+=c.shrink):g+=c.space:h+=c.shrink);if(g){var k=
!ya||ya.type==n.BLOCK&&!ya.play||Qc.length;c=P;if(f>=a){f>a&&x(1,c,"Line too much shrunk $1 $2 $3",f.toFixed(1),g.toFixed(1),a.toFixed(1));for(d=0;c;c=c.ts_next)c.seqst&&(d+=c.shrink),c.x=d;Ec=0}else if(k&&g+h>a*(1-c.fmt.stretchlast)||!k&&(g+h>a||c.fmt.stretchstaff)){g==m&&(g+=5);for(k=4;0<=--k;){var l=(a-h-m)/(g-m);d=m=g=0;for(c=P;c;c=c.ts_next)c.seqst&&(c.space?c.space*l<=c.shrink?(m+=c.shrink,g+=c.shrink,d+=c.shrink):(g+=c.space,d+=c.space*l):d+=c.shrink),c.x=d;if(.1>Math.abs(d-a))break}Ec=l}else for(l=
1-c.fmt.maxshrink,Ec&&g*Ec+h<a&&(l=Ec),d=0;c;c=c.ts_next)c.seqst&&(d+=c.space<=c.shrink?c.shrink:c.shrink*(1-l)+c.space*l),c.x=d;ra=d;for(c=e;c;c=c.ts_next)if(c.type==n.GRACE)for(d=c.gr_shift?c.prev.x+c.prev.wr:c.x-c.wl,a=c.extra;a;a=a.next)a.x+=d}else ra=0};Abc.prototype.output_music=function(){var a,c=F.length,d,e=F.length,f=J,g=f.nstaff;for(Jc=0<=p.writefields.indexOf("M");;){f=f.next;if(!f)break;f.nstaff>g&&(g=f.nstaff)}S=g;for(var h,m=P;m.ts_next;)m=m.ts_next;m.type!=n.BAR&&(h=Rc(m),h.ts_prev=
m,m.next=m.ts_next=h);for(d=0;d<e;d++){var k=F[d];zf(k);k.ckey=k.key;for(var l=void 0,t=void 0,q=k.sym;q;)if(q.type!=n.BAR||!q.rbstart||q.norepbra)q=q.next;else for(l=0,t=null,q=q.next;q;q=q.next)if(q.type==n.BAR){if(q.rbstop)break;if(!q.next){q.rbstop=2;break}l++;l==q.fmt.rbmin&&(t=q);if(l==q.fmt.rbmax){t&&(q=t);q.rbstop=1;break}}}if(1<e){var w,u,v;for(w=0;w<F.length;w++){var D=F[w];var E=!1;var K=D.st;for(u=D.sym;u;u=u.next){if(!u.floating){for(;u&&!u.floating;)u=u.next;if(!u)break;E=!1}if(u.dur)if(19<=
u.notes[0].pit)E=!1;else if(12>=u.notes[u.nhd].pit)E=!0,u.st++;else{var I=127;for(v=u.ts_prev;v&&v.st==K&&v.v!=u.v;v=v.ts_prev)v.type==n.NOTE&&v.notes[0].pit<I&&(I=v.notes[0].pit);if(127==I)E&&u.st++;else if(u.notes[u.nhd].pit>I-3)E=!1;else{var L=-127;for(v=u.ts_next;v&&v.st==K+1&&v.v!=u.v;v=v.ts_next)v.type==n.NOTE&&v.notes[v.nhd].pit>L&&(L=v.notes[v.nhd].pit);if(-127==L)E&&u.st++;else{if(u.notes[0].pit<L+3)E=!0;else if(I-=u.notes[u.nhd].pit,L=u.notes[0].pit-L,!E){if(I<L+3)continue;E=!0}else if(I<
L-3){E=!1;continue}u.st++}}}else E&&u.st++}}if(ha.mrest_p){var N;for(N=P;N;N=N.ts_next)if(N.type==n.MREST){if(!N.seqst&&Ka[N.ts_prev.type])var U=N;else for(U=N.ts_next;!U.seqst&&U.type==n.MREST&&U.nmes==N.nmes;)U=U.ts_next;if(U.seqst)N=U.ts_prev;else for(;N.type==n.MREST;){for(var aa,Y,Q,ba,da,T=N,ka=T.nmes,la=T.dur/ka,na=T.next;!na.bar_type;)na=na.next;for(da=na;!na.bar_num;)na=na.ts_prev;aa=na.bar_num-T.nmes;T.type=n.REST;T.notes[0].dur=T.dur=T.dur_orig=la;T.nflags=-2;T.head=n.FULL;T.fmr=1;Y=T.time+
la;for(ba=T;0<--ka;){na=B(da);delete na.soln;delete na.a_gch;delete na.a_dd;delete na.text;delete na.rbstart;delete na.rbstop;Ic(na,da);for(na.time=Y;ba.time<Y;)ba=ba.ts_next;for(;ba&&ba.v<T.v&&ba.type==n.BAR;)ba=ba.ts_next;if(ba)Pb(na,ba),ba.type==n.BAR&&delete ba.bar_num;else{for(ba=T;ba.ts_next;)ba=ba.ts_next;ba.ts_next=na;na.ts_prev=ba;na.ts_next=null}aa++;na.seqst?(na.bar_num=aa,Q=na.ts_next):(delete na.bar_num,Q=na.ts_prev);na.bar_type=Q.bar_type||"|";Q.bar_num&&!Q.seqst&&delete Q.bar_num;Q=
B(T);delete Q.a_dd;delete Q.soln;delete Q.a_gch;delete Q.part;na.next?(Q.next=na.next,Q.next.prev=Q):Q.next=null;na.next=Q;Q.prev=na;for(Q.time=Y;ba&&!ba.dur&&ba.time==Y;)ba=ba.ts_next;for(;ba&&ba.v<T.v&&(!(ba=ba.ts_next)||!ba.seqst););if(ba)Pb(Q,ba);else{for(ba=T;ba.ts_next;)ba=ba.ts_next;ba.ts_next=Q;Q.ts_prev=ba;Q.ts_next=null}Y+=la;T=ba=Q}N=N.ts_next}}}}ha.ottava&&"play"!=p.sound&&xf();var ca,X,R,ta,ea=Array(S+1),xa=J,sa=[];z=Array(S+1);for(X=0;X<=S;X++)ea[X]={autoclef:!0},z[X]={output:"",sc_out:""};
for(X=0;X<=xa.nstaff;X++)sa[X]=3*(xa.staves[X].stafflines.length-1);for(ca=P;ca;ca=ca.ts_next){ca.repeat_n&&wf(ca);switch(ca.type){case n.STAVES:xa=ca.sy;for(X=0;X<=S;X++)ea[X].autoclef=!0;for(R=0;R<F.length;R++)if(xa.voices[R]){var ma=F[R];X=xa.voices[R].st;xa.voices[R].second||(xa.staves[X].staffnonote=ma.staffnonote,ma.staffscale&&(xa.staves[X].staffscale=ma.staffscale),xa.voices[R].sep&&(xa.staves[X].sep=xa.voices[R].sep),xa.voices[R].maxsep&&(xa.staves[X].maxsep=xa.voices[R].maxsep));var pa=
ma.clef;pa.clef_auto||(ea[X].autoclef=!1)}for(X=0;X<=xa.nstaff;X++)sa[X]=3*(xa.staves[X].stafflines.length-1);for(R=0;R<F.length;R++)if(xa.voices[R]&&!xa.voices[R].second){ma=F[R];X=xa.voices[R].st;pa=ma.clef;if(pa.clef_auto){var wa=ae(X,ca,ea[X].clef?ea[X].clef.clef_type:"a");var La="t"==wa?2:4}else wa=pa.clef_type,La=pa.clef_line;if(!ea[X].clef)pa.clef_auto&&("a"!=pa.clef_type&&(ma.clef=B(ma.clef)),ma.clef.clef_type=wa,ma.clef.clef_line=La),z[X].clef=ea[X].clef=ma.clef;else if(wa!=ea[X].clef.clef_type||
La!=ea[X].clef.clef_line){for(ta=ca.ts_prev;ta&&ta.time==ca.time&&(ta.v!=R||ta.st!=X);)ta=ta.ts_prev;if(!ta||ta.time!=ca.time){for(ta=ca.ts_next;ta&&(ta.v!=R||ta.st!=X);)ta=ta.ts_next;ta&&ta.time==ca.time||(ta=ca)}ta.type!=n.CLEF&&(ta=Ud(ta,wa,La),pa.clef_auto&&(ta.clef_auto=!0));ea[X].clef=ma.clef=ta}}continue;default:ca.mid=sa[ca.st];continue;case n.CLEF:}"a"==ca.clef_type&&(ca.clef_type=ae(ca.st,ca.ts_next,ea[ca.st].clef.clef_type),ca.clef_line="t"==ca.clef_type?2:4);ma=ca.p_v;ma.clef=ca;if(ca.second)jb(ca);
else{X=ca.st;if(ea[X].clef){if(ca.clef_type==ea[X].clef.clef_type&&ca.clef_line==ea[X].clef.clef_line)continue}else z[X].clef=ca;ea[X].clef=ca}}xa=J;for(R=0;R<F.length;R++)if(xa.voices[R]&&(pa=F[R].sym)&&127==pa.notes[0].pit){X=xa.voices[R].st;switch(z[X].clef.clef_type){default:var Ha=22;break;case "c":Ha=16;break;case "b":Ha=10}for(ca=pa;ca;ca=ca.next)ca.notes[0].pit=Ha}V.set_pitch(null);1<c&&V.set_stem_dir();for(a=0;a<c;a++){var Ba,Ca=void 0,Ia=void 0,W,Ea=-1;for(W=F[a].sym;W;W=W.next)if(W.type!=
n.NOTE){if(W.type==n.GRACE){var qa=W.extra;if(2==qa.stem)Ca=W;else for(W.stem||(W.stem=W.multi||1);qa;qa=qa.next)qa.stem=W.stem,qa.multi=W.multi}}else{!W.stem&&W.multi&&(W.stem=W.multi);if(W.stem)W.beam_st&&!W.beam_end&&(Ia=!0);else{var za=W.mid/3+18;if(Ia)W.stem=Ea;else if(W.beam_st&&!W.beam_end){Ia=!0;var Ma=W.notes[W.nhd].pit;var Pa=W.notes[0].pit;for(qa=W.next;qa;qa=qa.next)if(qa.type==n.NOTE){if(qa.stem||qa.multi)W.stem=qa.stem||qa.multi;qa.notes[qa.nhd].pit>Ma&&(Ma=qa.notes[qa.nhd].pit);qa.notes[0].pit<
Pa&&(Pa=qa.notes[0].pit);if(qa.beam_end)break}!W.stem&&qa.beam_end&&(Ma+Pa<2*za?W.stem=1:Ma+Pa>2*za?W.stem=-1:W.fmt.bstemdown&&(W.stem=-1));W.stem||(W.stem=Ea)}else{var Qa=(W.notes[W.nhd].pit+W.notes[0].pit)/2;if(Qa==za&&1<W.nhd){for(Ba=0;Ba<W.nhd&&!(W.notes[Ba].pit>=za);Ba++);Qa=2*Ba<W.nhd?za-1:za+1}W.stem=Qa<za?1:Qa>za||W.fmt.bstemdown?-1:Ea}}W.beam_end&&(Ia=!1);Ea=W.stem;if(Ca){for(qa=Ca.extra;qa;qa=qa.next)qa.stem=-Ea;Ca.stem=-Ea;Ca=null}}}V.set_stems();be();if(P){var Sa,ub,Ya,Za;for(Sa=P;Sa;)if(Sa.type!=
n.NOTE||Sa.invis)Sa=Sa.ts_next;else{var Eb=Sa.st;var Fb=Sa.time;var db=!1;for(ub=Sa;ub&&ub.time==Fb&&ub.type==n.NOTE&&ub.st==Eb;ub=ub.ts_next)if(!db)for(Ya=0;Ya<=ub.nhd;Ya++)if(ub.notes[Ya].acc){db=!0;break}if(db){var Gb=Sd[Sa.head];for(Za=[];Sa!=ub;Sa=Sa.ts_next)Array.prototype.push.apply(Za,Sa.notes);Za.sort(abc2svg.pitcmp);Td(Za,Gb)}else Sa=ub}if(1<c){var O,Wa,Oa,eb=[],bb=J;for(O=P;O;O=O.ts_next)if(!O.invis&&(O.type==n.STAVES&&(bb=O.sy),O.dur)){var vb=eb[O.v];vb||(vb={},eb[O.v]=vb);vb.s=O;vb.st=
O.st;vb.end_time=O.time+O.dur;if(O.type==n.REST){var wb=-127;var xb=127;var pb=Oa=!1;for(Wa=0;Wa<=eb.length;Wa++)if((vb=eb[Wa])&&vb.s&&vb.st==O.st&&Wa!=O.v&&!(vb.end_time<=O.time)){pb=!0;var ja=vb.s;bb.voices[Wa].range<bb.voices[O.v].range?ja.time==O.time?ja.ymn<xb&&(xb=ja.ymn,ja.dots&&(Oa=!0)):ja.y<xb&&(xb=ja.y):ja.time==O.time?ja.ymx>wb&&(wb=ja.ymx,ja.dots&&(Oa=!0)):ja.y>wb&&(wb=ja.y)}var Yb=O.time+O.dur;for(ja=O.ts_next;ja&&!(ja.time>=Yb);ja=ja.ts_next)ja.st==O.st&&ja.dur&&!ja.invis&&(pb=!0,bb.voices[ja.v].range<
bb.voices[O.v].range?ja.time==O.time?ja.ymn<xb&&(xb=ja.ymn,ja.dots&&(Oa=!0)):ja.y<xb&&(xb=ja.y):ja.time==O.time?ja.ymx>wb&&(wb=ja.ymx,ja.dots&&(Oa=!0)):ja.y>wb&&(wb=ja.y));if(pb){if(127==xb&&12>O.y){var ua=12-O.y;O.y+=ua;O.ymx+=ua;O.ymn+=ua}-127==wb&&12<O.y&&(ua=O.y-12,O.y-=ua,O.ymx-=ua,O.ymn-=ua);ua=xb-O.ymx;if(0>ua)if(ua=6*Math.ceil(-ua/6),O.ymn-ua>=wb)O.y-=ua,O.ymx-=ua,O.ymn-=ua;else{var cb=Oa?15:10;O.notes[0].shhd=cb;O.xmx=cb}else ua=wb-O.ymn,0<ua&&(ua=6*Math.ceil(ua/6),O.ymx+ua<=xb?(O.y+=ua,
O.ymx+=ua,O.ymn+=ua):(cb=Oa?15:10,O.notes[0].shhd=cb,O.xmx=cb))}else O.y=12,O.ymx=24,O.ymn=0}}Df()}for(var Cb,Ta,kb,hc,Db,Na=P,oa=Na,lb=0,mb=[],vc=[],nb=lb,Ib=Na.time;;){Db=0;do!Na.a_gch&&!Na.a_ly||kb||(kb=Na),V.set_width(Na),Ta=Na.st,void 0==mb[Ta]&&(mb[Ta]=0),void 0==vc[Ta]&&(vc[Ta]=0),Cb=mb[Ta]+vc[Ta]+Na.wl,Cb>nb&&(nb=Cb),Na.dur&&Na.dur!=Na.notes[0].dur&&(Db=1),Na=Na.ts_next;while(Na&&!Na.seqst);oa.shrink=nb-lb;oa.space=oa.ts_prev?vf(oa,Ib):0;0==oa.space&&oa.ts_prev&&oa.ts_prev.type==n.SPACE&&
oa.ts_prev.seqst&&(oa.space=oa.ts_prev.space/=2);Db?hc||(hc=oa):hc&&hc.v==oa.v&&(Yd(hc,oa),hc=null);oa.shrink||(oa.space||oa.type!=n.CLEF?oa.dur&&(oa.shrink=10):(delete oa.seqst,oa.time=Ib));Ib=oa.time;if(!Na)break;for(Ta=0;Ta<vc.length;Ta++)vc[Ta]=0;lb=nb;do Ta=oa.st,mb[Ta]=lb,oa.wr>vc[Ta]&&(vc[Ta]=oa.wr),oa=oa.ts_next;while(!oa.seqst)}hc&&Yd(hc,oa);if(kb){var Ua=kb,ob,Sb,sb=0,tb=0;for(fa("vocal");Ua;Ua=Ua.ts_next)if(Ua.shrink&&(sb+=Ua.shrink,tb++),Ua.a_ly&&Oc(Ua),Ua.a_gch)for(ob=0;ob<Ua.a_gch.length;ob++){var fb=
Ua.a_gch[ob];if(!("g"!=fb.type||0>fb.y)){if(Jb&&Jb>sb+fb.x)for(Ua.prev&&Ua.prev.seqst&&Ua.prev.type==n.BAR&&tb--,Sb=(Jb-sb-fb.x)/tb;;){var wc=wc.ts_next;wc.shrink&&(wc.shrink+=Sb);if(wc==Ua||wc.type==n.BAR)break}wc=Ua;var Jb=fb.text.wh[0];sb=tb=0;break}}}var xc=Af();if(p.singleline){a=Zd();var Bb=xc[0]+a[0]+a[1]+$d(P,null)[0];Z.width=Bb*p.scale+Z.lm+Z.rm+2}else{var ib=Bb=bc(),Da,Kb,mc=p.leftmargin,oc=p.rightmargin,rc=p.pagewidth,sc=p.scale,Hb=xc[0]-xc[1],Rb=Zd(),Aa=P;ib-=xc[1];p.indent&&p.indent>
xc[0]&&(Hb+=p.indent);ib-=Rb[0];Hb+=Rb[1];p.custos&&1==F.length&&(ib-=12);if(Kb=Aa.fmt.barsperstaff)for(Da=Aa;Da;Da=Da.ts_next)if(Da.type==n.BAR&&Da.bar_num&&!(0<--Kb)){for(;Da.ts_next&&Da.ts_next.type==n.BAR;)Da=Da.ts_next;Da.ts_next&&(Da.ts_next.soln=!0);Kb=Aa.fmt.barsperstaff}for(Da=Aa;Aa;Aa=Aa.ts_next){if(Aa.type==n.BLOCK)switch(Aa.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":V.set_format(Aa.subtype,Aa.param)}if(Aa.ts_next)if(Aa.soln){Aa.soln=
!1;if(Aa.time==Da.time)continue;for(;!Aa.seqst;)Aa=Aa.ts_prev}else continue;else Aa=null;a:{var Fc=void 0,qb=void 0,rb=void 0,Wb=void 0,Kc=void 0,yb=void 0,Lc=void 0,Zb=void 0,$a=void 0,$b=void 0,pc=void 0,M=Da,va=Aa,ac=ib,Nb=Hb,cc=va?va.ts_prev:null,Gc=$d(M,va);M.fmt.keywarn&&va&&va.type==n.KEY&&!cc.dur&&(Gc[0]+=va.wr,Gc[1]+=va.wr);if(Gc[0]+Nb<ac)va&&(va=Pc(va)),Da=va||cc;else{for(qb=Gc[0]+Nb;;){Fc=Math.ceil(qb/ac);if(1>=Fc){va&&(va=Pc(va));Da=va||cc;break a}$b=pc=M;Kc=M.x-M.shrink-Nb;rb=Kc+ac;Wb=
Kc+qb/Fc;Kc+=qb/Fc*M.fmt.breaklimit;for(M=M.ts_next;M!=va&&!(M.x&&(M.type==n.BAR&&($b=M),M.x>=Kc));M=M.ts_next);Zb=M;if(M==va){M&&(M=Pc(M));break}for($a=null;M!=va;M=M.ts_next)if(yb=M.x){if(yb>rb)break;if(M.type==n.BAR)if(yb<Wb)$a=M;else{if(!$a||yb-Wb<Wb-$a.x)$a=M;break}}if(!$a){M=Zb;var Ob=0,Ac=$b.time;rb-=8;for(Lc=null;M!=va;M=M.ts_next)if(M.dur&&(Ob=M.beam_end?Ob&~(1<<M.v):Ob|1<<M.v),M.seqst){yb=M.x;if(yb+M.wr>=rb)break;Ob||M.in_tuplet||(Lc&&(Wb-Lc.x>yb-Wb||M.dur&&0==(M.time+M.dur-Ac)%(n.BLEN/
4))&&($a=Lc),Lc=M)}}if(!$a)for($a=M=Zb;M!=va;M=M.ts_next)if(yb=M.x){if(yb+M.wr>=rb)break;if($a&&yb>=Wb){Wb-$a.x>yb-Wb&&($a=M);break}$a=M}for(M=$a;M.ts_next&&(M=M.ts_next,!M.seqst););if(M.nl)for(x(0,M,"Line split problem - adjust maxshrink and/or breaklimit"),Fc=2,M=M.ts_next;M!=va&&!(M.x&&0>=--Fc);M=M.ts_next);M=Pc(M);if(!M||va&&M.time>=va.time)break;qb-=M.x-pc.x;Nb=0}Da=M}}if(!Da)break;Aa=Da;Hb=0;Ra();ib=bc()-xc[1]-Rb[0]}p.leftmargin=mc;p.rightmargin=oc;p.pagewidth=rc;p.scale=sc;Z.chg=1;Ra()}var Bc=
P;for(a=c;0<=--a;)F[a].osym=F[a].sym;for(Ec=0;;){Ff();var Mc,tc=xc,Qb=0,Cc=F.length;for(Mc=0;Mc<Cc;Mc++){var dc=F[Mc];if(J.voices[Mc]&&H.st_print[dc.st]){if(dc.new_name){Qb=2;break}dc.snm&&(Qb=1)}}H.vnt=Qb;var ic=2==Qb?tc[0]:tc[1];!uc&&p.indent&&ic<p.indent&&(ic=p.indent);V.set_sym_glue(Bb-ic);if(ra){ic&&(nc+=ic);df();var uc=hf();jf(ic);var Tb,Dc=F.length;for(Tb=0;Tb<Dc;Tb++){var Vb=F[Tb];if(Vb.sym&&void 0!=Vb.sym.x){V.draw_symbols(Vb);var gb=void 0,Va=void 0,hb=void 0,fc=void 0,Nc=void 0,Ga=void 0,
zb=void 0,kc=0;Ga=Vb.sym;for(Xa(Ga.color);Ga;Ga=Ga.next){if(Ga.ti2&&Ga.time!=kc)for(hb=0;hb<=Ga.nhd;hb++)gb=Ga.notes[hb],(Va=gb.tie_s)&&Va.s.v==Ga.v&&qc(Va,gb,1);if(Ga.ti1)if(Ga.type==n.GRACE)for(zb=Ga.extra;zb;zb=zb.next)for(hb=0;hb<=Ga.nhd;hb++){if(Va=zb.notes[hb],gb=Va.tie_e)qc(Va,gb),kc=gb.s.time}else for(hb=0;hb<=Ga.nhd;hb++)if(Va=Ga.notes[hb],gb=Va.tie_e)if(Nc=gb.s,ya&&Nc.time>=ya.time)qc(Va,gb,2);else{kc=Nc.time;for(zb=Ga.ts_next;zb!=Nc;zb=zb.ts_next)if(zb.st==Ga.st&&zb.type==n.CLEF){fc=!0;
break}fc||Ga.st!=Nc.st?(qc(Va,gb,2),qc(Va,gb,3),fc=!1):qc(Va,gb)}else Va.tie_ty&&qc(Va,Va,2)}Xa()}}V.draw_all_deco();ec();for(var jc=void 0;;){jc=gc.shift();if(!jc)break;switch(jc.type){case n.CLEF:case n.METER:case n.KEY:case n.REST:if(jc.type!=n.REST||jc.rep_nb){Fa(jc.st);break}case n.GRACE:case n.NOTE:case n.MREST:Ub(jc)}Mb(jc)}Fa(-1);var Ab;for(Ab=0;Ab<=S;Ab++)z[Ab].sc_out&&(G+="<g "+z[Ab].scale_str+">\n"+z[Ab].sc_out+"</g>\n",z[Ab].sc_out=""),z[Ab].output&&(G+='<g transform="translate(0,'+(-z[Ab].y).toFixed(1)+
')">\n'+z[Ab].output+"</g>\n",z[Ab].output="");G&&ia(uc);for(ic&&(nc-=ic);Qc.length;)V.block_gen(Qc.shift())}ab();lc&&(lc.ts_next.ts_prev=lc);if(!ya)break;ya.ts_prev.ts_next=P=ya;be();if(!P)break;var lc=P.ts_prev;P.ts_prev=null;for(var yc,Xb,zc=F.length;0<=--zc;)Xb=F[zc],Xb.sym&&Xb.s_prev&&(Xb.sym.prev=Xb.s_prev),yc=Xb.s_next,(Xb.sym=yc)?(yc.prev&&(yc.prev.next=yc),Xb.s_prev=yc.prev,yc.prev=null):Xb.s_prev=null;Bb=bc()}P=Bc;for(a=c;0<=--a;){var Hc=F[a];Hc.sym&&Hc.s_prev&&(Hc.sym.prev=Hc.s_prev);Hc.sym=
Hc.osym}}};var Ia,la=[],R,eb={},Jf=new Int8Array([0,1,3,2,3,0,2,0,3,0]),Sb="CDEFGABcdefgab";Abc.prototype.set_vp=function(a){for(var c,d,e,f,g,h;;){d=a.shift();if(!d)break;if("="==d.slice(-1)&&!a.length){w(1,I.bad_val,d);break}switch(d){case "clef=":c=a.shift();break;case "clefpitch=":if(d=a.shift())if(f=Sb.indexOf(d[0]),0<=f){switch(d[1]){case "'":f+=7;break;case ",":f-=7,","==d[2]&&(f-=7)}g=4-f;break}w(1,I.bad_val,d);break;case "octave=":f=+a.shift();isNaN(f)?w(1,I.bad_val,d):l.octave=f;break;case "cue=":l.scale=
"on"==a.shift()?.7:1;break;case "instrument=":d=a.shift();f=d.indexOf("/");if(0>f){f=bb("c"+d);if(void 0==f)break;l.sndtran=f;f=0}else{f=bb("c"+d.slice(f+1));if(void 0==f)break;l.sndtran=f;f=bb(d.replace("/",""));if(void 0==f)break}l.transp=p.sound?l.sndtran:f;h=1;break;case "map=":l.map=a.shift();break;case "name=":case "nm=":l.nm=a.shift();'"'==l.nm[0]&&(l.nm=Ob(l.nm.slice(1,-1)));l.new_name=!0;break;case "stem=":case "pos=":d="pos="==d?a.shift().slice(1,-1).split(" "):["stm",a.shift()];f=qd[d[1]];
if(void 0==f){w(1,I.bad_val,"%%pos");break}switch(d[2]){case "align":f|=n.SL_ALIGN;break;case "center":f|=n.SL_CENTER;break;case "close":f|=n.SL_CLOSE}e||(e={});e[d[0]]=f;break;case "scale=":f=+a.shift();isNaN(f)||.5>f||2<f?w(1,I.bad_val,"%%voicescale"):l.scale=f;break;case "score=":if(p.nedo){w(1,I.notransp);break}d=a.shift();if(p.sound)break;f=bb(d,!0);void 0!=f&&(l.transp=f,h=1);break;case "shift=":if(p.nedo){w(1,I.notransp);break}f=bb(a.shift());void 0!=f&&(l.shift=l.sndsh=f,h=1);break;case "sound=":if(p.nedo){w(1,
I.notransp);break}f=bb(a.shift());if(void 0==f)break;l.sndtran=f;p.sound&&(l.transp=f);h=1;break;case "subname=":case "sname=":case "snm=":l.snm=a.shift();'"'==l.snm[0]&&(l.snm=l.snm.slice(1,-1));break;case "stafflines=":f=Gf(a.shift());void 0==f?w(1,"Bad %%stafflines value"):void 0!=l.st?L.staves[l.st].stafflines=f:l.stafflines=f;break;case "staffnonote=":f=+a.shift();isNaN(f)?w(1,"Bad %%staffnonote value"):l.staffnonote=f;break;case "staffscale=":f=+a.shift();isNaN(f)||.3>f||2<f?w(1,"Bad %%staffscale value"):
l.staffscale=f;break;case "transpose=":if(p.nedo){w(1,I.notransp);break}f=Ee(a.shift());void 0==f?w(1,I.bad_transp):(l.sndtran=f,p.sound&&(l.transp=f),h=1);break;default:switch(d.slice(0,4)){case "treb":case "bass":case "alto":case "teno":case "perc":c=d;break;default:0<="GFC".indexOf(d[0])?c=d:"="==d.slice(-1)&&a.shift()}}}if(e)for(d in l.pos=B(l.pos),e)e.hasOwnProperty(d)&&(l.pos[d]=e[d]);c&&(c=ce(c))&&(g&&(c.clefpit=g),Fe(c));h&&fc()};var id=/(\d*)(\/*)(\d*)/g;Abc.prototype.new_note=function(a,
c){var d;var e=[];var f=t.line,g=la;la=[];t.stemless=!1;var h={type:n.NOTE,fname:t.fname,stem:0,multi:0,nhd:0,xmx:0};h.istart=t.bol+f.index;l.color&&(h.color=l.color);if(a)h.grace=!0;else{if(l.tie_s){var m=l.tie_s;l.tie_s=null}Ia&&dc(h);t.repeat_n&&(h.repeat_n=t.repeat_n,h.repeat_k=t.repeat_k,t.repeat_n=0)}var k=f.char();switch(k){case "X":h.invis=!0;case "Z":h.type=n.MREST;k=f.next_char();h.nmes="0"<k&&"9">=k?f.get_int():1;if(1==l.wmeasure){x(1,null,"multi-measure rest, but no measure!");return}h.dur=
l.wmeasure*h.nmes;if(l.second){delete l.eoln;l.time+=h.dur;return}1==h.nmes?(h.type=n.REST,h.dur_orig=h.dur,h.fmr=1,h.notes=[{pit:18,dur:h.dur}]):ha.mrest_p=!0;break;case "y":h.type=n.SPACE;h.invis=!0;h.dur=0;k=f.next_char();h.width="0"<=k&&"9">=k?f.get_int():10;m&&(l.tie_s=m,m=null);break;case "x":h.invis=!0;case "z":h.type=n.REST;f.index++;var r=uc(f);h.dur_orig=(0>l.ulen?n.BLEN:l.ulen)*r[0]/r[1];h.dur=h.dur_orig*l.dur_fact;h.dur==l.wmeasure&&(h.fmr=1);h.notes=[{pit:18,dur:h.dur_orig}];break;case "[":r=
!0,k=f.next_char();default:if(l.acc_tie){var p=l.acc_tie;l.acc_tie=null}for(h.notes=[];;){if(r)for(;k;){k=k.charCodeAt(0);if(128<=k){w(1,I.not_ascii);return}k=za[k];switch(k[0]){case "(":e.push(Tb());k=f.char();continue;case "!":1<k.length?la.push(k.slice(1,-1)):ke();k=f.next_char();continue}break}var q=f;k=h.grace?n.BLEN/4:0>l.ulen?n.BLEN:l.ulen;(d=ob(q))?("0"==q.char()&&(t.stemless=!0,q.index++),q=uc(q),d.dur=k*q[0]/q[1]):d=void 0;if(!d)return;l.octave&&(d.pit+=7*l.octave);q=d.pit+19;(k=d.acc)?
l.acc[q]=k:(k=l.acc[q],!k&&p&&(k=p[q]),k||(k=l.ckey.k_map[q%7]||0));if(l.map&&eb[l.map])a:{var y=d,u=y.pit,v=Ce(u,k),z=eb[l.map];if(!(z[v]||(v="o"+v.replace(/[',]+/,""),z[v]||(v="k"+Sb[(u+75-11*l.ckey.k_sf)%7],z[v]||(v="all",z[v])))))break a;y.map=z=z[v];z[1]&&(y.pit=z[1].pit,y.acc=z[1].acc);z[2]&&(y.color=z[2]);if(v=z[3])y.midi=je(v.pit+19,v.acc)}d.midi||(d.midi=je(q,k));l.ckey.k_sndtran&&(d.midi+=abc2svg.b40m(l.ckey.k_sndtran+122)-36);if(e.length){for(;;){k=e.shift();if(!k)break;l.sls.push({is_note:!0,
note:d,ty:k})}d.s=h}la.length&&(h.time=l.time,lc(h,d));h.notes.push(d);if(!r)break;for(k=f.char();;){switch(k){case ")":d.s=h;ie(d,!0);k=f.next_char();continue;case "-":d.tie_ty=Tb();d.s=h;l.tie_s=h;h.ti1=!0;if(l.acc[q]||p&&p[q])l.acc_tie||(l.acc_tie=[]),l.acc_tie[q]=l.acc[q]||p[q];k=f.char();continue;case ".":k=f.next_char();switch(k){case "-":case "(":la.push("dot");continue}w(1,"Misplaced dot")}break}if("]"==k){f.index++;r=uc(f);h.nhd=h.notes.length-1;for(k=0;k<=h.nhd;k++)d=h.notes[k],d.dur=d.dur*
r[0]/r[1];break}}if(c.length)for(;;){k=c.shift();if(!k)break;h.notes[0].s=h;l.sls.push({note:h.notes[0],ty:k});a&&(l.sls[l.sls.length-1].grace=a)}h.dur_orig=h.notes[0].dur;h.dur=h.notes[0].dur*l.dur_fact}if(h.grace&&h.type!=n.NOTE)w(1,I.bad_grace);else{if(h.notes){if(a){c=l.ckey.k_bagpipe?8:4;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=c;h.dur/=c;h.dur_orig/=c;a.stem&&(h.stem=a.stem)}else{switch(l.pos.stm&7){case n.SL_ABOVE:h.stem=1;break;case n.SL_BELOW:h.stem=-1;break;case n.SL_HIDDEN:h.stemless=!0}if(e=
l.brk_rhythm){l.brk_rhythm=0;r=l.last_note;if(0<e){c=2*e-1;h.dur=h.dur*c/e;h.dur_orig=h.dur_orig*c/e;for(k=0;k<=h.nhd;k++)h.notes[k].dur=h.notes[k].dur*c/e;r.dur/=e;r.dur_orig/=e;for(k=0;k<=r.nhd;k++)r.notes[k].dur/=e}else{e=-e;c=2*e-1;h.dur/=e;h.dur_orig/=e;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=e;r.dur=r.dur*c/e;r.dur_orig=r.dur_orig*c/e;for(k=0;k<=r.nhd;k++)r.notes[k].dur=r.notes[k].dur*c/e}l.time=r.time+r.dur;for(r=r.next;r;r=r.next)r.time=l.time}}l.last_note=h;for(k=f.char();;){switch(k){case ".":if("-"!=
f.buffer[f.index+1])break;la.push("dot");f.index++;case "-":c=Tb();for(k=0;k<=h.nhd;k++)h.notes[k].tie_ty=c,h.notes[k].s=h;l.tie_s=a||h;l.tie_s.ti1=!0;for(k=0;k<=h.nhd;k++)if(d=h.notes[k],q=d.pit+19,l.acc[q]||p&&p[q])l.acc_tie||(l.acc_tie=[]),l.acc_tie[q]=l.acc[q]||p[q];k=f.char();continue}break}if(m){e=0;d=m.time+m.dur==l.time;for(p=0;p<=h.nhd;p++)if(r=h.notes[p],k=r.midi,m.type!=n.GRACE)for(q=0;q<=m.nhd;q++){if(c=m.notes[q],c.tie_ty&&!(c.midi!=k||d&&c.tie_e)){r.tie_s=c;r.s=h;d&&(c.tie_e=r,c.s=m);
e++;break}}else for(q=m.extra;q;q=q.next)if(c=q.notes[0],c.tie_ty&&c.midi==k){q.ti1=!0;r.tie_s=c;r.s=h;c.tie_e=r;c.s=q;e++;break}e?h.ti2=!0:x(1,m,"Bad tie")}}Ca(h);a||(l.lyric_restart||(l.lyric_restart=h),l.sym_restart||(l.sym_restart=h));g.length&&(la=g,ib(h,h.prev));t.ottava.length&&(a?a.ottava=t.ottava:h.ottava=t.ottava,t.ottava=[]);t.stemless&&(h.stemless=!0);h.iend=t.bol+f.index;return h}};var za='0;0;0;0;0;0;0;0;0; ;\n;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0; ;!;";i;\n;0;&;0;(;);i;0;0;-;!dot!;0;0;0;0;0;0;0;0;0;0;0;|;i;<;n;<;i;i;n;n;n;n;n;n;n;!fermata!;d;d;d;!emphasis!;!lowermordent!;d;!coda!;!uppermordent!;d;d;!segno!;!trill!;d;d;d;n;d;n;[;\\;|;n;n;i;n;n;n;n;n;n;n;d;d;d;d;d;d;d;d;d;d;d;d;d;!upbow!;!downbow!;d;n;n;n;{;|;};!gmark!;0'.split(";"),
le={"8va(":1,"8va)":0,"15ma(":2,"15ma)":0,"8vb(":-1,"8vb)":0,"15mb(":-2,"15mb)":0},Yb,Yc="undefined"!=typeof document?function(a){var c;p.fullsvg&&(fb+="\n"+a);if(!Yb)if(abc2svg.sheet)for(Yb=abc2svg.sheet,c=Yb.cssRules.length;0<=--c;)Yb.deleteRule(c);else c=document.createElement("style"),document.head.appendChild(c),abc2svg.sheet=Yb=c.sheet;for(a=a.match(/[^{]+{[^}]+}/g);;){c=a.shift();if(!c)break;Yb.insertRule(c,Yb.cssRules.length)}}:function(a){fb+="\n"+a},pe=new Float32Array([0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),Kf=new Float32Array([0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278,.278,.355,.556,.556,.889,.667,.191,.333,.333,.389,.584,.278,.333,.278,.278,.556,.556,.556,.556,.556,.556,.556,.556,.556,.556,.278,.278,.584,.584,.584,.556,1.015,.667,.667,.722,.722,.667,.611,.778,.722,.278,.5,.667,.556,.833,.722,.778,.667,.778,.722,.667,.611,.722,.667,.944,.667,.667,.611,.278,.278,.278,.469,.556,.333,.556,.556,.5,.556,.556,.278,.556,.556,.222,.222,.5,.222,.833,.556,.556,.556,.556,.333,.5,.278,.556,.5,.722,.5,.5,.5,.334,.26,.334,
.584,.512]),oe=pe,sa="undefined"!=typeof document?function(){var a=document.createElement("text");a.style.position="absolute";a.style.top="-1000px";a.style.padding="0";document.body.appendChild(a);return function(c){if(c.wh)return c.wh;var d=H.curfont;var e=d.size,f=0,g=0,h=0;a.className=db(d);a.style.lineHeight=1;if("object"==typeof c)return a.innerHTML=c,c.wh=[a.clientWidth,a.clientHeight],c.wh;for(c=c.replace(/<|>|&[^&\s]*?;|&/g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";
case "&":return"&amp;"}return a});;){h=c.indexOf("$",h);if(0>h)break;d=c[h+1];if("0"==d)d=H.deffont;else if("1"<=d&&"9">=d)d=ma("u"+d);else{h++;continue}a.innerHTML=c.slice(g,h);f+=a.clientWidth;d.size>e&&(e=d.size);a.style.font=Xc(d).slice(5);g=h+=2}a.innerHTML=c.slice(g);f+=a.clientWidth;return[f,e]}}():function(a){var c=H.curfont,d=c.swfac,e=c.size,f=0,g,h=a.length;for(g=0;g<h;g++){var m=a[g];switch(m){case "$":m=a[g+1];if("0"==m)c=H.deffont;else if("1"<=m&&"9">=m)c=ma("u"+m);else{m="$";break}g++;
d=c.swfac;c.size>e&&(e=c.size);continue;case "&":" "!=a[g+1]&&(c=a.indexOf(";",g),0<c&&10>c-g&&(g=c,m="a"))}f+=mc(m)*d}return[f,e]},If={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},G="",tb="\n.stroke{stroke:currentColor;fill:none}\n.bW{stroke:currentColor;fill:none;stroke-width:1}\n.bthW{stroke:currentColor;fill:none;stroke-width:3}\n.slW{stroke:currentColor;fill:none;stroke-width:.7}\n.slthW{stroke:currentColor;fill:none;stroke-width:1.5}\n.sW{stroke:currentColor;fill:none;stroke-width:.7}\n.box{outline:1px solid black;outline-offset:1px}",
fb="",nc=p.leftmargin/p.scale,T=0,Z={width:p.pagewidth,lm:p.leftmargin,rm:p.rightmargin},kd={},Dc="",ld="",E={scale:1,dy:0,st:-1,v:-1,g:0},Ma=0,Sc={"mtr ":{x:0,y:0,c:" "},brace:{x:0,y:0,c:"\ue000"},lphr:{x:0,y:23,c:"\ue030"},mphr:{x:0,y:23,c:"\ue038"},sphr:{x:0,y:26,c:"\ue039"},short:{x:0,y:32,c:"\ue038"},tick:{x:0,y:29,c:"\ue039"},rdots:{x:-1,y:0,c:"\ue043"},dsgn:{x:-4,y:-4,c:"\ue045"},dcap:{x:-4,y:-4,c:"\ue046"},sgno:{x:-6,y:0,c:"\ue047"},coda:{x:-12,y:-6,c:"\ue048"},tclef:{x:-8,y:0,c:"\ue050"},
cclef:{x:-8,y:0,c:"\ue05c"},bclef:{x:-8,y:0,c:"\ue062"},pclef:{x:-6,y:0,c:"\ue069"},spclef:{x:-6,y:0,c:"\ue069"},stclef:{x:-8,y:0,c:"\ue07a"},scclef:{x:-8,y:0,c:"\ue07b"},sbclef:{x:-7,y:0,c:"\ue07c"},oct:{x:0,y:2,c:"\ue07d"},oct2:{x:0,y:2,c:"\ue07e"},mtr0:{x:0,y:0,c:"\ue080"},mtr1:{x:0,y:0,c:"\ue081"},mtr2:{x:0,y:0,c:"\ue082"},mtr3:{x:0,y:0,c:"\ue083"},mtr4:{x:0,y:0,c:"\ue084"},mtr5:{x:0,y:0,c:"\ue085"},mtr6:{x:0,y:0,c:"\ue086"},mtr7:{x:0,y:0,c:"\ue087"},mtr8:{x:0,y:0,c:"\ue088"},mtr9:{x:0,y:0,c:"\ue089"},
mtrC:{x:0,y:0,c:"\ue08a"},"mtr+":{x:0,y:0,c:"\ue08c"},"mtr(":{x:0,y:0,c:"\ue094"},"mtr)":{x:0,y:0,c:"\ue095"},HDD:{x:-7,y:0,c:"\ue0a0"},breve:{x:-7,y:0,c:"\ue0a1"},HD:{x:-5.2,y:0,c:"\ue0a2"},Hd:{x:-3.8,y:0,c:"\ue0a3"},hd:{x:-3.7,y:0,c:"\ue0a4"},ghd:{x:2,y:0,c:"\ue0a4",sc:.66},pshhd:{x:-3.7,y:0,c:"\ue0a9"},pfthd:{x:-3.7,y:0,c:"\ue0b3"},x:{x:-3.7,y:0,c:"\ue0a9"},"circle-x":{x:-3.7,y:0,c:"\ue0b3"},srep:{x:-5,y:0,c:"\ue101"},"dot+":{x:-5,y:0,sc:.7,c:"\ue101"},diamond:{x:-4,y:0,c:"\ue1b9"},triangle:{x:-4,
y:0,c:"\ue1bb"},dot:{x:-1,y:0,c:"\ue1e7"},flu1:{x:-.3,y:0,c:"\ue240"},fld1:{x:-.3,y:0,c:"\ue241"},flu2:{x:-.3,y:0,c:"\ue242"},fld2:{x:-.3,y:0,c:"\ue243"},flu3:{x:-.3,y:3.5,c:"\ue244"},fld3:{x:-.3,y:-4,c:"\ue245"},flu4:{x:-.3,y:8,c:"\ue246"},fld4:{x:-.3,y:-9,c:"\ue247"},flu5:{x:-.3,y:12.5,c:"\ue248"},fld5:{x:-.3,y:-14,c:"\ue249"},"acc-1":{x:-1,y:0,c:"\ue260"},"cacc-1":{x:-18,y:0,c:"\ue26a\ue260\ue26b"},"sacc-1":{x:-1,y:0,sc:.7,c:"\ue260"},acc3:{x:-1,y:0,c:"\ue261"},cacc3:{x:-18,y:0,c:"\ue26a\ue261\ue26b"},
sacc3:{x:-1,y:0,sc:.7,c:"\ue261"},acc1:{x:-2,y:0,c:"\ue262"},cacc1:{x:-18,y:0,c:"\ue26a\ue262\ue26b"},sacc1:{x:-2,y:0,sc:.7,c:"\ue262"},acc2:{x:-3,y:0,c:"\ue263"},"acc-2":{x:-3,y:0,c:"\ue264"},"acc-1_2":{x:-2,y:0,c:"\ue280"},"acc-3_2":{x:-3,y:0,c:"\ue281"},acc1_2:{x:-1,y:0,c:"\ue282"},acc3_2:{x:-3,y:0,c:"\ue283"},accent:{x:-3,y:2.5,c:"\ue4a0"},stc:{x:-1,y:-2,c:"\ue4a2"},emb:{x:-4,y:-2,c:"\ue4a4"},wedge:{x:-1,y:0,c:"\ue4a8"},marcato:{x:-3,y:-2,c:"\ue4ac"},hld:{x:-7,y:-2,c:"\ue4c0"},brth:{x:0,y:0,c:"\ue4ce"},
caes:{x:0,y:8,c:"\ue4d1"},r00:{x:-1.5,y:0,c:"\ue4e1"},r0:{x:-1.5,y:0,c:"\ue4e2"},r1:{x:-3.5,y:-6,c:"\ue4e3"},r2:{x:-3.2,y:0,c:"\ue4e4"},r4:{x:-3,y:0,c:"\ue4e5"},r8:{x:-3,y:0,c:"\ue4e6"},r16:{x:-4,y:0,c:"\ue4e7"},r32:{x:-4,y:0,c:"\ue4e8"},r64:{x:-4,y:0,c:"\ue4e9"},r128:{x:-4,y:0,c:"\ue4ea"},mrep:{x:-6,y:0,c:"\ue500"},mrep2:{x:-9,y:0,c:"\ue501"},p:{x:-4,y:-6,c:"\ue520"},f:{x:-2.5,y:-6,c:"\ue522"},pppp:{x:-15,y:-6,c:"\ue529"},ppp:{x:-11,y:-6,c:"\ue52a"},pp:{x:-8,y:-6,c:"\ue52b"},mp:{x:-8.5,y:-6,c:"\ue52c"},
mf:{x:-8,y:-6,c:"\ue52d"},ff:{x:-6,y:-6,c:"\ue52f"},fff:{x:-9,y:-6,c:"\ue530"},ffff:{x:-12,y:-6,c:"\ue531"},sfz:{x:-9,y:-6,c:"\ue539"},trl:{x:-4,y:-2,c:"\ue566"},turn:{x:-5,y:3,c:"\ue567"},turnx:{x:-5,y:3,c:"\ue569"},umrd:{x:-7,y:2,c:"\ue56c"},lmrd:{x:-7,y:2,c:"\ue56d"},dplus:{x:-4,y:0,c:"\ue582"},sld:{x:-8,y:12,c:"\ue5d0"},grm:{x:-2,y:0,c:"\ue5e2"},dnb:{x:-4,y:0,c:"\ue610"},upb:{x:-3,y:0,c:"\ue612"},opend:{x:-2,y:0,c:"\ue614"},roll:{x:0,y:2,c:"\ue618"},thumb:{x:0,y:0,c:"\ue624"},snap:{x:-2,y:0,c:"\ue630"},
ped:{x:-10,y:0,c:"\ue650"},pedoff:{x:-5,y:0,c:"\ue655"},mtro:{x:0,y:0,c:"\ue911"},mtrc:{x:0,y:0,c:"\ue915"},"mtr.":{x:0,y:0,c:"\ue920"},"mtr|":{x:0,y:0,c:"\ue925"},longa:{x:-4.7,y:0,c:"\ue95d"},custos:{x:-4,y:3,c:"\uea02"},ltr:{x:2,y:6,c:"\ueaa4"}},lb={},pa=Vb,Mb=Vb;Abc.prototype.out_svg=function(a){G+=a};Abc.prototype.sx=Ya;Abc.prototype.sy=sb;Abc.prototype.sh=function(a){return 0>E.st?a/E.scale:a};Abc.prototype.ax=function(a){return a+nc};Abc.prototype.ay=function(a){return 0>E.st?T-a:T+(E.dy-a)*
E.scale-E.dy};Abc.prototype.ah=function(a){return 0>E.st?a:a*E.scale};Abc.prototype.out_sxsy=Pa;Abc.prototype.xypath=Cb;var wa=[[],[],"",[],[],[]],Lf={crdc:{dx:0,dy:5,style:"font:italic 14px text,serif"},dacs:{dx:0,dy:3,style:"font:16px text,serif",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font:italic bold 16px text,serif"},"@":{dx:0,dy:5,style:"font:12px text,sans-serif"}};Abc.prototype.out_lped=function(a,c,d,e){c+=4;e.nost||Q(a,c,"ped");e.noen||Q(a+d+6,c,"pedoff")};var xe={arp:ve,cresc:function(a,
c,d,e){a+=d*E.scale;d=-d;U('<path class="stroke"\n\td="mX YlF ',a,c+5,d);G=e.nost?G+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):G+("-4l"+(-d).toFixed(1)+' -4"/>\n')},dim:function(a,c,d,e){U('<path class="stroke"\n\td="mX YlF ',a,c+5,d);G=e.noen?G+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):G+("-4l"+(-d).toFixed(1)+' -4"/>\n')},ltr:we,lped:function(a,c,d,e){V.out_lped(a,c,d,e)},"8va":function(a,c,d,e){18>d&&(d=18,a-=4);e.nost||(U('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',
a-8,c),a+=12,d-=12);c+=6;U('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||U('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"8vb":function(a,c,d,e){18>d&&(d=18,a-=4);e.nost||(U('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy=".5" style="font-size:10px">vb</tspan></text>\n',a-8,c),a+=10,d-=10);U('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||U('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)},"15ma":function(a,c,d,e){25>d&&
(d=25,a-=6);e.nost||(U('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',a-10,c),a+=20,d-=20);c+=6;U('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||U('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"15mb":function(a,c,d,e){24>d&&(d=24,a-=5);e.nost||(U('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy=".5" style="font-size:10px">mb</tspan></text>\n',a-10,c),a+=18,d-=18);U('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',
a,c,d);e.noen||U('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)}},Ke={glisq:function(a,c,d){d=d.start;var e=d.x,f=d.y+z[d.st].y;c=Math.atan2(f-c,a-e);a=(a-e)/Math.cos(c);kb(e,f,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a=(a-e-6)/6|0;for(1>a&&(a=1);0<=--a;)Q(e,0,"ltr"),e+=6;Db()},gliss:function(a,c,d){d=d.start;var e=d.x,f=d.y+z[d.st].y;c=-Math.atan2(c-f,a-e);a=(a-e)/Math.cos(c);kb(e,f,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a-=e+8;Cb(e,0);G+="h"+a.toFixed(1)+'" stroke-width="1"/>\n';Db()}};Abc.prototype.blk_flush=
ab;var L,J,F,l,pb,ea,P,Ka=new Uint8Array([5,1,8,6,0,2,3,9,9,0,9,4,0,7,0,0,0,0]);Abc.prototype.set_bar_num=function(){var a,c,d,e,f=H.nbar,g=0,h=0,m=F[J.top_voice].meter.wmeasure;for(a=P;;a=a.ts_next){if(!a)return;switch(a.type){case n.METER:m=a.wmeasure;case n.CLEF:case n.KEY:case n.STBRK:continue;case n.BAR:a.bar_num&&(f=a.bar_num)}break}for(c=a.ts_next;c;c=c.ts_next)if(c.type==n.BAR&&c.time){c.time<m&&(a=c,g=a.time);break}for(;a;a=a.ts_next)switch(a.type){case n.METER:if(a.time==g)break;1!=m&&(f+=
(a.time-g)/m);g=a.time;m=a.wmeasure;break;case n.BAR:if(!a.invis){a.time!=k&&(e=0);var k=a.time;c=a.text?1:2;if(!(e&c))if(e|=c,a.bar_num)f=a.bar_num,h=g=k;else if(1==m)a.bar_dotted||(a.text&&(p.contbarnb||("1"==a.text[0]?d=f:f=d)),a.bar_num=++f);else{var l=f+(k-g)/m;c=l-(l|0);p.checkbars&&(c&&!a.bar_dotted&&a.next||k>h+m&&a.prev.type!=n.MREST)&&x(0,a,"Bad measure duration");k>h+m&&(l|=0,c=0,g=k,f=l);a.text?"1"==a.text[0]?(d=p.contbarnb?g+c*m:k,c||(a.bar_num=l)):(g=p.contbarnb?d:g+(k-d),l=f+(k-g)/
m,l==(l|0)&&(a.bar_num=l)):(c&&(l-=c),a.bar_num=l);c||(h=k)}}}};Abc.prototype.do_pscom=function(a){var c;if(c=a.match(/[^\s]+/)){c=c[0];if(l&&l.ignore)switch(c){case "staves":case "score":break;default:return}a=a.replace(c,"").trim();if(" lock"==a.slice(-5))Se[c]=!0,a=a.slice(0,-5).trim();else if(Se[c])return;switch(c){case "clef":2<=t.state&&(c=ce(a))&&Fe(c);return;case "deco":c=a.match(/(\S*)\s+(.*)/);$b[c[1]]=c[2];return;case "linebreak":for(c=0;128>c;c++)"\n"==za[c]&&(za[c]="0");a=a.split(/\s+/);
for(c=0;c<a.length;c++){var d=a[c];switch(d){case "!":case "$":case "*":case ";":case "?":case "@":break;case "<none>":continue;case "<EOL>":d="\n";break;default:w(1,"Bad value '$1' in %%linebreak - ignored",d);continue}za[d.charCodeAt(0)]="\n"}return;case "map":a:if(a){var e="";c=a.split(/\s+/);if(3>c.length)w(1,not_enough_p);else{var f=c[1];if("*"==f[0]||0==f.indexOf("all"))f="all";else{if(0==f.indexOf("octave,")||0==f.indexOf("key,"))e=f[0],f=f.split(",")[1],f=f.replace(/[,']+/,"").toUpperCase(),
0==f.indexOf("key,")&&(f=f.replace(/[=^_]+/,""));d=new K;d.buffer=f;d=ob(d);if(!d){w(1,"Bad note in %%map");break a}f=e+Ce(d.pit,d.acc)}(d=eb[c[0]])||(eb[c[0]]=d={});(a=d[f])||(d[f]=a=[]);c.shift();c.shift();if(c.length){c=Rb(c.join(" "));f=0;if(0>c[0].indexOf("=")){"*"!=c[0][0]&&(d=new K,d.buffer=c[0],a[1]=ob(d));if(!c[1])break a;f++;0>c[1].indexOf("=")&&(a[0]=c[1].split(","),f++)}for(;f<c.length;f++)switch(c[f]){case "heads=":if(!c[++f]){w(1,not_enough_p);break}a[0]=c[f].split(",");break;case "print=":case "play=":if(!c[++f]){w(1,
not_enough_p);break}d=new K;d.buffer=c[f];d=ob(d);"r"==c[f-1][1]?a[1]=d:a[3]=d;break;case "color=":c[++f]?a[2]=c[f]:w(1,not_enough_p)}}}}return;case "maxsysstaffsep":case "sysstaffsep":if(3==t.state){d=Qa(a);if(isNaN(d)){w(1,I.bad_val,"%%"+c);return}L.voices[l.v]["m"==c[0]?"maxsep":"sep"]=d;return}break;case "multicol":if(2<=t.state){l=F[0];Za("mc_"+a);break}switch(a){case "start":R={maxy:0,lmarg:p.leftmargin,rmarg:p.rightmargin};break;case "new":if(!R){w(1,"%%multicol new without start");break}T>
R.maxy&&(R.maxy=T);p.leftmargin=R.lmarg;p.rightmargin=R.rmarg;Z.chg=!0;Ra();T=0;break;case "end":if(!R){w(1,"%%multicol end without start");break}T<R.maxy&&(T=R.maxy);p.leftmargin=R.lmarg;p.rightmargin=R.rmarg;R=void 0;ab();Z.chg=!0;Ra();break;default:w(1,"Unknown keyword '$1' in %%multicol",a)}return;case "ottava":if(3!=t.state)return;c=parseInt(a);if(isNaN(c)||-2>c||2<c){w(1,I.bad_val,"%%ottava");return}ha.ottava=!0;t.ottava.push(c);return;case "repbra":l&&(l.norepbra=!Eb(a));return;case "repeat":if(3!=
t.state)return;if(!l.last_sym){w(1,"%%repeat cannot start a tune");return}if(a.length){a=a.split(/\s+/);c=parseInt(a[0]);d=parseInt(a[1]);if(isNaN(c)||1>c||l.last_sym.type==n.BAR&&2<c){w(1,"Incorrect 1st value in %%repeat");return}if(isNaN(d))d=1;else if(1>d){w(1,"Incorrect 2nd value in %%repeat");return}}else d=c=1;t.repeat_n=l.last_sym.type==n.BAR?c:-c;t.repeat_k=d;return;case "sep":Ra();var g=Z.width-Z.lm-Z.rm;d=f=e=0;if(a&&(a=a.split(/\s+/),d=Qa(a[0]),a[1]&&(f=Qa(a[1]),a[2]&&(e=Qa(a[2]))),isNaN(d)||
isNaN(f)||isNaN(e))){w(1,I.bad_val,"%%sep");return}1>d&&(d=14);1>f&&(f=d);1>e&&(e=90);if(2<=t.state){c=Za(c);c.x=(g-e)/2/p.scale;c.l=e/p.scale;c.sk1=d;c.sk2=f;return}ia(d);G+='<path class="stroke"\n\td="M';Pa((g-e)/2/p.scale," ",0);G+="h"+(e/p.scale).toFixed(1)+'"/>\n';ia(f);ab();return;case "setbarnb":d=parseInt(a);if(isNaN(d)||1>d){w(1,"Bad %%setbarnb value");break}ha.new_nbar=d;return;case "staff":if(3!=t.state)return;d=parseInt(a);if(isNaN(d)){w(1,"Bad %%staff value '$1'",a);return}c="+"==a[0]||
"-"==a[0]?l.cst+d:d-1;if(0>c||c>S){w(1,"Bad %%staff number $1 (cur $2, max $3)",c,l.cst,S);return}delete l.floating;l.cst=c;return;case "staffbreak":if(3!=t.state)return;c={type:n.STBRK,dur:0};"f"==a.slice(-1)&&(c.stbrk_forced=!0,a=a.replace(/\sf$/,""));if(a){d=Qa(a);if(isNaN(d)){w(1,I.bad_val,"%%staffbreak");return}c.xmx=d}else c.xmx=14;Ca(c);return;case "stafflines":case "staffscale":case "staffnonote":sc(c,a);return;case "staves":case "score":if(!t.state)return;t.scores&&0<t.scores.length&&(a=
t.scores.shift(),c=a.match(/([^\s]+)\s*(.*)/),a=c[2],c=c[1]);a:{f=a;var h;d=F.length;a=0;if(f){b:{g={};var m=[];var k=!1;var r=h=0,x=0,z=0,y=0,u=f.match(/[^[\]|{}()*+\s]+|[^\s]/g);if(u){for(;;){var v=u.shift();if(!v)break;switch(v){case "[":if(z||2<=r+x){w(1,I.misplaced,"[");k=!0;break}h|=0==r+x?4:1024;x++;y<<=8;y|=4;break;case "{":if(z||r||2<=x){w(1,I.misplaced,"{");k=!0;break}h|=x?256:1;r++;y<<=8;y|=1;break;case "(":if(z){w(1,I.misplaced,"(");k=!0;break}h|=16;z++;y<<=8;y|=16;break;case "*":!r||
z||h&257||(h|=128);break;case "+":h|=4096;break;case "]":case "}":case ")":w(1,"Bad voice ID in %%score");k=!0;break;default:for(e=v;;){v=u.shift();if(!v)break;switch(v){case "]":if(!(y&4)){w(1,I.misplaced,"]");k=!0;break}x--;h|=0==r+x?8:2048;y>>=8;continue;case "}":if(!(y&1)){w(1,I.misplaced,"}");k=!0;break}r--;h|=x?512:2;h&=-129;y>>=8;continue;case ")":if(!(y&16)){w(1,I.misplaced,")");k=!0;break}z--;h|=32;y>>=8;continue;case "|":h|=64;continue}break}g[e]?(w(1,"Double voice in %%score"),k=!0):(g[e]=
!0,m.push([e,h]));h=0;v&&u.unshift(v)}}0!=y&&(w(1,"'}', ')' or ']' missing in %%score"),k=!0);if(!k&&m.length){e=m;break b}}else w(1,I.bad_val,"%%score");e=void 0}if(!e)break a}for(m=0;m<d;m++)g=F[m],g.time>a&&(a=g.time);if(a){d&&$c(!0);for(m=0;m<L.voices.length;m++)if(L.voices[m]){l=F[m];break}l.time=a;h={type:n.STAVES,dur:0};Ca(h);L.nstaff=S;if(!f){h.sy=B(L,1);L=L.next=h.sy;pb=a;for(m=0;m<d;m++)F[m].time=a;l=F[L.top_voice];break a}Be();h.sy=L}else L.staves=[],L.voices=[];pb=a;for(m=0;m<d;m++)g=
F[m],delete g.second,delete g.ignore,delete g.floating;for(f=d=0;f<e.length;f++)for(g=e[f][0],g=pd(g),g.time=a,m=g.v,e[f][0]=g;;){L.voices[m]={range:d++};g=g.voice_down;if(!g)break;m=g.v}L.top_voice=e[0][0].v;if("t"==c[1])for(f=0;f<e.length;f++)d=e[f][1],d&257&&3!=(d&3)&&768!=(d&768)&&0==e[f+1][1]&&!(d&16||e[f+2][1]&16)&&(e[f+2][1]&514?e[f+1][1]|=128:0==e[f+2][1]&&e[f+3][1]&514&&(e[f][1]|=16,e[f+1][1]|=32,e[f+2][1]|=16,e[f+3][1]|=32));k=-1;for(f=0;f<e.length;f++)if(d=e[f][1],48==(d&48)&&(d&=-49,e[f][1]=
d),g=e[f][0],d&128?(g.floating=!0,g.second=!0):(k++,L.staves[k]||(L.staves[k]={stafflines:g.stafflines||"|||||",staffscale:1}),L.staves[k].flags=0),m=g.v,g.st=g.cst=L.voices[m].st=k,L.staves[k].flags|=d,d&16){for(h=g;f<e.length-1&&!(g=e[++f][0],m=g.v,e[f][1]&4096?(h.second=!0,h=g):g.second=!0,g.st=g.cst=L.voices[m].st=k,e[f][1]&32););L.staves[k].flags|=e[f][1]}0>k&&(k=0);L.nstaff=S=k;if("c"==c[1])for(k=0;k<S;k++)L.staves[k].flags^=64;d=F.length;for(m=k=0;m<d;m++){g=F[m];L.voices[m]?k=g.st:g.st=k;
if(!a)for(h=g.sym;h;h=h.next)h.st=k;if(L.voices[m]){for(h=g.voice_down;h;)f=h.v,h.st=h.cst=L.voices[f].st=k,h=h.voice_down;L.voices[m].second=g.second;k=g.st;!(0<k)||g.norepbra||L.staves[k-1].flags&64||(g.norepbra=!0)}}!a&&d&&$c(!0);l=2<=t.state?F[L.top_voice]:null}return;case "center":case "text":d="c"==c[0]?"c":p.textoption;fa("text");if(2<=t.state){c=Za("text");c.text=a;c.opt=d;c.font=p.textfont;return}jd(a,d);return;case "transpose":if(p.sound)return;d=Ee(a);if(void 0==d&&(d=bb(a),void 0==d))return;
switch(t.state){case 0:p.transp=0;case 1:p.transp=(p.transp||0)+d;return}for(c=l.last_sym;c;c=c.prev){switch(c.type){case n.NOTE:c=B(l.okey);c.k_old_sf=l.ckey.k_sf;Ca(c);break;case n.KEY:break;default:continue}break}l.transp=d;fc();return;case "tune":return;case "user":de(a);return;case "voicecolor":l&&(l.color=a);return;case "vskip":d=Qa(a);if(isNaN(d)){w(1,I.bad_val,"%%vskip");return}if(0>d){w(1,"%%vskip cannot be negative");return}if(2<=t.state){c=Za(c);c.sk=d;return}ia(d);return;case "newpage":case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "printmargin":case "scale":case "staffwidth":if(2<=
t.state){c=Za(c);c.param=a;return}if("newpage"==c){ab();q.page_format&&(Ma=2);return}}V.set_format(c,a)}};Abc.prototype.do_begin_end=function(a,c,d){switch(a){case "js":La(d);break;case "ml":if(p.pageheight){w(1,"Cannot have %%beginml with %%pageheight");break}2<=t.state?(a=Za(a),a.text=d):(ab(),q.img_out&&q.img_out(d));break;case "svg":for(c=0;;){a=d.indexOf("<style",c);if(0>a)break;a=d.indexOf(">",a);c=d.indexOf("</style>",a);if(0>c){w(1,"No </style> in %%beginsvg sequence");break}tb+=d.slice(a+
1,c).replace(/\s+$/,"")}for(c=0;;){a=d.indexOf("<defs>\n",c);if(0>a)break;c=d.indexOf("</defs>",a);if(0>c){w(1,"No </defs> in %%beginsvg sequence");break}re(d.slice(a+6,c))}break;case "text":c=Id(c),c||(c=p.textoption),fa("text"),0<=d.indexOf("\\")&&(d=Ob(d)),1<t.state?(a=Za(a),a.text=d,a.opt=c,a.font=p.textfont):jd(d,c)}};var Ie="CDEFGAB",Nf=["bb","b","","#","##"];Abc.prototype.gch_build=function(a){var c,d=0,e=0;for(c=0;c<a.a_gch.length;c++){var f=a.a_gch[c];if("g"==f.type)f.text=f.text.replace(/##|#|=|bb|b/g,
function(a){switch(a){case "##":return"&#x1d12a;";case "#":return"\u266f";case "=":return"\u266e";case "b":return"\u266d"}return"&#x1d12b;"});else if("@"==f.type&&!q.anno_start&&!q.anno_stop){fa(f.font);f.text=qb(f.text);f.text.wh=[0,0];continue}fa(f.font);f.text=qb(f.text);var g=f.text.wh;g[1]+=2*f.font.pad;switch(f.type){case "@":break;case "^":case "_":g=.4*g[0];8<g&&(g=8);f.x=-g;break;case "<":f.x=-(g[0]+6);d-=g[1];f.y=d+g[1]/2;break;case ">":f.x=6;e-=g[1];f.y=e+g[1]/2;break;default:g=.4*g[0],
8<g&&(g=8),f.x=-g}}d/=2;e/=2;for(c=0;c<a.a_gch.length;c++)switch(f=a.a_gch[c],f.type){case "<":f.y-=d;break;case ">":f.y-=e}};Abc.prototype.draw_gchord=function(a,c,d,e){if(!c.invis||!c.play){a=c.a_gch[a];var f=a.text.wh[1];var g=a.font.pad;var h=a.text.wh[0]+2*g,l=0;a.font.figb&&(f*=2.4,l=1.3*a.font.size);switch(a.type){case "_":e-=f+g;Y(c.st,0,d,h,e-g);break;case "^":e=aa(c.st,1,d,h);e+=g;Y(c.st,1,d,h,e+f+g);break;case "<":case ">":"<"==a.type?(c.notes[0].acc&&(d-=c.notes[0].shac),d-=g):(c.xmx&&
(d+=c.xmx),c.dots&&(d+=1.5+3.5*c.dots),d+=g);e+=(c.type==n.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)-f/2;24<e&&Y(c.st,1,d,h,e+f+g);0>e&&Y(c.st,0,d,h,e-g);break;default:0<=e?(e+=g,Y(c.st,1,d,h,e+f+g)):(e-=f+g,Y(c.st,0,d,h,e-g));break;case "@":e+=(c.type==n.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)+.2*f,0<e?(g=e+.8*f,g>z[c.st].ann_top&&(z[c.st].ann_top=g)):(g=e,g<z[c.st].ann_bot&&(z[c.st].ann_bot=g))}Gb(a.font);fa(a.font);Ea(c.st);q.anno_start&&q.anno_start("annot",a.istart,
a.iend,d-2,e+f+2,h+4,f+4,c);ka(d,e+l,a.text);q.anno_stop&&q.anno_stop("annot",a.istart,a.iend,d-2,e+f+2,h+4,f+4,c)}};Pd();Abc.prototype.a_de=function(){return da};Abc.prototype.add_style=function(a){tb+=a};Abc.prototype.cfmt=function(){return p};Abc.prototype.clone=B;Abc.prototype.deco_put=function(a,c){la.push(a);ib(c)};Abc.prototype.defs_add=re;Abc.prototype.dh_put=function(a,c,d){la.push(a);lc(c,d)};Abc.prototype.draw_meter=Ad;Abc.prototype.draw_note=pc;Abc.prototype.errs=I;Abc.prototype.font_class=
db;Abc.prototype.gch_tr1=Od;Abc.prototype.get_bool=Eb;Abc.prototype.get_cur_sy=function(){return J};Abc.prototype.get_curvoice=function(){return l};Abc.prototype.get_delta_tb=function(){return rd};Abc.prototype.get_decos=function(){return $b};Abc.prototype.get_font=ma;Abc.prototype.get_font_style=function(){return fb};Abc.prototype.get_glyphs=function(){return lb};Abc.prototype.get_img=function(){return Z};Abc.prototype.get_maps=function(){return eb};Abc.prototype.get_multi=function(){return R};Abc.prototype.get_newpage=
function(){if(block.newpage)return block.newpage=!1,!0};Abc.prototype.get_posy=function(){return T};Abc.prototype.get_staff_tb=function(){return z};Abc.prototype.get_top_v=function(){return L.top_voice};Abc.prototype.get_tsfirst=function(){return P};Abc.prototype.get_unit=Qa;Abc.prototype.get_voice_tb=function(){return F};Abc.prototype.glout=ec;Abc.prototype.info=function(){return N};Abc.prototype.new_block=Za;Abc.prototype.out_arp=ve;Abc.prototype.out_deco_str=ue;Abc.prototype.out_deco_val=od;Abc.prototype.out_ltr=
we;Abc.prototype.param_set_font=Kb;Abc.prototype.parse=t;Abc.prototype.psdeco=Vb;Abc.prototype.psxygl=Vb;Abc.prototype.set_cur_sy=function(a){J=a};Abc.prototype.set_dscale=Ea;Abc.prototype.set_font=fa;Abc.prototype.set_a_gch=function(a,c){Ia=c;dc(a)};Abc.prototype.set_hl=Oa;Abc.prototype.set_pagef=function(){Ma=1};Abc.prototype.set_realwidth=function(a){ra=a};Abc.prototype.set_scale=Ub;Abc.prototype.set_sscale=Fa;Abc.prototype.set_tsfirst=function(a){P=a};Abc.prototype.set_v_param=sc;Abc.prototype.strwh=
sa;Abc.prototype.stv_g=function(){return E};Abc.prototype.svg_flush=rb;Abc.prototype.syntax=w;Abc.prototype.tunes=ad;Abc.prototype.unlksym=jb;Abc.prototype.use_font=Gb;Abc.prototype.vskip=ia;Abc.prototype.xy_str=ka;Abc.prototype.xygl=Q;var Je};var Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc);abc2svg.loadjs||(abc2svg.loadjs=function(q,B,D){D&&D(q)});
abc2svg.modules={ambitus:{},begingrid:{fn:"grid3"},beginps:{fn:"psvg"},break:{},capo:{},chordnames:{},clip:{},clairnote:{fn:"clair"},voicecombine:{fn:"combine"},diagram:{fn:"diag"},equalbars:{},gamelan:{},grid:{},grid2:{},jazzchord:{},jianpu:{},mdnn:{},MIDI:{},nns:{},pageheight:{fn:"page"},pedline:{},percmap:{fn:"perc"},roman:{},soloffs:{},sth:{},strtab:{},temperament:{fn:"temper"},nreq:0,hooks:[],g_hooks:[],load:function(q,B,D){function x(){return"object"==typeof user&&user.errmsg?user.errmsg:"function"==
typeof abc2svg.printErr?abc2svg.printErr:"function"==typeof alert?function(q){alert(q)}:"object"==typeof console?console.log:function(){}}function K(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}var w=this.nreq;q=q.match(/(^|\n)(%%|I:).+?\b/g);if(!q)return!0;this.cbf=B||function(){};this.errmsg=D||x();for(D=0;D<q.length;D++){var La=q[D].replace(/\n?(%%|I:)/,"");(B=abc2svg.modules[La])&&!B.loaded&&(B.loaded=!0,B.fn&&(La=B.fn),this.nreq++,abc2svg.loadjs(La+"-1.js",K,function(){abc2svg.modules.errmsg("Error loading the module "+
La);K()}))}return this.nreq==w}};abc2svg.version="1.22.1";abc2svg.vdate="2022-09-15";
abc2svg.MIDI={do_midi:function(q){var B,D=q.split(/\s+/);q=this.cfmt();if(B=this.get_curvoice()){if(B.ignore)return;void 0==B.chn&&(B.chn=9>B.v?B.v:B.v+1)}switch(D[1]){case "chordname":q.chord||(q.chord={});q.chord.names||(q.chord.names={});q.chord.names[D[2]]=D.slice(3);break;case "chordprog":q.chord||(q.chord={});q.chord.prog=D[2];D[3]&&"octave="==D[3].slice(0,7)&&(q.chord.trans=Number(D[3].slice(7)));break;case "chordvol":var x=Number(D[2]);if(isNaN(x)||0>x||127<x){this.syntax(1,this.errs.bad_val,
"%%MIDI chordvol");break}q.chord||(q.chord={});q.chord.vol=x/127;break;case "gchordon":case "gchordoff":q.chord||(q.chord={});if(2<=this.parse.state&&B){var K=this.new_block("midigch");K.play=!0;K.on="n"==D[1][7]}else q.chord.gchon="n"==D[1][7];break;case "channel":x=parseInt(D[2]);if(isNaN(x)||0>=x||16<x){this.syntax(1,this.errs.bad_val,"%%MIDI channel");break}if(9!=--x){3==this.parse.state?(K=this.new_block("midiprog"),K.play=!0,B.chn=K.chn=x):this.set_v_param("channel",x);break}abc2svg.MIDI.do_midi.call(this,
"MIDI control 0 1");abc2svg.MIDI.do_midi.call(this,"MIDI control 32 0");break;case "drummap":x=Number(D[3]);if(isNaN(x)){this.syntax(1,this.errs.bad_val,"%%MIDI drummap");break}for(B="C ^C D _E E F ^F G ^G A _B B".split(" ")[x%12];60>x;)B+=",",x+=12;for(;72<x;)B+="'",x-=12;this.do_pscom("map MIDIdrum "+D[2]+" play="+B);this.set_v_param("mididrum","MIDIdrum");break;case "program":void 0!=D[3]?(abc2svg.MIDI.do_midi.call(this,"MIDI channel "+D[2]),x=D[3]):x=D[2];x=parseInt(x);if(isNaN(x)||0>x||127<x){this.syntax(1,
this.errs.bad_val,"%%MIDI program");break}3==this.parse.state?(K=this.new_block("midiprog"),K.play=!0,K.instr=x,K.chn=B.chn):this.set_v_param("instr",x);break;case "control":B=parseInt(D[2]);if(isNaN(B)||0>B||127<B){this.syntax(1,"Bad controller number in %%MIDI");break}x=parseInt(D[3]);if(isNaN(x)||0>x||127<x){this.syntax(1,"Bad controller value in %%MIDI");break}3==this.parse.state?(K=this.new_block("midictl"),K.play=!0,K.ctrl=B,K.val=x):this.set_v_param("midictl",D[2]+" "+D[3]);break;case "temperamentequal":if(B=
parseInt(D[2]),isNaN(B)||5>B||255<B)this.syntax(1,this.errs.bad_val,"%%MIDI "+D[1]);else{53==B&&(K=this.get_glyphs(),K.acc12_53='<text id="acc12_53" x="-1">&#xe282;</text>',K.acc24_53='<text id="acc24_53" x="-1">&#xe282;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',K.acc36_53='<text id="acc36_53" x="-1">&#xe262;\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>',K.acc48_53='<text id="acc48_53" x="-1">&#xe262;</text>',K.acc60_53='<g id="acc60_53">\n\t<text style="font-size:1.2em" x="-1">&#xe282;</text>\n\t<path class="stroke" stroke-width="1.6" d="M-2 1.5l7 -3"/>\n</g>',
K["acc-60_53"]='<text id="acc-60_53" x="-1">&#xe260;</text>',K["acc-48_53"]='<g id="acc-48_53">\n\t<text x="-1">&#xe260;</text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',K["acc-36_53"]='<g id="acc-36_53">\n\t<text x="-1">&#xe260;\t\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',K["acc-24_53"]='<text id="acc-24_53" x="-2">&#xe280;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',
K["acc-12_53"]='<text id="acc-12_53" x="-2">&#xe280;</text>');q.nedo=B;x=12*(7.019550008653874*B/12+.5|0)/B;(6.85>x||7.2<x)&&this.syntax(0,this.errs.bad_val,"%%MIDI "+D[1]);K=[2,25,8,31,14,37,20,3,26,9,32,15,38,21,4,27,10,33,16,39];B=[0,19,36,13,30,7,24,1,18,35,12,29,6,23,0,17];var w=21-3*x;b=new Float32Array(40);for(D=0;D<K.length;D++)b[K[D]]=(x*D+w)%12;for(D=1;D<=B.length;D++)b[B[D]]=12-(x*D-w)%12;q.temper=b}}},set_vp:function(q,B){var D,x=this.get_curvoice();if(void 0==x.st){var K=0;var w=this.get_voice_tb();
for(D=0;D<w.length;D++)void 0!=w[D].st&&w[D].st>K&&(K=w[D].st);x.st=x.cst=K+1}for(D=0;D<B.length;D++)switch(B[D]){case "channel=":K=this.new_block("midiprog");K.play=!0;K.chn=x.chn=B[++D];break;case "instr=":K=this.new_block("midiprog");K.play=!0;K.instr=B[++D];void 0==x.chn&&(x.chn=9>x.v?x.v:x.v+1);K.chn=x.chn;break;case "midictl=":x.midictl||(x.midictl=[]);K=B[++D].split(" ");x.midictl[K[0]]=Number(K[1]);break;case "mididrum=":x.map||(x.map={}),x.map=B[++D]}q(B)},do_pscom:function(q,B){"MIDI "==
B.slice(0,5)?abc2svg.MIDI.do_midi.call(this,B):q(B)},set_hooks:function(q){q.do_pscom=abc2svg.MIDI.do_pscom.bind(q,q.do_pscom);q.set_vp=abc2svg.MIDI.set_vp.bind(q,q.set_vp)}};abc2svg.modules.hooks.push(abc2svg.MIDI.set_hooks);abc2svg.modules.MIDI.loaded=!0;
abc2svg.perc={do_perc:function(q){new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]);new Int8Array([3,1,3,-1,3,3,1,3,-1,3,-1,3]);var B={"a-b-d":35,"a-s":38,"b-d-1":36,ca:69,cl:75,co:56,"c-c":52,"c-c-1":49,"c-c-2":57,"c-h-h":42,"e-s":40,"h-a":67,"h-b":60,"h-c":39,"h-f-t":43,"h-m-t":48,"h-ti":65,"h-to":50,"h-w-b":76,"l-a":68,"l-b":61,"l-c":64,"l-f-t":41,"l-g":74,"l-m-t":47,"l-ti":66,"l-to":45,"l-w":72,"l-w-b":77,m:70,"m-c":78,"m-h-c":62,"m-t":80,"o-c":79,"o-h-c":63,"o-h-h":46,"o-t":81,"p-h-h":44,"r-b":53,"r-c-1":51,
"r-c-2":59,"s-c":55,"s-g":73,"s-s":37,"s-w":71,t:54,v:58};q=q.split(/\s+/);var D=q[1].replace(/[=_^]/,"");this.do_pscom("map MIDIdrum "+q[1]+" play="+function(q){var x;if(/^[_^]*[A-Ga-g][,']*$/.test(q))return q;var w=Number(q);if(isNaN(w)){q=q.toLowerCase(q);var D=q[0];for(x=0;;){x=q.indexOf("-",x);if(0>x)break;x+=1;D+="-"+q[x]}w=B[D];if(!w){switch(q[0]){case "c":switch(q[1]){case "a":w=B.ca;break;case "l":w=B.cl;break;case "o":w=B.co}break;case "h":case "l":if(x=q.indexOf("-"),"t"==q[x+1])switch(q[x+
2]){case "i":case "o":w=B[D+q[x+2]]}}if(!w)return}}for(q="C ^C D _E E F ^F G ^G A _B B".split(" ")[w%12];60>w;)q+=",",w+=12;for(;72<=w;)q+="'",w-=12;return q}(q[2])+" print="+D+(q[3]?" heads="+q[3]:""));this.set_v_param("perc","MIDIdrum")},set_perc:function(q){var B,D=this.get_curvoice();for(B=0;B<q.length;B++)switch(q[B]){case "perc=":D.map||(D.map={}),D.map=q[B+1],D.midictl||(D.midictl=[]),D.midictl[0]=1}},do_pscom:function(q,B){"percmap "==B.slice(0,8)?abc2svg.perc.do_perc.call(this,B):q(B)},set_vp:function(q,
B){abc2svg.perc.set_perc.call(this,B);q(B)},set_hooks:function(q){q.do_pscom=abc2svg.perc.do_pscom.bind(q,q.do_pscom);q.set_vp=abc2svg.perc.set_vp.bind(q,q.set_vp)}};abc2svg.modules.hooks.push(abc2svg.perc.set_hooks);abc2svg.modules.percmap.loaded=!0;
abc2svg.pedline={draw_all_deco:function(q){var B,D=this.a_de();if(D.length){if(this.cfmt().pedline)for(B=0;B<D.length;B++){var x=D[B];"ped)"==x.dd.name&&(x.prev&&"ped)"==x.prev.dd.name?(x.defl.nost=!0,x.prev.defl.noen=!0,x.x=x.prev.s.x-5,x.val=x.s.x-x.x-5,x.prev.val=x.x-x.prev.x):(x.x-=3,x.val+=10))}q()}},out_lped:function(q,B,D,x,K){this.cfmt().pedline?(this.xypath(B,D+16),K.nost?(this.out_svg("l2.5 6"),x-=2.5):this.out_svg("v6"),K.noen?this.out_svg("h"+(x-2.5).toFixed(1)+'l2.5 -6"/>\n'):this.out_svg("h"+
x.toFixed(1)+'v-6"/>\n')):q(B,D,x,K)},set_fmt:function(q,B,D){"pedline"==B?this.cfmt().pedline=this.get_bool(D):q(B,D)},set_hooks:function(q){q.draw_all_deco=abc2svg.pedline.draw_all_deco.bind(q,q.draw_all_deco);q.out_lped=abc2svg.pedline.out_lped.bind(q,q.out_lped);q.set_format=abc2svg.pedline.set_fmt.bind(q,q.set_format)}};abc2svg.modules.hooks.push(abc2svg.pedline.set_hooks);abc2svg.modules.pedline.loaded=!0;
